/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{326:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r,o=n(128),c=(r=n(212))&&"object"==typeof r&&"default"in r?r.default:r,h=n(214),i=n(160),f=n(327),s=n(213),u=new h.Logger("@firebase/firestore");function a(){return u.logLevel}function l(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(u.logLevel<=h.LogLevel.DEBUG){var n=e.map(y);u.debug.apply(u,o.__spreadArrays(["Firestore (7.19.0): "+t],n))}}function d(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(u.logLevel<=h.LogLevel.ERROR){var n=e.map(y);u.error.apply(u,o.__spreadArrays(["Firestore (7.19.0): "+t],n))}}function v(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(u.logLevel<=h.LogLevel.WARN){var n=e.map(y);u.warn.apply(u,o.__spreadArrays(["Firestore (7.19.0): "+t],n))}}function y(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function p(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.19.0) INTERNAL ASSERTION FAILED: "+t;throw d(e),new Error(e)}function m(t,e){t||p()}function w(t,e){return t}function _(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var g=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=_(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function I(t,e){return t<e?-1:t>e?1:0}function E(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function T(t){return t+"\0"}var b=function(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},A=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.o=function(t){return I(this.projectId,t.projectId)||I(this.database,t.database)},t}();function N(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function S(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function D(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var x=function(){function t(t,e){this.h=t,this.u=e,this.l={}}return t.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){S(this.l,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype._=function(){return D(this.l)},t}(),k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},L=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return o.__extends(e,t),e}(Error),P=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new L(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new L(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new L(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new L(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.T=function(t){return this.seconds===t.seconds?I(this.nanoseconds,t.nanoseconds):I(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),R=function(){function t(t){this.timestamp=t}return t.m=function(e){return new t(e)},t.min=function(){return new t(new P(0,0))},t.prototype.o=function(t){return this.timestamp.T(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.I=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.A=function(){return this.timestamp},t}(),O=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&p(),void 0===n?n=t.length-e:n>t.length-e&&p(),this.segments=t,this.offset=e,this.R=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.P(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.g(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.V=function(t){return t=void 0===t?1:t,this.g(this.segments,this.offset+t,this.length-t)},t.prototype.p=function(){return this.g(this.segments,this.offset,this.length-1)},t.prototype.v=function(){return this.segments[this.offset]},t.prototype.S=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype._=function(){return 0===this.length},t.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.N=function(){return this.segments.slice(this.offset,this.limit())},t.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.g=function(t,n,r){return new e(t,n,r)},e.prototype.F=function(){return this.N().join("/")},e.prototype.toString=function(){return this.F()},e.k=function(t){if(t.indexOf("//")>=0)throw new L(k.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter((function(t){return t.length>0})))},e.$=function(){return new e([])},e}(O),U=/^[_a-zA-Z][_a-zA-Z0-9]*$/,V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.g=function(t,n,r){return new e(t,n,r)},e.O=function(t){return U.test(t)},e.prototype.F=function(){return this.N().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.O(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.F()},e.prototype.M=function(){return 1===this.length&&"__name__"===this.get(0)},e.L=function(){return new e(["__name__"])},e.q=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new L(k.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new L(k.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new L(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new L(k.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.$=function(){return new e([])},e}(O),M=function(){function t(t){this.path=t}return t.B=function(e){return new t(C.k(e))},t.U=function(e){return new t(C.k(e).V(5))},t.prototype.W=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===C.P(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.P=function(t,e){return C.P(t.path,e.path)},t.j=function(t){return t.length%2==0},t.K=function(e){return new t(new C(e.slice()))},t}();function F(t){return null==t}function j(t){return-0===t&&1/t==-1/0}function q(t){return"number"==typeof t&&Number.isInteger(t)&&!j(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var G=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.G=null};function B(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new G(t,e,n,r,i,o,s)}function z(t){var e=w(t);if(null===e.G){var n=e.path.F();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.F()+t.op.toString()+Ct(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.F()+e.dir;var e})).join(","),F(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Pn(e.startAt)),e.endAt&&(n+="|ub:",n+=Pn(e.endAt)),e.G=n}return e.G}function H(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Vn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Lt(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!On(t.startAt,e.startAt)&&On(t.endAt,e.endAt)}function W(t){return M.j(t.path)&&null===t.collectionGroup&&0===t.filters.length}var K=function(){function t(t){this.H=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.H,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.H)},t.prototype.Y=function(){return 2*this.H.length},t.prototype.o=function(t){return I(this.H,t.H)},t.prototype.isEqual=function(t){return this.H===t.H},t}();K.J=new K("");var Y,X,Q=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=R.min()),void 0===o&&(o=R.min()),void 0===s&&(s=K.J),this.target=t,this.targetId=e,this.X=n,this.sequenceNumber=r,this.Z=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.tt=function(e){return new t(this.target,this.targetId,this.X,e,this.Z,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.et=function(e,n){return new t(this.target,this.targetId,this.X,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.nt=function(e){return new t(this.target,this.targetId,this.X,this.sequenceNumber,this.Z,e,this.resumeToken)},t}(),Z=function(t){this.count=t};function J(t){switch(t){case k.OK:return p();case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0;default:return p()}}function $(t){if(void 0===t)return d("GRPC error has no .code"),k.UNKNOWN;switch(t){case Y.OK:return k.OK;case Y.CANCELLED:return k.CANCELLED;case Y.UNKNOWN:return k.UNKNOWN;case Y.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case Y.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case Y.INTERNAL:return k.INTERNAL;case Y.UNAVAILABLE:return k.UNAVAILABLE;case Y.UNAUTHENTICATED:return k.UNAUTHENTICATED;case Y.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case Y.NOT_FOUND:return k.NOT_FOUND;case Y.ALREADY_EXISTS:return k.ALREADY_EXISTS;case Y.PERMISSION_DENIED:return k.PERMISSION_DENIED;case Y.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case Y.ABORTED:return k.ABORTED;case Y.OUT_OF_RANGE:return k.OUT_OF_RANGE;case Y.UNIMPLEMENTED:return k.UNIMPLEMENTED;case Y.DATA_LOSS:return k.DATA_LOSS;default:return p()}}(X=Y||(Y={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var tt=function(){function t(t,e){this.P=t,this.root=e||nt.EMPTY}return t.prototype.st=function(e,n){return new t(this.P,this.root.st(e,n,this.P).copy(null,null,nt.it,null,null))},t.prototype.remove=function(e){return new t(this.P,this.root.remove(e,this.P).copy(null,null,nt.it,null,null))},t.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype._=function(){return this.root._()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.rt=function(){return this.root.rt()},t.prototype.ot=function(){return this.root.ot()},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.forEach=function(t){this.ht((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ht((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.at=function(t){return this.root.at(t)},t.prototype.ct=function(){return new et(this.root,null,this.P,!1)},t.prototype.ut=function(t){return new et(this.root,t,this.P,!1)},t.prototype.lt=function(){return new et(this.root,null,this.P,!0)},t.prototype._t=function(t){return new et(this.root,t,this.P,!0)},t}(),et=function(){function t(t,e,n,r){this.ft=r,this.dt=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ft?t.left:t.right;else{if(0===i){this.dt.push(t);break}this.dt.push(t),t=this.ft?t.right:t.left}}return t.prototype.wt=function(){var t=this.dt.pop(),e={key:t.key,value:t.value};if(this.ft)for(t=t.left;!t._();)this.dt.push(t),t=t.right;else for(t=t.right;!t._();)this.dt.push(t),t=t.left;return e},t.prototype.Tt=function(){return this.dt.length>0},t.prototype.Et=function(){if(0===this.dt.length)return null;var t=this.dt[this.dt.length-1];return{key:t.key,value:t.value}},t}(),nt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype._=function(){return!1},t.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},t.prototype.at=function(t){return this.right.at(t)||t(this.key,this.value)||this.left.at(t)},t.prototype.min=function(){return this.left._()?this:this.left.min()},t.prototype.rt=function(){return this.min().key},t.prototype.ot=function(){return this.right._()?this.key:this.right.ot()},t.prototype.st=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.st(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.st(t,e,n))).It()},t.prototype.At=function(){if(this.left._())return t.EMPTY;var e=this;return e.left.Rt()||e.left.left.Rt()||(e=e.Pt()),(e=e.copy(null,null,null,e.left.At(),null)).It()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left._()||i.left.Rt()||i.left.left.Rt()||(i=i.Pt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.Rt()&&(i=i.gt()),i.right._()||i.right.Rt()||i.right.left.Rt()||(i=i.Vt()),0===n(e,i.key)){if(i.right._())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.At())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.It()},t.prototype.Rt=function(){return this.color},t.prototype.It=function(){var t=this;return t.right.Rt()&&!t.left.Rt()&&(t=t.yt()),t.left.Rt()&&t.left.left.Rt()&&(t=t.gt()),t.left.Rt()&&t.right.Rt()&&(t=t.pt()),t},t.prototype.Pt=function(){var t=this.pt();return t.right.left.Rt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.gt())).yt()).pt()),t},t.prototype.Vt=function(){var t=this.pt();return t.left.left.Rt()&&(t=(t=t.gt()).pt()),t},t.prototype.yt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.gt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.pt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.bt=function(){var t=this.vt();return Math.pow(2,t)<=this.size+1},t.prototype.vt=function(){if(this.Rt()&&this.left.Rt())throw p();if(this.right.Rt())throw p();var t=this.left.vt();if(t!==this.right.vt())throw p();return t+(this.Rt()?0:1)},t}();nt.EMPTY=null,nt.RED=!0,nt.it=!1,nt.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw p()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw p()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw p()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw p()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw p()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.st=function(t,e,n){return new nt(t,e)},t.prototype.remove=function(t,e){return this},t.prototype._=function(){return!0},t.prototype.ht=function(t){return!1},t.prototype.at=function(t){return!1},t.prototype.rt=function(){return null},t.prototype.ot=function(){return null},t.prototype.Rt=function(){return!1},t.prototype.bt=function(){return!0},t.prototype.vt=function(){return 0},t}());var it=function(){function t(t){this.P=t,this.data=new tt(this.P)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.rt()},t.prototype.last=function(){return this.data.ot()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ht((function(e,n){return t(e),!1}))},t.prototype.St=function(t,e){for(var n=this.data.ut(t[0]);n.Tt();){var r=n.wt();if(this.P(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Dt=function(t,e){var n;for(n=void 0!==e?this.data.ut(e):this.data.ct();n.Tt();)if(!t(n.wt().key))return},t.prototype.Ct=function(t){var e=this.data.ut(t);return e.Tt()?e.wt().key:null},t.prototype.ct=function(){return new ot(this.data.ct())},t.prototype.ut=function(t){return new ot(this.data.ut(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).st(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype._=function(){return this.data._()},t.prototype.Nt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.ct(),r=e.data.ct();n.Tt();){var i=n.wt().key,o=r.wt().key;if(0!==this.P(i,o))return!1}return!0},t.prototype.N=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.P);return n.data=e,n},t}(),ot=function(){function t(t){this.Ft=t}return t.prototype.wt=function(){return this.Ft.wt().key},t.prototype.Tt=function(){return this.Ft.Tt()},t}(),st=new tt(M.P);function rt(){return st}function ut(){return rt()}var at=new tt(M.P);function ct(){return at}var ht=new tt(M.P),ft=new it(M.P);function lt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ft,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var pt=new it(I);function vt(){return pt}var yt=function(){function t(t){this.P=t?function(e,n){return t(e,n)||M.P(e.key,n.key)}:function(t,e){return M.P(t.key,e.key)},this.kt=ct(),this.$t=new tt(this.P)}return t.xt=function(e){return new t(e.P)},t.prototype.has=function(t){return null!=this.kt.get(t)},t.prototype.get=function(t){return this.kt.get(t)},t.prototype.first=function(){return this.$t.rt()},t.prototype.last=function(){return this.$t.ot()},t.prototype._=function(){return this.$t._()},t.prototype.indexOf=function(t){var e=this.kt.get(t);return e?this.$t.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.$t.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.$t.ht((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.kt.st(t.key,t),e.$t.st(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.kt.remove(t),this.$t.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.$t.ct(),r=e.$t.ct();n.Tt();){var i=n.wt().key,o=r.wt().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.P=this.P,r.kt=e,r.$t=n,r},t}(),gt=function(){function t(){this.Ot=new tt(M.P)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Ot.get(e);n?0!==t.type&&3===n.type?this.Ot=this.Ot.st(e,t):3===t.type&&1!==n.type?this.Ot=this.Ot.st(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Ot=this.Ot.st(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Ot=this.Ot.st(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Ot=this.Ot.remove(e):1===t.type&&2===n.type?this.Ot=this.Ot.st(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Ot=this.Ot.st(e,{type:2,doc:t.doc}):p():this.Ot=this.Ot.st(e,t)},t.prototype.Mt=function(){var t=[];return this.Ot.ht((function(e,n){t.push(n)})),t},t}(),dt=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Lt=n,this.docChanges=r,this.qt=i,this.fromCache=o,this.Bt=s,this.Ut=u}return t.Qt=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,yt.xt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.qt._()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Bt===t.Bt&&this.qt.isEqual(t.qt)&&gn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Lt.isEqual(t.Lt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),mt=function(){function t(t,e,n,r,i){this.Z=t,this.Wt=e,this.jt=n,this.Kt=r,this.Gt=i}return t.zt=function(e,n){var r=new Map;return r.set(e,wt.Ht(e,n)),new t(R.min(),r,vt(),rt(),lt())},t}(),wt=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Yt=e,this.Jt=n,this.Xt=r,this.Zt=i}return t.Ht=function(e,n){return new t(K.J,n,lt(),lt(),lt())},t}(),bt=function(t,e,n,r){this.te=t,this.removedTargetIds=e,this.key=n,this.ee=r},_t=function(t,e){this.targetId=t,this.ne=e},It=function(t,e,n,r){void 0===n&&(n=K.J),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Et=function(){function t(){this.se=0,this.ie=Nt(),this.re=K.J,this.oe=!1,this.he=!0}return Object.defineProperty(t.prototype,"Yt",{get:function(){return this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ae",{get:function(){return 0!==this.se},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ce",{get:function(){return this.he},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){t.Y()>0&&(this.he=!0,this.re=t)},t.prototype.le=function(){var t=lt(),e=lt(),n=lt();return this.ie.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:p()}})),new wt(this.re,this.oe,t,e,n)},t.prototype._e=function(){this.he=!1,this.ie=Nt()},t.prototype.fe=function(t,e){this.he=!0,this.ie=this.ie.st(t,e)},t.prototype.de=function(t){this.he=!0,this.ie=this.ie.remove(t)},t.prototype.we=function(){this.se+=1},t.prototype.Te=function(){this.se-=1},t.prototype.Ee=function(){this.he=!0,this.oe=!0},t}(),Tt=function(){function t(t){this.me=t,this.Ie=new Map,this.Ae=rt(),this.Re=At(),this.Pe=new it(I)}return t.prototype.ge=function(t){for(var e=0,n=t.te;e<n.length;e++){var r=n[e];t.ee instanceof rn?this.Ve(r,t.ee):t.ee instanceof on&&this.ye(r,t.key,t.ee)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ye(s,t.key,t.ee)}},t.prototype.pe=function(t){var e=this;this.be(t,(function(n){var r=e.ve(n);switch(t.state){case 0:e.Se(n)&&r.ue(t.resumeToken);break;case 1:r.Te(),r.ae||r._e(),r.ue(t.resumeToken);break;case 2:r.Te(),r.ae||e.removeTarget(n);break;case 3:e.Se(n)&&(r.Ee(),r.ue(t.resumeToken));break;case 4:e.Se(n)&&(e.De(n),r.ue(t.resumeToken));break;default:p()}}))},t.prototype.be=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Ie.forEach((function(t,r){n.Se(r)&&e(r)}))},t.prototype.Ce=function(t){var e=t.targetId,n=t.ne.count,r=this.Ne(e);if(r){var i=r.target;if(W(i))if(0===n){var o=new M(i.path);this.ye(e,o,new on(o,R.min()))}else m(1===n);else this.Fe(e)!==n&&(this.De(e),this.Pe=this.Pe.add(e))}},t.prototype.ke=function(t){var e=this,n=new Map;this.Ie.forEach((function(r,i){var o=e.Ne(i);if(o){if(r.Yt&&W(o.target)){var s=new M(o.target.path);null!==e.Ae.get(s)||e.$e(i,s)||e.ye(i,s,new on(s,t))}r.ce&&(n.set(i,r.le()),r._e())}}));var r=lt();this.Re.forEach((function(t,n){var i=!0;n.Dt((function(t){var n=e.Ne(t);return!n||2===n.X||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new mt(t,n,this.Pe,this.Ae,r);return this.Ae=rt(),this.Re=At(),this.Pe=new it(I),i},t.prototype.Ve=function(t,e){if(this.Se(t)){var n=this.$e(t,e.key)?2:0;this.ve(t).fe(e.key,n),this.Ae=this.Ae.st(e.key,e),this.Re=this.Re.st(e.key,this.xe(e.key).add(t))}},t.prototype.ye=function(t,e,n){if(this.Se(t)){var r=this.ve(t);this.$e(t,e)?r.fe(e,1):r.de(e),this.Re=this.Re.st(e,this.xe(e).delete(t)),n&&(this.Ae=this.Ae.st(e,n))}},t.prototype.removeTarget=function(t){this.Ie.delete(t)},t.prototype.Fe=function(t){var e=this.ve(t).le();return this.me.Oe(t).size+e.Jt.size-e.Zt.size},t.prototype.we=function(t){this.ve(t).we()},t.prototype.ve=function(t){var e=this.Ie.get(t);return e||(e=new Et,this.Ie.set(t,e)),e},t.prototype.xe=function(t){var e=this.Re.get(t);return e||(e=new it(I),this.Re=this.Re.st(t,e)),e},t.prototype.Se=function(t){var e=null!==this.Ne(t);return e||l("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.Ne=function(t){var e=this.Ie.get(t);return e&&e.ae?null:this.me.Me(t)},t.prototype.De=function(t){var e=this;this.Ie.set(t,new Et),this.me.Oe(t).forEach((function(n){e.ye(t,n,null)}))},t.prototype.$e=function(t,e){return this.me.Oe(t).has(e)},t}();function At(){return new tt(M.P)}function Nt(){return new tt(M.P)}function St(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Dt(t){var e=Ut(t.mapValue.fields.__local_write_time__.timestampValue);return new P(e.seconds,e.nanos)}var xt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function kt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?St(t)?4:10:p()}function Lt(t,e){var n=kt(t);if(n!==kt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Dt(t).isEqual(Dt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ut(t.timestampValue),r=Ut(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Mt(t.bytesValue).isEqual(Mt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Vt(t.geoPointValue.latitude)===Vt(e.geoPointValue.latitude)&&Vt(t.geoPointValue.longitude)===Vt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Vt(t.integerValue)===Vt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Vt(t.doubleValue),r=Vt(e.doubleValue);return n===r?j(n)===j(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return E(t.arrayValue.values||[],e.arrayValue.values||[],Lt);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(N(n)!==N(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Lt(n[i],r[i])))return!1;return!0}(t,e);default:return p()}}function Pt(t,e){return void 0!==(t.values||[]).find((function(t){return Lt(t,e)}))}function Rt(t,e){var n=kt(t),r=kt(e);if(n!==r)return I(n,r);switch(n){case 0:return 0;case 1:return I(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Vt(t.integerValue||t.doubleValue),r=Vt(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ot(t.timestampValue,e.timestampValue);case 4:return Ot(Dt(t),Dt(e));case 5:return I(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Mt(t),r=Mt(e);return n.o(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=I(n[i],r[i]);if(0!==o)return o}return I(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=I(Vt(t.latitude),Vt(e.latitude));return 0!==n?n:I(Vt(t.longitude),Vt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Rt(n[i],r[i]);if(o)return o}return I(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=I(r[s],o[s]);if(0!==u)return u;var a=Rt(n[r[s]],i[o[s]]);if(0!==a)return a}return I(r.length,o.length)}(t.mapValue,e.mapValue);default:throw p()}}function Ot(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return I(t,e);var n=Ut(t),r=Ut(e),i=I(n.seconds,r.seconds);return 0!==i?i:I(n.nanos,r.nanos)}function Ct(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Ut(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Mt(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,M.U(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=t(s)}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):p();var n,r}(t)}function Ut(t){if(m(!!t),"string"==typeof t){var e=0,n=xt.exec(t);if(m(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Vt(t.seconds),nanos:Vt(t.nanos)}}function Vt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Mt(t){return"string"==typeof t?K.fromBase64String(t):K.fromUint8Array(t)}function qt(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.F()}}function Ft(t){return!!t&&"integerValue"in t}function jt(t){return!!t&&"arrayValue"in t}function Gt(t){return!!t&&"nullValue"in t}function Bt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function zt(t){return!!t&&"mapValue"in t}var Ht={asc:"ASCENDING",desc:"DESCENDING"},Wt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Kt=function(t,e){this.s=t,this.Le=e};function Yt(t){return{integerValue:""+t}}function Xt(t,e){if(t.Le){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:j(e)?"-0":e}}function Qt(t,e){return q(e)?Yt(e):Xt(t,e)}function Zt(t,e){return t.Le?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Jt(t,e){return t.Le?e.toBase64():e.toUint8Array()}function $t(t,e){return Zt(t,e.A())}function te(t){return m(!!t),R.m(function(t){var e=Ut(t);return new P(e.seconds,e.nanos)}(t))}function ee(t,e){return function(t){return new C(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).F()}function ne(t){var e=C.k(t);return m(_e(e)),e}function re(t,e){return ee(t.s,e.path)}function ie(t,e){var n=ne(e);return m(n.get(1)===t.s.projectId),m(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new M(ae(n))}function oe(t,e){return ee(t.s,e)}function se(t){var e=ne(t);return 4===e.length?C.$():ae(e)}function ue(t){return new C(["projects",t.s.projectId,"databases",t.s.database]).F()}function ae(t){return m(t.length>4&&"documents"===t.get(4)),t.V(5)}function ce(t,e,n){return{name:re(t,e),fields:n.proto.mapValue.fields}}function he(t,e){var n;if(e instanceof He)n={update:ce(t,e.key,e.value)};else if(e instanceof Ze)n={delete:re(t,e.key)};else if(e instanceof We)n={update:ce(t,e.key,e.data),updateMask:be(e.qe)};else if(e instanceof Ye)n={transform:{document:re(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Ne)return{fieldPath:e.field.F(),setToServerValue:"REQUEST_TIME"};if(n instanceof Se)return{fieldPath:e.field.F(),appendMissingElements:{values:n.elements}};if(n instanceof xe)return{fieldPath:e.field.F(),removeAllFromArray:{values:n.elements}};if(n instanceof Le)return{fieldPath:e.field.F(),increment:n.Be};throw p()}(0,t)}))}};else{if(!(e instanceof Je))return p();n={verify:re(t,e.key)}}return e.Qe.Ue||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:$t(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:p()}(t,e.Qe)),n}function fe(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Ve.updateTime(te(t.updateTime)):void 0!==t.exists?Ve.exists(t.exists):Ve.We()}(e.currentDocument):Ve.We();if(e.update){e.update.name;var r=ie(t,e.update.name),i=new $e({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new Oe(e.map((function(t){return V.q(t)})))}(e.updateMask);return new We(r,i,o,n)}return new He(r,i,n)}if(e.delete){var s=ie(t,e.delete);return new Ze(s,n)}if(e.transform){var u=ie(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)m("REQUEST_TIME"===e.setToServerValue),n=new Ne;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Se(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new xe(i)}else"increment"in e?n=new Le(t,e.increment):p();var o=V.q(e.fieldPath);return new Ce(o,n)}(t,e)}));return m(!0===n.exists),new Ye(u,a)}if(e.verify){var c=ie(t,e.verify);return new Je(c,n)}return p()}function le(t,e){return{documents:[oe(t,e.path)]}}function pe(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=oe(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=oe(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Bt(t.value))return{unaryFilter:{field:ye(t.field),op:"IS_NAN"}};if(Gt(t.value))return{unaryFilter:{field:ye(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Bt(t.value))return{unaryFilter:{field:ye(t.field),op:"IS_NOT_NAN"}};if(Gt(t.value))return{unaryFilter:{field:ye(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ye(t.field),op:(e=t.op,Wt[e]),value:t.value}};var e}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:ye((e=t).field),direction:(n=e.dir,Ht[n])};var e,n}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Le||F(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=de(e.startAt)),e.endAt&&(n.structuredQuery.endAt=de(e.endAt)),n}function de(t){return{before:t.before,values:t.position}}function ve(t){var e=!!t.before,n=t.values||[];return new Ln(n,e)}function ye(t){return{fieldPath:t.F()}}function ge(t){return V.q(t.fieldPath)}function me(t){return In.create(ge(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return p()}}(t.fieldFilter.op),t.fieldFilter.value)}function we(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ge(t.unaryFilter.field);return In.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ge(t.unaryFilter.field);return In.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ge(t.unaryFilter.field);return In.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ge(t.unaryFilter.field);return In.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return p()}}function be(t){var e=[];return t.fields.forEach((function(t){return e.push(t.F())})),{fieldPaths:e}}function _e(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Ie=function(){this.je=void 0};function Ee(t,e,n){return t instanceof Ne?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Se?De(t,e):t instanceof xe?ke(t,e):function(t,e){var n=Ae(t,e),r=Pe(n)+Pe(t.Be);return Ft(n)&&Ft(t.Be)?Yt(r):Xt(t.serializer,r)}(t,e)}function Te(t,e,n){return t instanceof Se?De(t,e):t instanceof xe?ke(t,e):n}function Ae(t,e){return t instanceof Le?Ft(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e}(Ie),Se=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return o.__extends(e,t),e}(Ie);function De(t,e){for(var n=Re(e),r=function(t){n.some((function(e){return Lt(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var xe=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return o.__extends(e,t),e}(Ie);function ke(t,e){for(var n=Re(e),r=function(t){n=n.filter((function(e){return!Lt(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Le=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.Be=n,r}return o.__extends(e,t),e}(Ie);function Pe(t){return Vt(t.integerValue||t.doubleValue)}function Re(t){return jt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Oe=function(){function t(t){this.fields=t,t.sort(V.P)}return t.prototype.Ke=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},t.prototype.isEqual=function(t){return E(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Ce=function(t,e){this.field=t,this.transform=e},Ue=function(t,e){this.version=t,this.transformResults=e},Ve=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.We=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"Ue",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Me(t,e){return void 0!==t.updateTime?e instanceof rn&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof rn}var qe=function(){};function Fe(t,e,n){return t instanceof He?function(t,e,n){return new rn(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof We?function(t,e,n){if(!Me(t.Qe,e))return new sn(t.key,n.version);var r=Ke(t,e);return new rn(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Ye?function(t,e,n){if(m(null!=n.transformResults),!Me(t.Qe,e))return new sn(t.key,n.version);var r=Xe(t,e),i=function(t,e,n){var r=[];m(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof rn&&(u=e.field(o.field)),r.push(Te(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Qe(t,r.data(),i);return new rn(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new on(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function je(t,e,n,r){return t instanceof He?function(t,e){if(!Me(t.Qe,e))return e;var n=ze(e);return new rn(t.key,n,t.value,{Ge:!0})}(t,e):t instanceof We?function(t,e){if(!Me(t.Qe,e))return e;var n=ze(e),r=Ke(t,e);return new rn(t.key,n,r,{Ge:!0})}(t,e):t instanceof Ye?function(t,e,n,r){if(!Me(t.Qe,e))return e;var i=Xe(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof rn&&(c=n.field(u.field)),null===c&&r instanceof rn&&(c=r.field(u.field)),i.push(Ee(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=Qe(t,i.data(),o);return new rn(t.key,i.version,s,{Ge:!0})}(t,e,r,n):function(t,e){return Me(t.Qe,e)?new on(t.key,R.min()):e}(t,e)}function Ge(t,e){return t instanceof Ye?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof rn?e.field(o.field):void 0,u=Ae(o.transform,s||null);null!=u&&(n=null==n?(new tn).set(o.field,u):n.set(o.field,u))}return n?n.ze():null}(t,e):null}function Be(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Qe.isEqual(e.Qe)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.qe.isEqual(e.qe):2!==t.type||E(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Se&&e instanceof Se||t instanceof xe&&e instanceof xe?E(t.elements,e.elements,Lt):t instanceof Le&&e instanceof Le?Lt(t.Be,e.Be):t instanceof Ne&&e instanceof Ne}(t.transform,e.transform)}(t,e)})))}function ze(t){return t instanceof rn?t.version:R.min()}var He=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Qe=r,i.type=0,i}return o.__extends(e,t),e}(qe),We=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.qe=r,o.Qe=i,o.type=1,o}return o.__extends(e,t),e}(qe);function Ke(t,e){return function(t,e){var n=new tn(e);return t.qe.fields.forEach((function(e){if(!e._()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.ze()}(t,e instanceof rn?e.data():$e.empty())}var Ye=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Qe=Ve.exists(!0),r}return o.__extends(e,t),e}(qe);function Xe(t,e){return e}function Qe(t,e,n){for(var r=new tn(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.ze()}var Ze=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Qe=n,r.type=3,r}return o.__extends(e,t),e}(qe),Je=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Qe=n,r.type=4,r}return o.__extends(e,t),e}(qe),$e=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!zt(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},t.prototype.isEqual=function(t){return Lt(this.proto,t.proto)},t}(),tn=function(){function t(t){void 0===t&&(t=$e.empty()),this.He=t,this.Ye=new Map}return t.prototype.set=function(t,e){return this.Je(t,e),this},t.prototype.delete=function(t){return this.Je(t,null),this},t.prototype.Je=function(t,e){for(var n=this.Ye,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===kt(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.S(),e)},t.prototype.ze=function(){var t=this.Xe(V.$(),this.Ye);return null!=t?new $e(t):this.He},t.prototype.Xe=function(t,e){var n=this,r=!1,i=this.He.field(t),o=zt(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.Xe(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function en(t){var e=[];return S(t.fields||{},(function(t,n){var r=new V([t]);if(zt(n)){var i=en(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new Oe(e)}var nn=function(t,e){this.key=t,this.version=e},rn=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).Ze=r,o.Ge=!!i.Ge,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return o.__extends(e,t),e.prototype.field=function(t){return this.Ze.field(t)},e.prototype.data=function(){return this.Ze},e.prototype.tn=function(){return this.Ze.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ge===t.Ge&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ze.isEqual(t.Ze)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ze.toString()+", {hasLocalMutations: "+this.Ge+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.Ge||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(nn),on=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return o.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(nn),sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(nn);function un(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new L(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass '"+e.name+"' from a different Firestore SDK?"):new L(k.INVALID_ARGUMENT,"Expected type '"+e.name+"', but was '"+t.constructor.name+"'");return t}var an=function(){function t(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.en=n,this.filters=r,this.limit=i,this.nn=o,this.startAt=s,this.endAt=u,this.sn=null,this.rn=null,this.startAt,this.endAt}return t.prototype.on=function(e){return new t(e,null,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},t.prototype.hn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.en.length||1===this.en.length&&this.en[0].field.M())},t.prototype.an=function(){return!F(this.limit)&&"F"===this.nn},t.prototype.cn=function(){return!F(this.limit)&&"L"===this.nn},t.prototype.un=function(){return this.en.length>0?this.en[0].field:null},t.prototype.ln=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n._n())return n.field}return null},t.prototype.fn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(t.indexOf(r.op)>=0)return r.op}return null},t}();function cn(t,e,n,r,i,o,s,u){return new an(t,e,n,r,i,o,s,u)}function hn(t){return new an(t)}function fn(t){return null!==t.collectionGroup}function ln(t){var e=un(t,an);if(null===e.sn){e.sn=[];var n=e.ln(),r=e.un();if(null!==n&&null===r)n.M()||e.sn.push(new Cn(n)),e.sn.push(new Cn(V.L(),"asc"));else{for(var i=!1,o=0,s=e.en;o<s.length;o++){var u=s[o];e.sn.push(u),u.field.M()&&(i=!0)}if(!i){var a=e.en.length>0?e.en[e.en.length-1].dir:"asc";e.sn.push(new Cn(V.L(),a))}}}return e.sn}function pn(t){var e=un(t,an);if(!e.rn)if("F"===e.nn)e.rn=B(e.path,e.collectionGroup,ln(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ln(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Cn(o.field,s))}var u=e.endAt?new Ln(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Ln(e.startAt.position,!e.startAt.before):null;e.rn=B(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.rn}function dn(t,e,n){return new an(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function vn(t,e){return new an(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),t.limit,t.nn,e,t.endAt)}function yn(t,e){return new an(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),t.limit,t.nn,t.startAt,e)}function gn(t,e){return H(pn(t),pn(e))&&t.nn===e.nn}function mn(t){return z(pn(t))+"|lt:"+t.nn}function wn(t){return"Query(target="+function(t){var e=t.path.F();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.F()+" "+e.op+" "+Ct(e.value);var e})).join(", ")+"]"),F(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return(e=t).field.F()+" ("+e.dir+")";var e})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Pn(t.startAt)),t.endAt&&(e+=", endAt: "+Pn(t.endAt)),"Target("+e+")"}(pn(t))+"; limitType="+t.nn+")"}function bn(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.W(t.collectionGroup)&&t.path.D(n):M.j(t.path)?t.path.isEqual(n):t.path.C(n)}(t,e)&&function(t,e){for(var n=0,r=t.en;n<r.length;n++){var i=r[n];if(!i.field.M()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Rn(t.startAt,ln(t),e)||t.endAt&&Rn(t.endAt,ln(t),e))}(t,e)}function _n(t){return function(e,n){for(var r=!1,i=0,o=ln(t);i<o.length;i++){var s=o[i],u=Un(s,e,n);if(0!==u)return u;r=r||s.field.M()}return 0}}var In=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return o.__extends(e,t),e.create=function(t,n,r){if(t.M())return"in"===n||"not-in"===n?this.dn(t,n,r):new En(t,n,r);if(Gt(r)){if("=="!==n&&"!="!==n)throw new L(k.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(Bt(r)){if("=="!==n&&"!="!==n)throw new L(k.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return"array-contains"===n?new Sn(t,r):"in"===n?new Dn(t,r):"not-in"===n?new xn(t,r):"array-contains-any"===n?new kn(t,r):new e(t,n,r)},e.dn=function(t,e,n){return"in"===e?new Tn(t,n):new An(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.wn(Rt(e,this.value)):null!==e&&kt(this.value)===kt(e)&&this.wn(Rt(e,this.value))},e.prototype.wn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return p()}},e.prototype._n=function(){return["<","<=",">",">=","!="].indexOf(this.op)>=0},e}((function(){})),En=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=M.U(r.referenceValue),i}return o.__extends(e,t),e.prototype.matches=function(t){var e=M.P(t.key,this.key);return this.wn(e)},e}(In),Tn=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Nn("in",n),r}return o.__extends(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(In),An=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Nn("not-in",n),r}return o.__extends(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(In);function Nn(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return M.U(t.referenceValue)}))}var Sn=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return o.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return jt(e)&&Pt(e.arrayValue,this.value)},e}(In),Dn=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return o.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Pt(this.value.arrayValue,e)},e}(In),xn=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return o.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&!Pt(this.value.arrayValue,e)},e}(In),kn=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return o.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!jt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Pt(e.value.arrayValue,t)}))},e}(In),Ln=function(t,e){this.position=t,this.before=e};function Pn(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Ct(t)})).join(",")}function Rn(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.M()?M.P(M.U(s.referenceValue),n.key):Rt(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function On(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Lt(t.position[n],e.position[n]))return!1;return!0}var Cn=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Un(t,e,n){var r=t.field.M()?M.P(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Rt(r,i):p()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return p()}}function Vn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var Mn=function(){function t(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}return t.prototype.En=function(t,e,n){for(var r=n.mn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Fe(o,e,r[i]))}return e},t.prototype.In=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=je(i,e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=je(a,e,o,this.Tn))}return e},t.prototype.An=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.In(r.key,t.get(r.key));i&&(n=n.st(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),lt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&E(this.mutations,t.mutations,(function(t,e){return Be(t,e)}))&&E(this.baseMutations,t.baseMutations,(function(t,e){return Be(t,e)}))},t}(),qn=function(){function t(t,e,n,r){this.batch=t,this.Rn=e,this.mn=n,this.Pn=r}return t.from=function(e,n,r){m(e.mutations.length===r.length);for(var i=ht,o=e.mutations,s=0;s<o.length;s++)i=i.st(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Fn=function(){function t(t){var e=this;this.gn=null,this.Vn=null,this.result=void 0,this.error=void 0,this.yn=!1,this.pn=!1,t((function(t){e.yn=!0,e.result=t,e.gn&&e.gn(t)}),(function(t){e.yn=!0,e.error=t,e.Vn&&e.Vn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.pn&&p(),this.pn=!0,this.yn?this.error?this.bn(n,this.error):this.vn(e,this.result):new t((function(t,i){r.gn=function(n){r.vn(e,n).next(t,i)},r.Vn=function(e){r.bn(n,e).next(t,i)}}))},t.prototype.Sn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Dn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.vn=function(e,n){return e?this.Dn((function(){return e(n)})):t.resolve(n)},t.prototype.bn=function(e,n){return e?this.Dn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.Cn=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.Nn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.Cn(r)},t}(),jn=function(){function t(){this.Fn=new x((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.kn=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.$n},set:function(t){this.$n=t},enumerable:!1,configurable:!0}),t.prototype.xn=function(t,e){this.On(),this.readTime=e,this.Fn.set(t.key,t)},t.prototype.Mn=function(t,e){this.On(),e&&(this.readTime=e),this.Fn.set(t,null)},t.prototype.Ln=function(t,e){this.On();var n=this.Fn.get(e);return void 0!==n?Fn.resolve(n):this.qn(t,e)},t.prototype.getEntries=function(t,e){return this.Bn(t,e)},t.prototype.apply=function(t){return this.On(),this.kn=!0,this.Un(t)},t.prototype.On=function(){},t}(),Gn="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Bn=function(){function t(){this.Qn=[]}return t.prototype.Wn=function(t){this.Qn.push(t)},t.prototype.jn=function(){this.Qn.forEach((function(t){return t()}))},t}(),zn=function(){function t(t,e,n){this.Kn=t,this.Gn=e,this.zn=n}return t.prototype.Hn=function(t,e){var n=this;return this.Gn.Yn(t,e).next((function(r){return n.Jn(t,e,r)}))},t.prototype.Jn=function(t,e,n){return this.Kn.Ln(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].In(e,t);return t}))},t.prototype.Xn=function(t,e,n){var r=ut();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].In(t,e);r=r.st(t,e)})),r},t.prototype.Zn=function(t,e){var n=this;return this.Kn.getEntries(t,e).next((function(e){return n.ts(t,e)}))},t.prototype.ts=function(t,e){var n=this;return this.Gn.es(t,e).next((function(r){var i=n.Xn(t,e,r),o=rt();return i.forEach((function(t,e){e||(e=new on(t,R.min())),o=o.st(t,e)})),o}))},t.prototype.ns=function(t,e,n){return function(t){return M.j(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.ss(t,e.path):fn(e)?this.rs(t,e,n):this.os(t,e,n)},t.prototype.ss=function(t,e){return this.Hn(t,new M(e)).next((function(t){var e=ct();return t instanceof rn&&(e=e.st(t.key,t)),e}))},t.prototype.rs=function(t,e,n){var r=this,i=e.collectionGroup,o=ct();return this.zn.hs(t,i).next((function(s){return Fn.forEach(s,(function(s){var u=e.on(s.child(i));return r.os(t,u,n).next((function(t){t.forEach((function(t,e){o=o.st(t,e)}))}))})).next((function(){return o}))}))},t.prototype.os=function(t,e,n){var r,i,o=this;return this.Kn.ns(t,e,n).next((function(n){return r=n,o.Gn.as(t,e)})).next((function(e){return i=e,o.cs(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=je(a,h,h,o.Tn);r=f instanceof rn?r.st(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){bn(e,n)||(r=r.remove(t))})),r}))},t.prototype.cs=function(t,e,n){for(var r=lt(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof We&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Kn.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof rn&&(c=c.st(t,e))})),c}))},t}(),Hn=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.us=n,this.ls=r}return t._s=function(e,n){for(var r=lt(),i=lt(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Wn=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.fs=function(t){return n.ds(t)},this.ws=function(t){return e.Ts(t)})}return t.prototype.ds=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.ws&&this.ws(t),t},t}();Wn.Es=-1;var Kn=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Yn=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.ms=t,this.Is=e,this.As=n,this.Rs=r,this.Ps=i,this.gs=0,this.Vs=null,this.ys=Date.now(),this.reset()}return t.prototype.reset=function(){this.gs=0},t.prototype.ps=function(){this.gs=this.Ps},t.prototype.bs=function(t){var e=this;this.cancel();var n=Math.floor(this.gs+this.vs()),r=Math.max(0,Date.now()-this.ys),i=Math.max(0,n-r);i>0&&l("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.gs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Vs=this.ms.Ss(this.Is,i,(function(){return e.ys=Date.now(),t()})),this.gs*=this.Rs,this.gs<this.As&&(this.gs=this.As),this.gs>this.Ps&&(this.gs=this.Ps)},t.prototype.Ds=function(){null!==this.Vs&&(this.Vs.Cs(),this.Vs=null)},t.prototype.cancel=function(){null!==this.Vs&&(this.Vs.cancel(),this.Vs=null)},t.prototype.vs=function(){return(Math.random()-.5)*this.gs},t}(),Xn=function(){function e(t,n,r){this.name=t,this.version=n,this.Ns=r,12.2===e.Fs(i.getUA())&&d("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return l("SimpleDb","Removing database:",t),nr(window.indexedDB.deleteDatabase(t)).Sn()},e.ks=function(){if("undefined"==typeof indexedDB)return!1;if(e.$s())return!0;var t=i.getUA(),n=e.Fs(t),r=0<n&&n<10,o=e.xs(t),s=0<o&&o<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)},e.$s=function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Os)},e.Ms=function(t,e){return t.store(e)},e.Fs=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.xs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.Ls=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e=this;return o.__generator(this,(function(n){switch(n.label){case 0:return this.db?[3,2]:(l("SimpleDb","Opening database:",this.name),t=this,[4,new Promise((function(t,n){var r=indexedDB.open(e.name,e.version);r.onsuccess=function(e){var n=e.target.result;t(n)},r.onblocked=function(){n(new Zn("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){var e=t.target.error;"VersionError"===e.name?n(new L(k.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Zn(e))},r.onupgradeneeded=function(t){l("SimpleDb",'Database "'+e.name+'" requires upgrade from version:',t.oldVersion);var n=t.target.result;e.Ns.createOrUpgrade(n,r.transaction,t.oldVersion,e.version).next((function(){l("SimpleDb","Database upgrade to version "+e.version+" complete")}))}}))]);case 1:t.db=n.sent(),n.label=2;case 2:return[2,(this.qs&&(this.db.onversionchange=function(t){return e.qs(t)}),this.db)]}}))}))},e.prototype.Bs=function(t){this.qs=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},e.prototype.runTransaction=function(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var i,r,s,u,a;return o.__generator(this,(function(c){switch(c.label){case 0:i="readonly"===t,r=0,s=function(){var t,s,a,c,h;return o.__generator(this,(function(o){switch(o.label){case 0:++r,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,u.Ls()];case 2:return u.db=o.sent(),t=$n.open(u.db,i?"readonly":"readwrite",e),s=n(t).catch((function(e){return t.abort(e),Fn.reject(e)})).Sn(),a={},s.catch((function(){})),[4,t.Us];case 3:return[2,(a.value=(o.sent(),s),a)];case 4:return c=o.sent(),h="FirebaseError"!==c.name&&r<3,l("SimpleDb","Transaction failed with error: %s. Retrying: %s.",c.message,h),u.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},u=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(a=c.sent()))return[2,a.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),Qn=function(){function t(t){this.Qs=t,this.Ws=!1,this.js=null}return Object.defineProperty(t.prototype,"yn",{get:function(){return this.Ws},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ks",{get:function(){return this.js},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Qs=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Ws=!0},t.prototype.Gs=function(t){this.js=t},t.prototype.delete=function(){return nr(this.Qs.delete())},t}(),Zn=function(t){function e(e){var n=this;return(n=t.call(this,k.UNAVAILABLE,"IndexedDB transaction failed: "+e)||this).name="IndexedDbTransactionError",n}return o.__extends(e,t),e}(L);function Jn(t){return"IndexedDbTransactionError"===t.name}var $n=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.zs=new Kn,this.transaction.oncomplete=function(){e.zs.resolve()},this.transaction.onabort=function(){t.error?e.zs.reject(new Zn(t.error)):e.zs.resolve()},this.transaction.onerror=function(t){var n=tr(t.target.error);e.zs.reject(new Zn(n))}}return t.open=function(e,n,r){try{return new t(e.transaction(r,n))}catch(e){throw new Zn(e)}},Object.defineProperty(t.prototype,"Us",{get:function(){return this.zs.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.zs.reject(t),this.aborted||(l("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new er(e)},t}(),er=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(l("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(l("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),nr(n)},t.prototype.add=function(t){return l("SimpleDb","ADD",this.store.name,t,t),nr(this.store.add(t))},t.prototype.get=function(t){var e=this;return nr(this.store.get(t)).next((function(n){return void 0===n&&(n=null),l("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return l("SimpleDb","DELETE",this.store.name,t),nr(this.store.delete(t))},t.prototype.count=function(){return l("SimpleDb","COUNT",this.store.name),nr(this.store.count())},t.prototype.Hs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ys(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Js=function(t,e){l("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Xs=!1;var r=this.cursor(n);return this.Ys(r,(function(t,e,n){return n.delete()}))},t.prototype.Zs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ys(r,e)},t.prototype.ti=function(t){var e=this.cursor({});return new Fn((function(n,r){e.onerror=function(t){var e=tr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.Ys=function(t,e){var n=[];return new Fn((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Qn(i),s=e(i.primaryKey,i.value,o);if(s instanceof Fn){var u=s.catch((function(t){return o.done(),Fn.reject(t)}));n.push(u)}o.yn?r():null===o.Ks?i.continue():i.continue(o.Ks)}else r()}})).next((function(){return Fn.Cn(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Xs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function nr(t){return new Fn((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=tr(t.target.error);n(e)}}))}var rr=!1;function tr(t){var e=Xn.Fs(i.getUA());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new L("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return rr||(rr=!0,setTimeout((function(){throw r}),0)),r}}return t}function ir(){return"undefined"!=typeof window?window:null}function or(){return"undefined"!=typeof document?document:null}var sr=function(){function t(t,e,n,r,i){this.ei=t,this.Is=e,this.ni=n,this.op=r,this.si=i,this.ii=new Kn,this.then=this.ii.promise.then.bind(this.ii.promise),this.ii.promise.catch((function(t){}))}return t.ri=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.oi=setTimeout((function(){return e.hi()}),t)},t.prototype.Cs=function(){return this.hi()},t.prototype.cancel=function(t){null!==this.oi&&(this.clearTimeout(),this.ii.reject(new L(k.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.hi=function(){var t=this;this.ei.ai((function(){return null!==t.oi?(t.clearTimeout(),t.op().then((function(e){return t.ii.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.oi&&(this.si(this),clearTimeout(this.oi),this.oi=null)},t}(),ur=function(){function t(){var t=this;this.ci=Promise.resolve(),this.ui=[],this.li=!1,this._i=[],this.fi=null,this.di=!1,this.wi=[],this.Ti=new Yn(this,"async_queue_retry"),this.Ei=function(){var e=or();e&&l("AsyncQueue","Visibility state changed to  ",e.visibilityState),t.Ti.Ds()};var e=or();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ei)}return Object.defineProperty(t.prototype,"mi",{get:function(){return this.li},enumerable:!1,configurable:!0}),t.prototype.ai=function(t){this.enqueue(t)},t.prototype.Ii=function(t){this.Ai(),this.Ri(t)},t.prototype.Pi=function(){if(!this.li){this.li=!0;var t=or();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ei)}},t.prototype.enqueue=function(t){return this.Ai(),this.li?new Promise((function(t){})):this.Ri(t)},t.prototype.gi=function(t){var e=this;this.ui.push(t),this.ai((function(){return e.Vi()}))},t.prototype.Vi=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e=this;return o.__generator(this,(function(n){switch(n.label){case 0:if(0===this.ui.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.ui[0]()];case 2:return n.sent(),this.ui.shift(),this.Ti.reset(),[3,4];case 3:if(!Jn(t=n.sent()))throw t;return l("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.ui.length>0&&this.Ti.bs((function(){return e.Vi()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Ri=function(t){var e=this,n=this.ci.then((function(){return e.di=!0,t().catch((function(t){throw e.fi=t,e.di=!1,d("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.di=!1,t}))}));return this.ci=n,n},t.prototype.Ss=function(t,e,n){var r=this;this.Ai(),this.wi.indexOf(t)>-1&&(e=0);var i=sr.ri(this,t,e,n,(function(t){return r.yi(t)}));return this._i.push(i),i},t.prototype.Ai=function(){this.fi&&p()},t.prototype.pi=function(){},t.prototype.bi=function(){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(e){switch(e.label){case 0:return[4,t=this.ci];case 1:e.sent(),e.label=2;case 2:if(t!==this.ci)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.vi=function(t){for(var e=0,n=this._i;e<n.length;e++)if(n[e].Is===t)return!0;return!1},t.prototype.Si=function(t){var e=this;return this.bi().then((function(){e._i.sort((function(t,e){return t.ni-e.ni}));for(var n=0,r=e._i;n<r.length;n++){var i=r[n];if(i.Cs(),"all"!==t&&i.Is===t)break}return e.bi()}))},t.prototype.Di=function(t){this.wi.push(t)},t.prototype.yi=function(t){var e=this._i.indexOf(t);this._i.splice(e,1)},t}();function ar(t,e){if(d("AsyncQueue",e+": "+t),Jn(t))return new L(k.UNAVAILABLE,e+": "+t);throw t}function cr(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=I(n,i);return 0===s?I(r,o):s}var fr=function(){function t(t){this.Ci=t,this.buffer=new it(cr),this.Ni=0}return t.prototype.Fi=function(){return++this.Ni},t.prototype.ki=function(t){var e=[t,this.Fi()];if(this.buffer.size<this.Ci)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();cr(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),lr={$i:!1,xi:0,Oi:0,Mi:0},pr=function(){function t(t,e,n){this.Li=t,this.qi=e,this.Bi=n}return t.Ui=function(e){return new t(e,t.Qi,t.Wi)},t}();pr.ji=-1,pr.Ki=1048576,pr.Gi=41943040,pr.Qi=10,pr.Wi=1e3,pr.zi=new pr(pr.Gi,pr.Qi,pr.Wi),pr.Hi=new pr(pr.ji,0,0);var hr=function(){function t(t,e){this.Yi=t,this.ei=e,this.Ji=!1,this.Xi=null}return t.prototype.start=function(t){this.Yi.params.Li!==pr.ji&&this.Zi(t)},t.prototype.stop=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},Object.defineProperty(t.prototype,"tr",{get:function(){return null!==this.Xi},enumerable:!1,configurable:!0}),t.prototype.Zi=function(t){var e=this,n=this.Ji?3e5:6e4;l("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.Xi=this.ei.Ss("lru_garbage_collection",n,(function(){return o.__awaiter(e,void 0,void 0,(function(){var e;return o.__generator(this,(function(n){switch(n.label){case 0:this.Xi=null,this.Ji=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.er(this.Yi)];case 2:return n.sent(),[3,7];case 3:return Jn(e=n.sent())?(l("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,xi(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.Zi(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),dr=function(){function t(t,e){this.nr=t,this.params=e}return t.prototype.sr=function(t,e){return this.nr.ir(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.rr=function(t,e){var n=this;if(0===e)return Fn.resolve(Wn.Es);var r=new fr(e);return this.nr.be(t,(function(t){return r.ki(t.sequenceNumber)})).next((function(){return n.nr.or(t,(function(t){return r.ki(t)}))})).next((function(){return r.maxValue}))},t.prototype.hr=function(t,e,n){return this.nr.hr(t,e,n)},t.prototype.ar=function(t,e){return this.nr.ar(t,e)},t.prototype.cr=function(t,e){var n=this;return this.params.Li===pr.ji?(l("LruGarbageCollector","Garbage collection skipped; disabled"),Fn.resolve(lr)):this.ur(t).next((function(r){return r<n.params.Li?(l("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Li),lr):n.lr(t,e)}))},t.prototype.ur=function(t){return this.nr.ur(t)},t.prototype.lr=function(t,e){var n,i,r,s,u,o,c,f=this,p=Date.now();return this.sr(t,this.params.qi).next((function(e){return e>f.params.Bi?(l("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+f.params.Bi+" from "+e),i=f.params.Bi):i=e,s=Date.now(),f.rr(t,i)})).next((function(r){return n=r,u=Date.now(),f.hr(t,n,e)})).next((function(e){return r=e,o=Date.now(),f.ar(t,n)})).next((function(t){return c=Date.now(),a()<=h.LogLevel.DEBUG&&l("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-p)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+r+" targets in "+(o-u)+"ms\n\tRemoved "+t+" documents in "+(c-o)+"ms\nTotal Duration: "+(c-p)+"ms"),Fn.resolve({$i:!0,xi:i,Oi:r,Mi:t})}))},t}();function vr(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=gr(e)),e=yr(t.get(n),e);return gr(e)}function yr(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function gr(t){return t+""}function mr(t){var e=t.length;if(m(e>=2),2===e)return m(""===t.charAt(0)&&""===t.charAt(1)),C.$();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&p(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:p()}o=s+2}return new C(r)}var wr=function(t){this._r=t};function _r(t,e){if(e.document)return function(t,e,n){var r=ie(t,e.name),i=te(e.updateTime),o=new $e({mapValue:{fields:e.fields}});return new rn(r,i,o,{hasCommittedMutations:!!n})}(t._r,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=M.K(e.noDocument.path),r=Ar(e.noDocument.readTime);return new on(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=M.K(e.unknownDocument.path),o=Ar(e.unknownDocument.version);return new sn(i,o)}return p()}function Ir(t,e,n){var r=Er(n),i=e.key.path.p().N();if(e instanceof rn){var o=function(t,e){return{name:re(t,e.key),fields:e.tn().mapValue.fields,updateTime:Zt(t,e.version.A())}}(t._r,e),s=e.hasCommittedMutations;return new Qr(null,null,o,s,r,i)}if(e instanceof on){var u=e.key.path.N(),a=br(e.version),c=e.hasCommittedMutations;return new Qr(null,new Yr(u,a),null,c,r,i)}if(e instanceof sn){var h=e.key.path.N(),f=br(e.version);return new Qr(new Xr(h,f),null,null,!0,r,i)}return p()}function Er(t){var e=t.A();return[e.seconds,e.nanoseconds]}function Tr(t){var e=new P(t[0],t[1]);return R.m(e)}function br(t){var e=t.A();return new Br(e.seconds,e.nanoseconds)}function Ar(t){var e=new P(t.seconds,t.nanoseconds);return R.m(e)}function Nr(t,e){var n=(e.baseMutations||[]).map((function(e){return fe(t._r,e)})),r=e.mutations.map((function(e){return fe(t._r,e)})),i=P.fromMillis(e.localWriteTimeMs);return new Mn(e.batchId,i,n,r)}function Sr(t){var e,n,r=Ar(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ar(t.lastLimboFreeSnapshotVersion):R.min();return void 0!==t.query.documents?(m(1===(n=t.query).documents.length),e=pn(hn(se(n.documents[0])))):e=function(t){var e=se(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){m(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[we(e)]:void 0!==e.fieldFilter?[me(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):p():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return new Cn(ge((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var a=null;n.limit&&(a=function(t){var e;return F(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ve(n.startAt));var h=null;return n.endAt&&(h=ve(n.endAt)),pn(cn(e,i,u,s,a,"F",c,h))}(t.query),new Q(e,t.targetId,0,t.lastListenSequenceNumber,r,i,K.fromBase64String(t.resumeToken))}function Dr(t,e){var n,r=br(e.Z),i=br(e.lastLimboFreeSnapshotVersion);n=W(e.target)?le(t._r,e.target):pe(t._r,e.target);var o=e.resumeToken.toBase64();return new Jr(e.targetId,z(e.target),r,o,e.sequenceNumber,i,n)}var xr=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.zn=n,this.dr=r,this.wr={}}return t.Tr=function(e,n,r,i){return m(""!==e.uid),new t(e.Er()?e.uid:"",n,r,i)},t.prototype.mr=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Pr(t).Zs({index:Wr.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Ir=function(t,e,n,r){var i=this,o=Rr(t),s=Pr(t);return s.add({}).next((function(u){m("number"==typeof u);for(var a=new Mn(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return he(t._r,e)})),i=n.mutations.map((function(e){return he(t._r,e)}));return new Wr(e,n.batchId,n.Tn.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new it((function(t,e){return I(t.F(),e.F())})),l=0,p=r;l<p.length;l++){var d=p[l],v=Kr.key(i.userId,d.key.path,u);f=f.add(d.key.path.p()),h.push(s.put(c)),h.push(o.put(v,Kr.PLACEHOLDER))}return f.forEach((function(e){h.push(i.zn.Ar(t,e))})),t.Wn((function(){i.wr[u]=a.keys()})),Fn.Cn(h).next((function(){return a}))}))},t.prototype.Rr=function(t,e){var n=this;return Pr(t).get(e).next((function(t){return t?(m(t.userId===n.userId),Nr(n.serializer,t)):null}))},t.prototype.Pr=function(t,e){var n=this;return this.wr[e]?Fn.resolve(this.wr[e]):this.Rr(t,e).next((function(t){if(t){var r=t.keys();return n.wr[e]=r,r}return null}))},t.prototype.gr=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Pr(t).Zs({index:Wr.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(m(e.batchId>=r),o=Nr(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.Vr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Pr(t).Zs({index:Wr.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.yr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Pr(t).Hs(Wr.userMutationsIndex,n).next((function(t){return t.map((function(t){return Nr(e.serializer,t)}))}))},t.prototype.Yn=function(t,e){var n=this,r=Kr.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Rr(t).Zs({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=mr(a);if(u===n.userId&&e.path.isEqual(h))return Pr(t).get(c).next((function(t){if(!t)throw p();m(t.userId===n.userId),o.push(Nr(n.serializer,t))}));s.done()})).next((function(){return o}))},t.prototype.es=function(t,e){var n=this,r=new it(I),i=[];return e.forEach((function(e){var o=Kr.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Rr(t).Zs({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=mr(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),Fn.Cn(i).next((function(){return n.pr(t,r)}))},t.prototype.as=function(t,e){var n=this,r=e.path,i=r.length+1,o=Kr.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new it(I);return Rr(t).Zs({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=mr(a);s===n.userId&&r.D(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.pr(t,u)}))},t.prototype.pr=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Pr(t).get(e).next((function(t){if(null===t)throw p();m(t.userId===n.userId),r.push(Nr(n.serializer,t))})))})),Fn.Cn(i).next((function(){return r}))},t.prototype.br=function(t,e){var n=this;return Lr(t.vr,this.userId,e).next((function(r){return t.Wn((function(){n.Sr(e.batchId)})),Fn.forEach(r,(function(e){return n.dr.Dr(t,e)}))}))},t.prototype.Sr=function(t){delete this.wr[t]},t.prototype.Cr=function(t){var e=this;return this.mr(t).next((function(n){if(!n)return Fn.resolve();var r=IDBKeyRange.lowerBound(Kr.prefixForUser(e.userId)),i=[];return Rr(t).Zs({range:r},(function(t,n,r){if(t[0]===e.userId){var o=mr(t[1]);i.push(o)}else r.done()})).next((function(){m(0===i.length)}))}))},t.prototype.Nr=function(t,e){return kr(t,this.userId,e)},t.prototype.Fr=function(t){var e=this;return Or(t).get(this.userId).next((function(t){return t||new Hr(e.userId,-1,"")}))},t}();function kr(t,e,n){var r=Kr.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Rr(t).Zs({range:o,Xs:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function Lr(t,e,n){var r=t.store(Wr.store),i=t.store(Kr.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Zs({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){m(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Kr.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Fn.Cn(o).next((function(){return c}))}function Pr(t){return vi.Ms(t,Wr.store)}function Rr(t){return vi.Ms(t,Kr.store)}function Or(t){return vi.Ms(t,Hr.store)}var Cr=function(){function t(t,e){this.serializer=t,this.zn=e}return t.prototype.xn=function(t,e,n){return Vr(t).put(Mr(e),n)},t.prototype.Mn=function(t,e){var n=Vr(t),r=Mr(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.kr(t,r)}))},t.prototype.Ln=function(t,e){var n=this;return Vr(t).get(Mr(e)).next((function(t){return n.$r(t)}))},t.prototype.xr=function(t,e){var n=this;return Vr(t).get(Mr(e)).next((function(t){var e=n.$r(t);return e?{Or:e,size:qr(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=ut();return this.Mr(t,e,(function(t,e){var i=n.$r(e);r=r.st(t,i)})).next((function(){return r}))},t.prototype.Lr=function(t,e){var n=this,r=ut(),i=new tt(M.P);return this.Mr(t,e,(function(t,e){var o=n.$r(e);o?(r=r.st(t,o),i=i.st(t,qr(e))):(r=r.st(t,null),i=i.st(t,0))})).next((function(){return{qr:r,Br:i}}))},t.prototype.Mr=function(t,e,n){if(e._())return Fn.resolve();var r=IDBKeyRange.bound(e.first().path.N(),e.last().path.N()),i=e.ct(),o=i.wt();return Vr(t).Zs({range:r},(function(t,e,r){for(var s=M.K(t);o&&M.P(o,s)<0;)n(o,null),o=i.wt();o&&o.isEqual(s)&&(n(o,e),o=i.Tt()?i.wt():null),o?r.Gs(o.path.N()):r.done()})).next((function(){for(;o;)n(o,null),o=i.Tt()?i.wt():null}))},t.prototype.ns=function(t,e,n){var r=this,i=ct(),o=e.path.length+1,s={};if(n.isEqual(R.min())){var u=e.path.N();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.N(),c=Er(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Qr.collectionReadTimeIndex}return Vr(t).Zs(s,(function(t,n,s){if(t.length===o){var u=_r(r.serializer,n);e.path.D(u.key.path)?u instanceof rn&&bn(e,u)&&(i=i.st(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.Ur=function(t,e){var n=this,r=rt(),i=Er(e),o=Vr(t),s=IDBKeyRange.lowerBound(i,!0);return o.Zs({index:Qr.readTimeIndex,range:s},(function(t,e){var o=_r(n.serializer,e);r=r.st(o.key,o),i=e.readTime})).next((function(){return{Qr:r,readTime:Tr(i)}}))},t.prototype.Wr=function(t){var e=Vr(t),n=R.min();return e.Zs({index:Qr.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Tr(e.readTime)),r.done()})).next((function(){return n}))},t.prototype.jr=function(e){return new t.Kr(this,!!e&&e.Gr)},t.prototype.zr=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Ur(t).get(Zr.key).next((function(t){return m(!!t),t}))},t.prototype.kr=function(t,e){return Ur(t).put(Zr.key,e)},t.prototype.$r=function(t){if(t){var e=_r(this.serializer,t);return e instanceof on&&e.version.isEqual(R.min())?null:e}return null},t}();function Ur(t){return vi.Ms(t,Zr.store)}function Vr(t){return vi.Ms(t,Qr.store)}function Mr(t){return t.path.N()}function qr(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw p();e=t.noDocument}return JSON.stringify(e).length}Cr.Kr=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Hr=e,r.Gr=n,r.Yr=new x((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return o.__extends(e,t),e.prototype.Un=function(t){var e=this,n=[],r=0,i=new it((function(t,e){return I(t.F(),e.F())}));return this.Fn.forEach((function(o,s){var u=e.Yr.get(o);if(s){var a=Ir(e.Hr.serializer,s,e.readTime);i=i.add(o.path.p());var c=qr(a);r+=c-u,n.push(e.Hr.xn(t,o,a))}else if(r-=u,e.Gr){var h=Ir(e.Hr.serializer,new on(o,R.min()),e.readTime);n.push(e.Hr.xn(t,o,h))}else n.push(e.Hr.Mn(t,o))})),i.forEach((function(r){n.push(e.Hr.zn.Ar(t,r))})),n.push(this.Hr.updateMetadata(t,r)),Fn.Cn(n)},e.prototype.qn=function(t,e){var n=this;return this.Hr.xr(t,e).next((function(t){return null===t?(n.Yr.set(e,0),null):(n.Yr.set(e,t.size),t.Or)}))},e.prototype.Bn=function(t,e){var n=this;return this.Hr.Lr(t,e).next((function(t){var e=t.qr;return t.Br.forEach((function(t,e){n.Yr.set(t,e)})),e}))},e}(jn);var Fr=function(){function t(){this.Jr=new jr}return t.prototype.Ar=function(t,e){return this.Jr.add(e),Fn.resolve()},t.prototype.hs=function(t,e){return Fn.resolve(this.Jr.getEntries(e))},t}(),jr=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new it(C.P),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new it(C.P)).N()},t}(),Gr=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;m(n<r&&n>=0&&r<=10);var o=new $n(e);n<1&&r>=1&&(function(t){t.createObjectStore(zr.store)}(t),function(t){t.createObjectStore(Hr.store,{keyPath:Hr.keyPath}),t.createObjectStore(Wr.store,{keyPath:Wr.keyPath,autoIncrement:!0}).createIndex(Wr.userMutationsIndex,Wr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Kr.store)}(t),ni(t),function(t){t.createObjectStore(Qr.store)}(t));var s=Fn.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore($r.store),t.deleteObjectStore(Jr.store),t.deleteObjectStore(ti.store)}(t),ni(t)),s=s.next((function(){return function(t){var e=t.store(ti.store),n=new ti(0,0,R.min().A(),0);return e.put(ti.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Wr.store).Hs().next((function(n){t.deleteObjectStore(Wr.store),t.createObjectStore(Wr.store,{keyPath:Wr.keyPath,autoIncrement:!0}).createIndex(Wr.userMutationsIndex,Wr.userMutationsKeyPath,{unique:!0});var r=e.store(Wr.store),i=n.map((function(t){return r.put(t)}));return Fn.Cn(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(ri.store,{keyPath:ri.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Zr.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Qr.store);e.createIndex(Qr.readTimeIndex,Qr.readTimeIndexPath,{unique:!1}),e.createIndex(Qr.collectionReadTimeIndex,Qr.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Qr.store).Zs((function(t,n){e+=qr(n)})).next((function(){var n=new Zr(e);return t.store(Zr.store).put(Zr.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Hr.store),r=t.store(Wr.store);return n.Hs().next((function(n){return Fn.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Hs(Wr.userMutationsIndex,i).next((function(r){return Fn.forEach(r,(function(r){m(r.userId===n.userId);var i=Nr(e.serializer,r);return Lr(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store($r.store),n=t.store(Qr.store);return t.store(ti.store).get(ti.key).next((function(t){var r=[];return n.Zs((function(n,i){var o=new C(n),s=function(t){return[0,vr(t)]}(o);r.push(e.get(s).next((function(n){return n?Fn.resolve():function(n){return e.put(new $r(0,vr(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Fn.Cn(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(ei.store,{keyPath:ei.keyPath});var n=e.store(ei.store),r=new jr,i=function(t){if(r.add(t)){var e=t.S(),i=t.p();return n.put({collectionId:e,parent:vr(i)})}};return e.store(Qr.store).Zs({Xs:!0},(function(t,e){var n=new C(t);return i(n.p())})).next((function(){return e.store(Kr.store).Zs({Xs:!0},(function(t,e){t[0];var n=t[1],r=(t[2],mr(n));return i(r.p())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Jr.store);return n.Zs((function(t,r){var i=Sr(r),o=Dr(e.serializer,i);return n.put(o)}))},t}(),Br=function(t,e){this.seconds=t,this.nanoseconds=e},zr=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};zr.store="owner",zr.key="owner";var Hr=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Hr.store="mutationQueues",Hr.keyPath="userId";var Wr=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Wr.store="mutations",Wr.keyPath="batchId",Wr.userMutationsIndex="userMutationsIndex",Wr.userMutationsKeyPath=["userId","batchId"];var Kr=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,vr(e)]},t.key=function(t,e,n){return[t,vr(e),n]},t}();Kr.store="documentMutations",Kr.PLACEHOLDER=new Kr;var Yr=function(t,e){this.path=t,this.readTime=e},Xr=function(t,e){this.path=t,this.version=e},Qr=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Qr.store="remoteDocuments",Qr.readTimeIndex="readTimeIndex",Qr.readTimeIndexPath="readTime",Qr.collectionReadTimeIndex="collectionReadTimeIndex",Qr.collectionReadTimeIndexPath=["parentPath","readTime"];var Zr=function(t){this.byteSize=t};Zr.store="remoteDocumentGlobal",Zr.key="remoteDocumentGlobalKey";var Jr=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Jr.store="targets",Jr.keyPath="targetId",Jr.queryTargetsIndexName="queryTargetsIndex",Jr.queryTargetsKeyPath=["canonicalId","targetId"];var $r=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};$r.store="targetDocuments",$r.keyPath=["targetId","path"],$r.documentTargetsIndex="documentTargetsIndex",$r.documentTargetsKeyPath=["path","targetId"];var ti=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ti.key="targetGlobalKey",ti.store="targetGlobal";var ei=function(t,e){this.collectionId=t,this.parent=e};function ni(t){t.createObjectStore($r.store,{keyPath:$r.keyPath}).createIndex($r.documentTargetsIndex,$r.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Jr.store,{keyPath:Jr.keyPath}).createIndex(Jr.queryTargetsIndexName,Jr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ti.store)}ei.store="collectionParents",ei.keyPath=["collectionId","parent"];var ri=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ri.store="clientMetadata",ri.keyPath="clientId";var ii=o.__spreadArrays(o.__spreadArrays(o.__spreadArrays([Hr.store,Wr.store,Kr.store,Qr.store,Jr.store,zr.store,ti.store,$r.store],[ri.store]),[Zr.store]),[ei.store]),oi=function(){function t(){this.Xr=new jr}return t.prototype.Ar=function(t,e){var n=this;if(!this.Xr.has(e)){var r=e.S(),i=e.p();t.Wn((function(){n.Xr.add(e)}));var o={collectionId:r,parent:vr(i)};return si(t).put(o)}return Fn.resolve()},t.prototype.hs=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[T(e),""],!1,!0);return si(t).Hs(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(mr(o.parent))}return n}))},t}();function si(t){return vi.Ms(t,ei.store)}var ui=function(){function t(t){this.Zr=t}return t.prototype.next=function(){return this.Zr+=2,this.Zr},t.to=function(){return new t(0)},t.eo=function(){return new t(-1)},t}(),ai=function(){function t(t,e){this.dr=t,this.serializer=e}return t.prototype.no=function(t){var e=this;return this.so(t).next((function(n){var r=new ui(n.highestTargetId);return n.highestTargetId=r.next(),e.io(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.ro=function(t){return this.so(t).next((function(t){return R.m(new P(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.oo=function(t){return this.so(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.ho=function(t,e,n){var r=this;return this.so(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.A()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.io(t,i)}))},t.prototype.ao=function(t,e){var n=this;return this.co(t,e).next((function(){return n.so(t).next((function(r){return r.targetCount+=1,n.uo(e,r),n.io(t,r)}))}))},t.prototype.lo=function(t,e){return this.co(t,e)},t.prototype._o=function(t,e){var n=this;return this.fo(t,e.targetId).next((function(){return ci(t).delete(e.targetId)})).next((function(){return n.so(t)})).next((function(e){return m(e.targetCount>0),e.targetCount-=1,n.io(t,e)}))},t.prototype.hr=function(t,e,n){var r=this,i=0,o=[];return ci(t).Zs((function(s,u){var a=Sr(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r._o(t,a)))})).next((function(){return Fn.Cn(o)})).next((function(){return i}))},t.prototype.be=function(t,e){return ci(t).Zs((function(t,n){var r=Sr(n);e(r)}))},t.prototype.so=function(t){return hi(t).get(ti.key).next((function(t){return m(null!==t),t}))},t.prototype.io=function(t,e){return hi(t).put(ti.key,e)},t.prototype.co=function(t,e){return ci(t).put(Dr(this.serializer,e))},t.prototype.uo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.do=function(t){return this.so(t).next((function(t){return t.targetCount}))},t.prototype.wo=function(t,e){var n=z(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return ci(t).Zs({range:r,index:Jr.queryTargetsIndexName},(function(t,n,r){var o=Sr(n);H(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.To=function(t,e,n){var r=this,i=[],o=fi(t);return e.forEach((function(e){var s=vr(e.path);i.push(o.put(new $r(n,s))),i.push(r.dr.Eo(t,n,e))})),Fn.Cn(i)},t.prototype.mo=function(t,e,n){var r=this,i=fi(t);return Fn.forEach(e,(function(e){var o=vr(e.path);return Fn.Cn([i.delete([n,o]),r.dr.Io(t,n,e)])}))},t.prototype.fo=function(t,e){var n=fi(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.Ao=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=fi(t),i=lt();return r.Zs({range:n,Xs:!0},(function(t,e,n){var r=mr(t[1]),o=new M(r);i=i.add(o)})).next((function(){return i}))},t.prototype.Nr=function(t,e){var n=vr(e.path),r=IDBKeyRange.bound([n],[T(n)],!1,!0),i=0;return fi(t).Zs({index:$r.documentTargetsIndex,Xs:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Me=function(t,e){return ci(t).get(e).next((function(t){return t?Sr(t):null}))},t}();function ci(t){return vi.Ms(t,Jr.store)}function hi(t){return vi.Ms(t,ti.store)}function fi(t){return vi.Ms(t,$r.store)}var pi="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",di=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).vr=e,r.Ro=n,r}return o.__extends(e,t),e}(Bn),vi=function(){function t(e,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.ms=o,this.window=s,this.document=u,this.Po=c,this.Vo=h,this.yo=null,this.po=!1,this.isPrimary=!1,this.networkEnabled=!0,this.bo=null,this.inForeground=!1,this.vo=null,this.So=null,this.Do=Number.NEGATIVE_INFINITY,this.Co=function(t){return Promise.resolve()},!t.ks())throw new L(k.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.dr=new gi(this,i),this.No=n+"main",this.serializer=new wr(a),this.Fo=new Xn(this.No,10,new Gr(this.serializer)),this.ko=new ai(this.dr,this.serializer),this.zn=new oi,this.Kn=new Cr(this.serializer,this.zn),this.window&&this.window.localStorage?this.$o=this.window.localStorage:(this.$o=null,!1===h&&d("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.Ms=function(t,e){if(t instanceof di)return Xn.Ms(t.vr,e);throw p()},t.prototype.start=function(){var t=this;return this.xo().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new L(k.FAILED_PRECONDITION,pi);return t.Oo(),t.Mo(),t.Lo(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.ko.oo(e)}))})).then((function(e){t.yo=new Wn(e,t.Po)})).then((function(){t.po=!0})).catch((function(e){return t.Fo&&t.Fo.close(),Promise.reject(e)}))},t.prototype.qo=function(t){var e=this;return this.Co=function(n){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(e){return this.tr?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.Bo=function(t){var e=this;this.Fo.Bs((function(n){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.Uo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.ms.ai((function(){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.tr?[4,this.xo()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.xo=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return yi(e).put(new ri(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Qo(e).next((function(e){e||(t.isPrimary=!1,t.ms.gi((function(){return t.Co(!1)})))}))})).next((function(){return t.Wo(e)})).next((function(n){return t.isPrimary&&!n?t.jo(e).next((function(){return!1})):!!n&&t.Ko(e).next((function(){return!0}))}))})).catch((function(e){if(Jn(e))return l("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return l("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.ms.gi((function(){return t.Co(e)})),t.isPrimary=e}))},t.prototype.Qo=function(t){var e=this;return li(t).get(zr.key).next((function(t){return Fn.resolve(e.Go(t))}))},t.prototype.zo=function(t){return yi(t).delete(this.clientId)},t.prototype.Ho=function(){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,r,s=this;return o.__generator(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.Yo(this.Do,18e5)?[3,2]:(this.Do=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.Ms(e,ri.store);return n.Hs().next((function(t){var e=s.Jo(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return Fn.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(e=o.sent(),this.$o)for(n=0,i=e;n<i.length;n++)r=i[n],this.$o.removeItem(this.Xo(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.Lo=function(){var t=this;this.So=this.ms.Ss("client_metadata_refresh",4e3,(function(){return t.xo().then((function(){return t.Ho()})).then((function(){return t.Lo()}))}))},t.prototype.Go=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Wo=function(t){var e=this;return this.Vo?Fn.resolve(!0):li(t).get(zr.key).next((function(n){if(null!==n&&e.Yo(n.leaseTimestampMs,5e3)&&!e.Zo(n.ownerId)){if(e.Go(n)&&e.networkEnabled)return!0;if(!e.Go(n)){if(!n.allowTabSynchronization)throw new L(k.FAILED_PRECONDITION,pi);return!1}}return!(!e.networkEnabled||!e.inForeground)||yi(t).Hs().next((function(t){return void 0===e.Jo(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&l("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.th=function(){return o.__awaiter(this,void 0,void 0,(function(){var t=this;return o.__generator(this,(function(e){switch(e.label){case 0:return this.po=!1,this.eh(),this.So&&(this.So.cancel(),this.So=null),this.nh(),this.sh(),[4,this.Fo.runTransaction("readwrite",[zr.store,ri.store],(function(e){var n=new di(e,Wn.Es);return t.jo(n).next((function(){return t.zo(n)}))}))];case 1:return e.sent(),this.Fo.close(),this.ih(),[2]}}))}))},t.prototype.Jo=function(t,e){var n=this;return t.filter((function(t){return n.Yo(t.updateTimeMs,e)&&!n.Zo(t.clientId)}))},t.prototype.rh=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return yi(e).Hs().next((function(e){return t.Jo(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),t.prototype.oh=function(t){return xr.Tr(t,this.serializer,this.zn,this.dr)},t.prototype.hh=function(){return this.ko},t.prototype.ah=function(){return this.Kn},t.prototype.uh=function(){return this.zn},t.prototype.runTransaction=function(t,e,n){var r=this;l("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Fo.runTransaction(o,ii,(function(o){return i=new di(o,r.yo?r.yo.next():Wn.Es),"readwrite-primary"===e?r.Qo(i).next((function(t){return!!t||r.Wo(i)})).next((function(e){if(!e)throw d("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.ms.gi((function(){return r.Co(!1)})),new L(k.FAILED_PRECONDITION,Gn);return n(i)})).next((function(t){return r.Ko(i).next((function(){return t}))})):r.lh(i).next((function(){return n(i)}))})).then((function(t){return i.jn(),t}))},t.prototype.lh=function(t){var e=this;return li(t).get(zr.key).next((function(t){if(null!==t&&e.Yo(t.leaseTimestampMs,5e3)&&!e.Zo(t.ownerId)&&!e.Go(t)&&!(e.Vo||e.allowTabSynchronization&&t.allowTabSynchronization))throw new L(k.FAILED_PRECONDITION,pi)}))},t.prototype.Ko=function(t){var e=new zr(this.clientId,this.allowTabSynchronization,Date.now());return li(t).put(zr.key,e)},t.ks=function(){return Xn.ks()},t.prototype.jo=function(t){var e=this,n=li(t);return n.get(zr.key).next((function(t){return e.Go(t)?(l("IndexedDbPersistence","Releasing primary lease."),n.delete(zr.key)):Fn.resolve()}))},t.prototype.Yo=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(d("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Oo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.vo=function(){t.ms.ai((function(){return t.inForeground="visible"===t.document.visibilityState,t.xo()}))},this.document.addEventListener("visibilitychange",this.vo),this.inForeground="visible"===this.document.visibilityState)},t.prototype.nh=function(){this.vo&&(this.document.removeEventListener("visibilitychange",this.vo),this.vo=null)},t.prototype.Mo=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.bo=function(){e.eh(),e.ms.ai((function(){return e.th()}))},this.window.addEventListener("unload",this.bo))},t.prototype.sh=function(){this.bo&&(this.window.removeEventListener("unload",this.bo),this.bo=null)},t.prototype.Zo=function(t){var e;try{var n=null!==(null===(e=this.$o)||void 0===e?void 0:e.getItem(this.Xo(t)));return l("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return d("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.eh=function(){if(this.$o)try{this.$o.setItem(this.Xo(this.clientId),String(Date.now()))}catch(t){d("Failed to set zombie client id.",t)}},t.prototype.ih=function(){if(this.$o)try{this.$o.removeItem(this.Xo(this.clientId))}catch(t){}},t.prototype.Xo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function li(t){return vi.Ms(t,zr.store)}function yi(t){return vi.Ms(t,ri.store)}var gi=function(){function t(t,e){this.db=t,this.Yi=new dr(this,e)}return t.prototype.ir=function(t){var e=this._h(t);return this.db.hh().do(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype._h=function(t){var e=0;return this.or(t,(function(t){e++})).next((function(){return e}))},t.prototype.be=function(t,e){return this.db.hh().be(t,e)},t.prototype.or=function(t,e){return this.fh(t,(function(t,n){return e(n)}))},t.prototype.Eo=function(t,e,n){return mi(t,n)},t.prototype.Io=function(t,e,n){return mi(t,n)},t.prototype.hr=function(t,e,n){return this.db.hh().hr(t,e,n)},t.prototype.Dr=function(t,e){return mi(t,e)},t.prototype.dh=function(t,e){return function(t,e){var n=!1;return Or(t).ti((function(r){return kr(t,r,e).next((function(t){return t&&(n=!0),Fn.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.ar=function(t,e){var n=this,r=this.db.ah().jr(),i=[],o=0;return this.fh(t,(function(s,u){if(u<=e){var a=n.dh(t,s).next((function(e){if(!e)return o++,r.Ln(t,s).next((function(){return r.Mn(s),fi(t).delete([0,vr(s.path)])}))}));i.push(a)}})).next((function(){return Fn.Cn(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.tt(t.Ro);return this.db.hh().lo(t,n)},t.prototype.wh=function(t,e){return mi(t,e)},t.prototype.fh=function(t,e){var n,r=fi(t),i=Wn.Es;return r.Zs({index:$r.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==Wn.Es&&e(new M(mr(n)),i),i=u,n=s):i=Wn.Es})).next((function(){i!==Wn.Es&&e(new M(mr(n)),i)}))},t.prototype.ur=function(t){return this.db.ah().zr(t)},t}();function mi(t,e){return fi(t).put(function(t,e){return new $r(0,vr(t.path),e)}(e,t.Ro))}function wi(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var bi=function(){function t(t,e,n){this.persistence=t,this.Th=e,this.Eh=new tt(I),this.mh=new x((function(t){return z(t)}),H),this.Ih=R.min(),this.Gn=t.oh(n),this.Ah=t.ah(),this.ko=t.hh(),this.Rh=new zn(this.Ah,this.Gn,this.persistence.uh()),this.Th.Ph(this.Rh)}return t.prototype.er=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.cr(n,e.Eh)}))},t}();function _i(t,e){var n=w(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Ah.jr({Gr:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Fn.resolve();return o.forEach((function(t){s=s.next((function(){return r.Ln(e,t)})).next((function(e){var o=e,s=n.Pn.get(t);m(null!==s),(!o||o.version.o(s)<0)&&(o=i.En(t,o,n))&&r.xn(o,n.Rn)}))})),s.next((function(){return t.Gn.br(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.Gn.Cr(t)})).next((function(){return n.Rh.Zn(t,r)}))}))}function Ii(t){var e=w(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.ko.ro(t)}))}function Ei(t,e){var n=w(t),r=e.Z,i=n.Eh;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Ah.jr({Gr:!0});i=n.Eh;var s=[];e.Wt.forEach((function(e,o){var u=i.get(o);if(u){s.push(n.ko.mo(t,e.Zt,o).next((function(){return n.ko.To(t,e.Jt,o)})));var a=e.resumeToken;if(a.Y()>0){var c=u.et(a,r).tt(t.Ro);i=i.st(o,c),function(t,e,n){return m(e.resumeToken.Y()>0),0===t.resumeToken.Y()||e.Z.I()-t.Z.I()>=3e8||n.Jt.size+n.Xt.size+n.Zt.size>0}(u,c,e)&&s.push(n.ko.lo(t,c))}}}));var u=rt(),a=lt();if(e.Kt.forEach((function(t,e){a=a.add(t)})),s.push(o.getEntries(t,a).next((function(i){e.Kt.forEach((function(a,c){var h=i.get(a);c instanceof on&&c.version.isEqual(R.min())?(o.Mn(a,r),u=u.st(a,c)):null==h||c.version.o(h.version)>0||0===c.version.o(h.version)&&h.hasPendingWrites?(o.xn(c,r),u=u.st(a,c)):l("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version),e.Gt.has(a)&&s.push(n.persistence.dr.wh(t,a))}))}))),!r.isEqual(R.min())){var c=n.ko.ro(t).next((function(e){return n.ko.ho(t,t.Ro,r)}));s.push(c)}return Fn.Cn(s).next((function(){return o.apply(t)})).next((function(){return n.Rh.ts(t,u)}))})).then((function(t){return n.Eh=i,t}))}function Ti(t,e){var n=w(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.Gn.gr(t,e)}))}function Ai(t,e){var n=w(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.ko.wo(t,e).next((function(i){return i?(r=i,Fn.resolve(r)):n.ko.no(t).next((function(i){return r=new Q(e,i,0,t.Ro),n.ko.ao(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Eh.get(t.targetId);return(null===r||t.Z.o(r.Z)>0)&&(n.Eh=n.Eh.st(t.targetId,t),n.mh.set(e,t.targetId)),t}))}function Ni(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var i,r,s,u;return o.__generator(this,(function(o){switch(o.label){case 0:i=w(t),r=i.Eh.get(e),s=n?"readwrite":"readwrite-primary",o.label=1;case 1:return o.trys.push([1,4,,5]),n?[3,3]:[4,i.persistence.runTransaction("Release target",s,(function(t){return i.persistence.dr.removeTarget(t,r)}))];case 2:o.sent(),o.label=3;case 3:return[3,5];case 4:if(!Jn(u=o.sent()))throw u;return l("LocalStore","Failed to update sequence numbers for target "+e+": "+u),[3,5];case 5:return i.Eh=i.Eh.remove(e),i.mh.delete(r.target),[2]}}))}))}function Si(t,e,n){var r=w(t),i=R.min(),o=lt();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=w(t),i=r.mh.get(n);return void 0!==i?Fn.resolve(r.Eh.get(i)):r.ko.wo(e,n)}(r,t,pn(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.ko.Ao(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.Th.ns(t,e,n?i:R.min(),n?o:lt())})).next((function(t){return{documents:t,gh:o}}))}))}function Di(t,e){var n=w(t),r=w(n.ko),i=n.Eh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Me(t,e).next((function(t){return t?t.target:null}))}))}function xi(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){if(t.code!==k.FAILED_PRECONDITION||t.message!==Gn)throw t;return l("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}var ki=function(){function t(){this.Vh=new it(Li.yh),this.ph=new it(Li.bh)}return t.prototype._=function(){return this.Vh._()},t.prototype.Eo=function(t,e){var n=new Li(t,e);this.Vh=this.Vh.add(n),this.ph=this.ph.add(n)},t.prototype.vh=function(t,e){var n=this;t.forEach((function(t){return n.Eo(t,e)}))},t.prototype.Io=function(t,e){this.Sh(new Li(t,e))},t.prototype.Dh=function(t,e){var n=this;t.forEach((function(t){return n.Io(t,e)}))},t.prototype.Ch=function(t){var e=this,n=new M(new C([])),r=new Li(n,t),i=new Li(n,t+1),o=[];return this.ph.St([r,i],(function(t){e.Sh(t),o.push(t.key)})),o},t.prototype.Nh=function(){var t=this;this.Vh.forEach((function(e){return t.Sh(e)}))},t.prototype.Sh=function(t){this.Vh=this.Vh.delete(t),this.ph=this.ph.delete(t)},t.prototype.Fh=function(t){var e=new M(new C([])),n=new Li(e,t),r=new Li(e,t+1),i=lt();return this.ph.St([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.Nr=function(t){var e=new Li(t,0),n=this.Vh.Ct(e);return null!==n&&t.isEqual(n.key)},t}(),Li=function(){function t(t,e){this.key=t,this.kh=e}return t.yh=function(t,e){return M.P(t.key,e.key)||I(t.kh,e.kh)},t.bh=function(t,e){return I(t.kh,e.kh)||M.P(t.key,e.key)},t}(),Pi=function(){function t(t){this.uid=t}return t.prototype.Er=function(){return null!=this.uid},t.prototype.$h=function(){return this.Er()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();Pi.UNAUTHENTICATED=new Pi(null),Pi.xh=new Pi("google-credentials-uid"),Pi.Oh=new Pi("first-party-uid");var Ri=function(t,e){this.user=e,this.type="OAuth",this.Mh={},this.Mh.Authorization="Bearer "+t},Oi=function(){function t(){this.Lh=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.qh=function(){},t.prototype.Bh=function(t){this.Lh=t,t(Pi.UNAUTHENTICATED)},t.prototype.Uh=function(){this.Lh=null},t}(),Ci=function(){function t(t){var e=this;this.Qh=null,this.currentUser=Pi.UNAUTHENTICATED,this.Wh=!1,this.jh=0,this.Lh=null,this.forceRefresh=!1,this.Qh=function(){e.jh++,e.currentUser=e.Kh(),e.Wh=!0,e.Lh&&e.Lh(e.currentUser)},this.jh=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Qh):(this.Qh(null),t.get().then((function(t){e.auth=t,e.Qh&&e.auth.addAuthTokenListener(e.Qh)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.jh,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.jh!==e?(l("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(m("string"==typeof n.accessToken),new Ri(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.qh=function(){this.forceRefresh=!0},t.prototype.Bh=function(t){this.Lh=t,this.Wh&&t(this.currentUser)},t.prototype.Uh=function(){this.auth&&this.auth.removeAuthTokenListener(this.Qh),this.Qh=null,this.Lh=null},t.prototype.Kh=function(){var t=this.auth&&this.auth.getUid();return m(null===t||"string"==typeof t),new Pi(t)},t}(),Ui=function(){function t(t,e){this.Gh=t,this.zh=e,this.type="FirstParty",this.user=Pi.Oh}return Object.defineProperty(t.prototype,"Mh",{get:function(){var t={"X-Goog-AuthUser":this.zh},e=this.Gh.auth.Hh([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Vi=function(){function t(t,e){this.Gh=t,this.zh=e}return t.prototype.getToken=function(){return Promise.resolve(new Ui(this.Gh,this.zh))},t.prototype.Bh=function(t){t(Pi.Oh)},t.prototype.Uh=function(){},t.prototype.qh=function(){},t}(),Mi=function(){function t(t,e,n,r,i,o){this.ms=t,this.Yh=n,this.Jh=r,this.Xh=i,this.listener=o,this.state=0,this.Zh=0,this.ta=null,this.stream=null,this.Ti=new Yn(t,e)}return t.prototype.ea=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.na=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.sa()},t.prototype.stop=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.ea()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.ia=function(){this.state=0,this.Ti.reset()},t.prototype.ra=function(){var t=this;this.na()&&null===this.ta&&(this.ta=this.ms.Ss(this.Yh,6e4,(function(){return t.oa()})))},t.prototype.ha=function(t){this.aa(),this.stream.send(t)},t.prototype.oa=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){return this.na()?[2,this.close(0)]:[2]}))}))},t.prototype.aa=function(){this.ta&&(this.ta.cancel(),this.ta=null)},t.prototype.close=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(n){switch(n.label){case 0:return this.aa(),this.Ti.cancel(),this.Zh++,3!==t?this.Ti.reset():e&&e.code===k.RESOURCE_EXHAUSTED?(d(e.toString()),d("Using maximum backoff delay to prevent overloading the backend."),this.Ti.ps()):e&&e.code===k.UNAUTHENTICATED&&this.Xh.qh(),null!==this.stream&&(this.ca(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.ua(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ca=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.la(this.Zh),n=this.Zh;this.Xh.getToken().then((function(e){t.Zh===n&&t._a(e)}),(function(n){e((function(){var e=new L(k.UNKNOWN,"Fetching auth token failed: "+n.message);return t.fa(e)}))}))},t.prototype._a=function(t){var e=this,n=this.la(this.Zh);this.stream=this.da(t),this.stream.wa((function(){n((function(){return e.state=2,e.listener.wa()}))})),this.stream.ua((function(t){n((function(){return e.fa(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.sa=function(){var t=this;this.state=4,this.Ti.bs((function(){return o.__awaiter(t,void 0,void 0,(function(){return o.__generator(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.fa=function(t){return l("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.la=function(t){var e=this;return function(n){e.ms.ai((function(){return e.Zh===t?n():(l("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),qi=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,s}return o.__extends(e,t),e.prototype.da=function(t){return this.Jh.Ta("Listen",t)},e.prototype.onMessage=function(t){this.Ti.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:p()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Le?(m(void 0===e||"string"==typeof e),K.fromBase64String(e||"")):(m(void 0===e||e instanceof Uint8Array),K.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?k.UNKNOWN:$(t.code);return new L(e,t.message||"")}(s);n=new It(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;var a=e.documentChange;a.document,a.document.name,a.document.updateTime;var c=ie(t,a.document.name),h=te(a.document.updateTime),f=new $e({mapValue:{fields:a.document.fields}}),l=new rn(c,h,f,{}),d=a.targetIds||[],v=a.removedTargetIds||[];n=new bt(d,v,l.key,l)}else if("documentDelete"in e){e.documentDelete;var g=e.documentDelete;g.document;var y=ie(t,g.document),w=g.readTime?te(g.readTime):R.min(),_=new on(y,w),b=g.removedTargetIds||[];n=new bt([],b,_.key,_)}else if("documentRemove"in e){e.documentRemove;var I=e.documentRemove;I.document;var E=ie(t,I.document),T=I.removedTargetIds||[];n=new bt([],T,E,null)}else{if(!("filter"in e))return p();e.filter;var A=e.filter;A.targetId;var N=A.count||0,S=new Z(N),D=A.targetId;n=new _t(D,S)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return R.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?R.min():e.readTime?te(e.readTime):R.min()}(t);return this.listener.Ea(e,n)},e.prototype.ma=function(t){var e={};e.database=ue(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=W(r)?{documents:le(t,r)}:{query:pe(t,r)}).targetId=e.targetId,e.resumeToken.Y()>0&&(n.resumeToken=Jt(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return p()}}(0,e.X);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.ha(e)},e.prototype.Ia=function(t){var e={};e.database=ue(this.serializer),e.removeTarget=t,this.ha(e)},e}(Mi),Fi=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,s.Aa=!1,s}return o.__extends(e,t),Object.defineProperty(e.prototype,"Ra",{get:function(){return this.Aa},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.Aa=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ca=function(){this.Aa&&this.Pa([])},e.prototype.da=function(t){return this.Jh.Ta("Write",t)},e.prototype.onMessage=function(t){if(m(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Aa){this.Ti.reset();var e=function(t,e){return t&&t.length>0?(m(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?te(t.updateTime):te(e);n.isEqual(R.min())&&(n=te(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Ue(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=te(t.commitTime);return this.listener.ga(n,e)}return m(!t.writeResults||0===t.writeResults.length),this.Aa=!0,this.listener.Va()},e.prototype.ya=function(){var t={};t.database=ue(this.serializer),this.ha(t)},e.prototype.Pa=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return he(e.serializer,t)}))};this.ha(n)},e}(Mi),ji=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Jh=n,i.serializer=r,i.pa=!1,i}return o.__extends(e,t),e.prototype.ba=function(){if(this.pa)throw new L(k.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.va=function(t,e,n){var r=this;return this.ba(),this.credentials.getToken().then((function(i){return r.Jh.va(t,e,n,i)})).catch((function(t){throw t.code===k.UNAUTHENTICATED&&r.credentials.qh(),t}))},e.prototype.Sa=function(t,e,n){var r=this;return this.ba(),this.credentials.getToken().then((function(i){return r.Jh.Sa(t,e,n,i)})).catch((function(t){throw t.code===k.UNAUTHENTICATED&&r.credentials.qh(),t}))},e.prototype.terminate=function(){this.pa=!1},e}((function(){})),Gi=function(){function t(t,e){this.ei=t,this.Da=e,this.state="Unknown",this.Ca=0,this.Na=null,this.Fa=!0}return t.prototype.ka=function(){var t=this;0===this.Ca&&(this.$a("Unknown"),this.Na=this.ei.Ss("online_state_timeout",1e4,(function(){return t.Na=null,t.xa("Backend didn't respond within 10 seconds."),t.$a("Offline"),Promise.resolve()})))},t.prototype.Oa=function(t){"Online"===this.state?this.$a("Unknown"):(this.Ca++,this.Ca>=1&&(this.Ma(),this.xa("Connection failed 1 times. Most recent error: "+t.toString()),this.$a("Offline")))},t.prototype.set=function(t){this.Ma(),this.Ca=0,"Online"===t&&(this.Fa=!1),this.$a(t)},t.prototype.$a=function(t){t!==this.state&&(this.state=t,this.Da(t))},t.prototype.xa=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fa?(d(e),this.Fa=!1):l("OnlineStateTracker",e)},t.prototype.Ma=function(){null!==this.Na&&(this.Na.cancel(),this.Na=null)},t}(),Bi=function(){function t(t,e,n,i,r){var s=this;this.La=t,this.qa=e,this.ei=n,this.Ba=[],this.Ua=new Map,this.Qa=null,this.Wa=new Set,this.ja=r,this.ja.Ka((function(t){n.ai((function(){return o.__awaiter(s,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.Ga()?(l("RemoteStore","Restarting streams for network reachability change."),[4,this.za()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Ha=new Gi(n,i),this.Ya=function(t,e,n){var r=w(t);return r.ba(),new qi(e,r.Jh,r.credentials,r.serializer,n)}(this.qa,n,{wa:this.Ja.bind(this),ua:this.Xa.bind(this),Ea:this.Za.bind(this)}),this.tc=function(t,e,n){var r=w(t);return r.ba(),new Fi(e,r.Jh,r.credentials,r.serializer,n)}(this.qa,n,{wa:this.ec.bind(this),ua:this.nc.bind(this),Va:this.sc.bind(this),ga:this.ga.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return this.Wa.delete(0),this.ic()},t.prototype.ic=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.Ga()?(this.rc()?this.oc():this.Ha.set("Unknown"),[4,this.hc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.disableNetwork=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.Wa.add(0),[4,this.ac()];case 1:return t.sent(),this.Ha.set("Offline"),[2]}}))}))},t.prototype.ac=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return[4,this.tc.stop()];case 1:return t.sent(),[4,this.Ya.stop()];case 2:return t.sent(),this.Ba.length>0&&(l("RemoteStore","Stopping write stream with "+this.Ba.length+" pending writes"),this.Ba=[]),this.cc(),[2]}}))}))},t.prototype.th=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return l("RemoteStore","RemoteStore shutting down."),this.Wa.add(5),[4,this.ac()];case 1:return t.sent(),this.ja.th(),this.Ha.set("Unknown"),[2]}}))}))},t.prototype.listen=function(t){this.Ua.has(t.targetId)||(this.Ua.set(t.targetId,t),this.rc()?this.oc():this.Ya.na()&&this.uc(t))},t.prototype.lc=function(t){this.Ua.delete(t),this.Ya.na()&&this._c(t),0===this.Ua.size&&(this.Ya.na()?this.Ya.ra():this.Ga()&&this.Ha.set("Unknown"))},t.prototype.Me=function(t){return this.Ua.get(t)||null},t.prototype.Oe=function(t){return this.fc.Oe(t)},t.prototype.uc=function(t){this.Qa.we(t.targetId),this.Ya.ma(t)},t.prototype._c=function(t){this.Qa.we(t),this.Ya.Ia(t)},t.prototype.oc=function(){this.Qa=new Tt(this),this.Ya.start(),this.Ha.ka()},t.prototype.rc=function(){return this.Ga()&&!this.Ya.ea()&&this.Ua.size>0},t.prototype.Ga=function(){return 0===this.Wa.size},t.prototype.cc=function(){this.Qa=null},t.prototype.Ja=function(){return o.__awaiter(this,void 0,void 0,(function(){var t=this;return o.__generator(this,(function(e){return this.Ua.forEach((function(e,n){t.uc(e)})),[2]}))}))},t.prototype.Xa=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){return this.cc(),this.rc()?(this.Ha.Oa(t),this.oc()):this.Ha.set("Unknown"),[2]}))}))},t.prototype.Za=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r;return o.__generator(this,(function(o){switch(o.label){case 0:if(this.Ha.set("Online"),!(t instanceof It&&2===t.state&&t.cause))return[3,6];o.label=1;case 1:return o.trys.push([1,3,,5]),[4,this.dc(t)];case 2:return o.sent(),[3,5];case 3:return n=o.sent(),l("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),[4,this.wc(n)];case 4:return o.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof bt?this.Qa.ge(t):t instanceof _t?this.Qa.Ce(t):this.Qa.pe(t),e.isEqual(R.min()))return[3,13];o.label=7;case 7:return o.trys.push([7,11,,13]),[4,Ii(this.La)];case 8:return i=o.sent(),e.o(i)>=0?[4,this.Tc(e)]:[3,10];case 9:o.sent(),o.label=10;case 10:return[3,13];case 11:return l("RemoteStore","Failed to raise snapshot:",r=o.sent()),[4,this.wc(r)];case 12:return o.sent(),[3,13];case 13:return[2]}}))}))},t.prototype.wc=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n=this;return o.__generator(this,(function(i){switch(i.label){case 0:if(!Jn(t))throw t;return this.Wa.add(1),[4,this.ac()];case 1:return i.sent(),this.Ha.set("Offline"),e||(e=function(){return Ii(n.La)}),this.ei.gi((function(){return o.__awaiter(n,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return l("RemoteStore","Retrying IndexedDB access"),[4,e()];case 1:return t.sent(),this.Wa.delete(1),[4,this.ic()];case 2:return t.sent(),[2]}}))}))})),[2]}}))}))},t.prototype.Ec=function(t){var e=this;return t().catch((function(n){return e.wc(n,t)}))},t.prototype.Tc=function(t){var e=this,n=this.Qa.ke(t);return n.Wt.forEach((function(n,r){if(n.resumeToken.Y()>0){var i=e.Ua.get(r);i&&e.Ua.set(r,i.et(n.resumeToken,t))}})),n.jt.forEach((function(t){var n=e.Ua.get(t);if(n){e.Ua.set(t,n.et(K.J,n.Z)),e._c(t);var r=new Q(n.target,t,1,n.sequenceNumber);e.uc(r)}})),this.fc.mc(n)},t.prototype.dc=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,r;return o.__generator(this,(function(o){switch(o.label){case 0:e=t.cause,n=0,i=t.targetIds,o.label=1;case 1:return n<i.length?(r=i[n],this.Ua.has(r)?[4,this.fc.Ic(r,e)]:[3,3]):[3,5];case 2:o.sent(),this.Ua.delete(r),this.Qa.removeTarget(r),o.label=3;case 3:o.label=4;case 4:return n++,[3,1];case 5:return[2]}}))}))},t.prototype.hc=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e,n;return o.__generator(this,(function(r){switch(r.label){case 0:t=this.Ba.length>0?this.Ba[this.Ba.length-1].batchId:-1,r.label=1;case 1:if(!this.Ac())return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,Ti(this.La,t)];case 3:return null===(e=r.sent())?(0===this.Ba.length&&this.tc.ra(),[3,7]):(t=e.batchId,this.Rc(e),[3,6]);case 4:return n=r.sent(),[4,this.wc(n)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return this.Pc()&&this.gc(),[2]}}))}))},t.prototype.Ac=function(){return this.Ga()&&this.Ba.length<10},t.prototype.Vc=function(){return this.Ba.length},t.prototype.Rc=function(t){this.Ba.push(t),this.tc.na()&&this.tc.Ra&&this.tc.Pa(t.mutations)},t.prototype.Pc=function(){return this.Ga()&&!this.tc.ea()&&this.Ba.length>0},t.prototype.gc=function(){this.tc.start()},t.prototype.ec=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){return this.tc.ya(),[2]}))}))},t.prototype.sc=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e,n;return o.__generator(this,(function(r){for(t=0,e=this.Ba;t<e.length;t++)n=e[t],this.tc.Pa(n.mutations);return[2]}))}))},t.prototype.ga=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r=this;return o.__generator(this,(function(o){switch(o.label){case 0:return n=this.Ba.shift(),i=qn.from(n,t,e),[4,this.Ec((function(){return r.fc.yc(i)}))];case 1:return o.sent(),[4,this.hc()];case 2:return o.sent(),[2]}}))}))},t.prototype.nc=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return t&&this.tc.Ra?[4,this.pc(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.Pc()&&this.gc(),[2]}}))}))},t.prototype.pc=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i=this;return o.__generator(this,(function(r){switch(r.label){case 0:return J(n=t.code)&&n!==k.ABORTED?(e=this.Ba.shift(),this.tc.ia(),[4,this.Ec((function(){return i.fc.bc(e.batchId,t)}))]):[3,3];case 1:return r.sent(),[4,this.hc()];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.za=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.Wa.add(4),[4,this.ac()];case 1:return t.sent(),this.Ha.set("Unknown"),this.tc.ia(),this.Ya.ia(),this.Wa.delete(4),[4,this.ic()];case 2:return t.sent(),[2]}}))}))},t.prototype.vc=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this.ei.pi(),l("RemoteStore","RemoteStore received new credentials"),this.Wa.add(3),[4,this.ac()];case 1:return e.sent(),this.Ha.set("Unknown"),[4,this.fc.vc(t)];case 2:return e.sent(),this.Wa.delete(3),[4,this.ic()];case 3:return e.sent(),[2]}}))}))},t.prototype.Sc=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return t?(this.Wa.delete(2),[4,this.ic()]):[3,2];case 1:return e.sent(),[3,5];case 2:return t?[3,4]:(this.Wa.add(2),[4,this.ac()]);case 3:e.sent(),this.Ha.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}}))}))},t}();function zi(t,e){return"firestore_clients_"+t+"_"+e}function Hi(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Er()&&(r+="_"+e.uid),r}function Wi(t,e){return"firestore_targets_"+t+"_"+e}var Ki=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Dc=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new L(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(d("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Cc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Yi=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Dc=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new L(r.error.code,r.error.message)),i?new t(e,r.state,o):(d("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Cc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Xi=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Dc=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=vt(),s=0;i&&s<r.activeTargetIds.length;++s)i=q(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(d("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Qi=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Dc=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(d("SharedClientState","Failed to parse online state: "+e),null)},t}(),Zi=function(){function t(){this.activeTargetIds=vt()}return t.prototype.Nc=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Fc=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Cc=function(){var t={activeTargetIds:this.activeTargetIds.N(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Ji=function(){function t(t,e,n,r,i){this.window=t,this.ms=e,this.persistenceKey=n,this.kc=r,this.fc=null,this.Da=null,this.fs=null,this.$c=this.xc.bind(this),this.Oc=new tt(I),this.tr=!1,this.Mc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Lc=zi(this.persistenceKey,this.kc),this.qc=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Oc=this.Oc.st(this.kc,new Zi),this.Bc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Uc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Qc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Wc=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.$c)}return t.ks=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e,n,i,r,s,u,a,c,h,f,l=this;return o.__generator(this,(function(o){switch(o.label){case 0:return[4,this.fc.rh()];case 1:for(t=o.sent(),e=0,n=t;e<n.length;e++)(i=n[e])!==this.kc&&(r=this.getItem(zi(this.persistenceKey,i)))&&(s=Xi.Dc(i,r))&&(this.Oc=this.Oc.st(s.clientId,s));for(this.jc(),(u=this.storage.getItem(this.Wc))&&(a=this.Kc(u))&&this.Gc(a),c=0,h=this.Mc;c<h.length;c++)f=h[c],this.xc(f);return this.Mc=[],this.window.addEventListener("unload",(function(){return l.th()})),this.tr=!0,[2]}}))}))},t.prototype.Ts=function(t){this.setItem(this.qc,JSON.stringify(t))},t.prototype.zc=function(){return this.Hc(this.Oc)},t.prototype.Yc=function(t){var e=!1;return this.Oc.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Jc=function(t){this.Xc(t,"pending")},t.prototype.Zc=function(t,e,n){this.Xc(t,e,n),this.tu(t)},t.prototype.eu=function(t){var e="not-current";if(this.Yc(t)){var n=this.storage.getItem(Wi(this.persistenceKey,t));if(n){var r=Yi.Dc(t,n);r&&(e=r.state)}}return this.nu.Nc(t),this.jc(),e},t.prototype.su=function(t){this.nu.Fc(t),this.jc()},t.prototype.iu=function(t){return this.nu.activeTargetIds.has(t)},t.prototype.ru=function(t){this.removeItem(Wi(this.persistenceKey,t))},t.prototype.ou=function(t,e,n){this.hu(t,e,n)},t.prototype.au=function(t,e,n){var r=this;e.forEach((function(t){r.tu(t)})),this.currentUser=t,n.forEach((function(t){r.Jc(t)}))},t.prototype.cu=function(t){this.uu(t)},t.prototype.th=function(){this.tr&&(this.window.removeEventListener("storage",this.$c),this.removeItem(this.Lc),this.tr=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return l("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){l("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){l("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.xc=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(l("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Lc)return void d("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ms.gi((function(){return o.__awaiter(e,void 0,void 0,(function(){var t,e,i,r,s,u;return o.__generator(this,(function(o){if(this.tr){if(null!==n.key)if(this.Bc.test(n.key)){if(null==n.newValue)return t=this.lu(n.key),[2,this._u(t,null)];if(e=this.fu(n.key,n.newValue))return[2,this._u(e.clientId,e)]}else if(this.Uc.test(n.key)){if(null!==n.newValue&&(i=this.du(n.key,n.newValue)))return[2,this.wu(i)]}else if(this.Qc.test(n.key)){if(null!==n.newValue&&(r=this.Tu(n.key,n.newValue)))return[2,this.Eu(r)]}else if(n.key===this.Wc){if(null!==n.newValue&&(s=this.Kc(n.newValue)))return[2,this.Gc(s)]}else n.key===this.qc&&(u=function(t){var e=Wn.Es;if(null!=t)try{var n=JSON.parse(t);m("number"==typeof n),e=n}catch(t){d("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Wn.Es&&this.fs(u)}else this.Mc.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"nu",{get:function(){return this.Oc.get(this.kc)},enumerable:!1,configurable:!0}),t.prototype.jc=function(){this.setItem(this.Lc,this.nu.Cc())},t.prototype.Xc=function(t,e,n){var r=new Ki(this.currentUser,t,e,n),i=Hi(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Cc())},t.prototype.tu=function(t){var e=Hi(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.uu=function(t){var e={clientId:this.kc,onlineState:t};this.storage.setItem(this.Wc,JSON.stringify(e))},t.prototype.hu=function(t,e,n){var r=Wi(this.persistenceKey,t),i=new Yi(t,e,n);this.setItem(r,i.Cc())},t.prototype.lu=function(t){var e=this.Bc.exec(t);return e?e[1]:null},t.prototype.fu=function(t,e){var n=this.lu(t);return Xi.Dc(n,e)},t.prototype.du=function(t,e){var n=this.Uc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ki.Dc(new Pi(i),r,e)},t.prototype.Tu=function(t,e){var n=this.Qc.exec(t),r=Number(n[1]);return Yi.Dc(r,e)},t.prototype.Kc=function(t){return Qi.Dc(t)},t.prototype.wu=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.fc.mu(t.batchId,t.state,t.error)]:(l("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.Eu=function(t){return this.fc.Iu(t.targetId,t.state,t.error)},t.prototype._u=function(t,e){var n=this,r=e?this.Oc.st(t,e):this.Oc.remove(t),i=this.Hc(this.Oc),o=this.Hc(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.fc.Au(s,u).then((function(){n.Oc=r}))},t.prototype.Gc=function(t){this.Oc.get(t.clientId)&&this.Da(t.onlineState)},t.prototype.Hc=function(t){var e=vt();return t.forEach((function(t,n){e=e.Nt(n.activeTargetIds)})),e},t}(),$i=function(){function t(){this.Ru=new Zi,this.Pu={},this.Da=null,this.fs=null}return t.prototype.Jc=function(t){},t.prototype.Zc=function(t,e,n){},t.prototype.eu=function(t){return this.Ru.Nc(t),this.Pu[t]||"not-current"},t.prototype.ou=function(t,e,n){this.Pu[t]=e},t.prototype.su=function(t){this.Ru.Fc(t)},t.prototype.iu=function(t){return this.Ru.activeTargetIds.has(t)},t.prototype.ru=function(t){delete this.Pu[t]},t.prototype.zc=function(){return this.Ru.activeTargetIds},t.prototype.Yc=function(t){return this.Ru.activeTargetIds.has(t)},t.prototype.start=function(){return this.Ru=new Zi,Promise.resolve()},t.prototype.au=function(t,e,n){},t.prototype.cu=function(t){},t.prototype.th=function(){},t.prototype.Ts=function(t){},t}(),to=function(t){this.key=t},eo=function(t){this.key=t},no=function(){function t(t,e){this.query=t,this.gu=e,this.Vu=null,this.Yt=!1,this.yu=lt(),this.qt=lt(),this.pu=_n(t),this.bu=new yt(this.pu)}return Object.defineProperty(t.prototype,"vu",{get:function(){return this.gu},enumerable:!1,configurable:!0}),t.prototype.Su=function(t,e){var n=this,r=e?e.Du:new gt,i=e?e.bu:this.bu,o=e?e.qt:this.qt,s=i,u=!1,a=this.query.an()&&i.size===this.query.limit?i.last():null,c=this.query.cn()&&i.size===this.query.limit?i.first():null;if(t.ht((function(t,e){var h=i.get(t),f=e instanceof rn?e:null;f&&(f=bn(n.query,f)?f:null);var l=!!h&&n.qt.has(h.key),p=!!f&&(f.Ge||n.qt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Cu(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.pu(f,a)>0||c&&n.pu(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),this.query.an()||this.query.cn())for(;s.size>this.query.limit;){var h=this.query.an()?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{bu:s,Du:r,Nu:u,qt:o}},t.prototype.Cu=function(t,e){return t.Ge&&e.hasCommittedMutations&&!e.Ge},t.prototype.Un=function(t,e,n){var r=this,i=this.bu;this.bu=t.bu,this.qt=t.qt;var o=t.Du.Mt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return p()}};return n(t)-n(e)}(t.type,e.type)||r.pu(t.doc,e.doc)})),this.Fu(n);var s=e?this.ku():[],u=0===this.yu.size&&this.Yt?1:0,a=u!==this.Vu;return this.Vu=u,0!==o.length||a?{snapshot:new dt(this.query,t.bu,i,o,t.qt,0===u,a,!1),$u:s}:{$u:s}},t.prototype.xu=function(t){return this.Yt&&"Offline"===t?(this.Yt=!1,this.Un({bu:this.bu,Du:new gt,qt:this.qt,Nu:!1},!1)):{$u:[]}},t.prototype.Ou=function(t){return!this.gu.has(t)&&!!this.bu.has(t)&&!this.bu.get(t).Ge},t.prototype.Fu=function(t){var e=this;t&&(t.Jt.forEach((function(t){return e.gu=e.gu.add(t)})),t.Xt.forEach((function(t){})),t.Zt.forEach((function(t){return e.gu=e.gu.delete(t)})),this.Yt=t.Yt)},t.prototype.ku=function(){var t=this;if(!this.Yt)return[];var e=this.yu;this.yu=lt(),this.bu.forEach((function(e){t.Ou(e.key)&&(t.yu=t.yu.add(e.key))}));var n=[];return e.forEach((function(e){t.yu.has(e)||n.push(new eo(e))})),this.yu.forEach((function(t){e.has(t)||n.push(new to(t))})),n},t.prototype.Mu=function(t){this.gu=t.gh,this.yu=lt();var e=this.Su(t.documents);return this.Un(e,!0)},t.prototype.Lu=function(){return dt.Qt(this.query,this.bu,this.qt,0===this.Vu)},t}(),ro=function(t,e,n){this.query=t,this.targetId=e,this.view=n},io=function(t){this.key=t,this.qu=!1},oo=function(){function t(t,e,n,r,i,o){this.La=t,this.Bu=e,this.qa=n,this.Uu=r,this.currentUser=i,this.Qu=o,this.Wu=null,this.ju=new x((function(t){return mn(t)}),gn),this.Ku=new Map,this.Gu=[],this.zu=new tt(M.P),this.Hu=new Map,this.Yu=new ki,this.Ju={},this.Xu=new Map,this.Zu=ui.eo(),this.onlineState="Unknown",this.tl=void 0}return Object.defineProperty(t.prototype,"el",{get:function(){return!0===this.tl},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){this.Wu=t},t.prototype.listen=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,r,s;return o.__generator(this,(function(o){switch(o.label){case 0:return this.nl("listen()"),(i=this.ju.get(t))?(e=i.targetId,this.Uu.eu(e),n=i.view.Lu(),[3,4]):[3,1];case 1:return[4,Ai(this.La,pn(t))];case 2:return r=o.sent(),s=this.Uu.eu(r.targetId),e=r.targetId,[4,this.sl(t,e,"current"===s)];case 3:n=o.sent(),this.el&&this.Bu.listen(r),o.label=4;case 4:return[2,n]}}))}))},t.prototype.sl=function(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var i,r,s,u,a,c;return o.__generator(this,(function(o){switch(o.label){case 0:return[4,Si(this.La,t,!0)];case 1:return i=o.sent(),r=new no(t,i.gh),s=r.Su(i.documents),u=wt.Ht(e,n&&"Offline"!==this.onlineState),a=r.Un(s,this.el,u),this.il(e,a.$u),c=new ro(t,e,r),[2,(this.ju.set(t,c),this.Ku.has(e)?this.Ku.get(e).push(t):this.Ku.set(e,[t]),a.snapshot)]}}))}))},t.prototype.lc=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i=this;return o.__generator(this,(function(r){switch(r.label){case 0:return this.nl("unlisten()"),e=this.ju.get(t),(n=this.Ku.get(e.targetId)).length>1?[2,(this.Ku.set(e.targetId,n.filter((function(e){return!gn(e,t)}))),void this.ju.delete(t))]:this.el?(this.Uu.su(e.targetId),this.Uu.Yc(e.targetId)?[3,2]:[4,Ni(this.La,e.targetId,!1).then((function(){i.Uu.ru(e.targetId),i.Bu.lc(e.targetId),i.rl(e.targetId)})).catch(xi)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.rl(e.targetId),[4,Ni(this.La,e.targetId,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))},t.prototype.write=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r;return o.__generator(this,(function(o){switch(o.label){case 0:this.nl("write()"),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,function(t,e){var n,r=w(t),i=P.now(),o=e.reduce((function(t,e){return t.add(e.key)}),lt());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Rh.Zn(t,o).next((function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=Ge(c,n.get(c.key));null!=h&&s.push(new We(c.key,h,en(h.proto.mapValue),Ve.exists(!0)))}return r.Gn.Ir(t,i,s,e)}))})).then((function(t){var e=t.An(n);return{batchId:t.batchId,Fn:e}}))}(this.La,t)];case 2:return n=o.sent(),this.Uu.Jc(n.batchId),this.ol(n.batchId,e),[4,this.hl(n.Fn)];case 3:return o.sent(),[4,this.Bu.hc()];case 4:return o.sent(),[3,6];case 5:return i=o.sent(),r=ar(i,"Failed to persist write"),e.reject(r),[3,6];case 6:return[2]}}))}))},t.prototype.mc=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n=this;return o.__generator(this,(function(r){switch(r.label){case 0:this.nl("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,Ei(this.La,t)];case 2:return e=r.sent(),t.Wt.forEach((function(t,e){var r=n.Hu.get(e);r&&(m(t.Jt.size+t.Xt.size+t.Zt.size<=1),t.Jt.size>0?r.qu=!0:t.Xt.size>0?m(r.qu):t.Zt.size>0&&(m(r.qu),r.qu=!1))})),[4,this.hl(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,xi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.xu=function(t,e){if(this.el&&0===e||!this.el&&1===e){this.nl("applyOnlineStateChange()");var n=[];this.ju.forEach((function(e,r){var i=r.view.xu(t);i.snapshot&&n.push(i.snapshot)})),this.Wu.al(t),this.Wu.Ea(n),this.onlineState=t,this.el&&this.Uu.cu(t)}},t.prototype.Ic=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r,s,u,a=this;return o.__generator(this,(function(o){switch(o.label){case 0:return this.nl("rejectListens()"),this.Uu.ou(t,"rejected",e),n=this.Hu.get(t),(i=n&&n.key)?(r=(r=new tt(M.P)).st(i,new on(i,R.min())),s=lt().add(i),u=new mt(R.min(),new Map,new it(I),r,s),[4,this.mc(u)]):[3,2];case 1:return o.sent(),this.zu=this.zu.remove(i),this.Hu.delete(t),this.cl(),[3,4];case 2:return[4,Ni(this.La,t,!1).then((function(){return a.rl(t,e)})).catch(xi)];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))},t.prototype.yc=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n;return o.__generator(this,(function(r){switch(r.label){case 0:this.nl("applySuccessfulWrite()"),e=t.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,_i(this.La,t)];case 2:return n=r.sent(),this.ul(e,null),this.ll(e),this.Uu.Zc(e,"acknowledged"),[4,this.hl(n)];case 3:return r.sent(),[3,6];case 4:return[4,xi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.bc=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n;return o.__generator(this,(function(r){switch(r.label){case 0:this.nl("rejectFailedWrite()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,function(t,e){var n=w(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.Gn.Rr(t,e).next((function(e){return m(null!==e),r=e.keys(),n.Gn.br(t,e)})).next((function(){return n.Gn.Cr(t)})).next((function(){return n.Rh.Zn(t,r)}))}))}(this.La,t)];case 2:return n=r.sent(),this.ul(t,e),this.ll(t),this.Uu.Zc(t,"rejected",e),[4,this.hl(n)];case 3:return r.sent(),[3,6];case 4:return[4,xi(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype._l=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,r;return o.__generator(this,(function(o){switch(o.label){case 0:this.Bu.Ga()||l("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,function(t){var e=w(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.Gn.Vr(t)}))}(this.La)];case 2:return-1===(e=o.sent())?[2,void t.resolve()]:((n=this.Xu.get(e)||[]).push(t),this.Xu.set(e,n),[3,4]);case 3:return i=o.sent(),r=ar(i,"Initialization of waitForPendingWrites() operation failed"),t.reject(r),[3,4];case 4:return[2]}}))}))},t.prototype.ll=function(t){(this.Xu.get(t)||[]).forEach((function(t){t.resolve()})),this.Xu.delete(t)},t.prototype.fl=function(t){this.Xu.forEach((function(e){e.forEach((function(e){e.reject(new L(k.CANCELLED,t))}))})),this.Xu.clear()},t.prototype.ol=function(t,e){var n=this.Ju[this.currentUser.$h()];n||(n=new tt(I)),n=n.st(t,e),this.Ju[this.currentUser.$h()]=n},t.prototype.ul=function(t,e){var n=this.Ju[this.currentUser.$h()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.Ju[this.currentUser.$h()]=n}},t.prototype.rl=function(t,e){var n=this;void 0===e&&(e=null),this.Uu.su(t);for(var r=0,i=this.Ku.get(t);r<i.length;r++){var o=i[r];this.ju.delete(o),e&&this.Wu.dl(o,e)}this.Ku.delete(t),this.el&&this.Yu.Ch(t).forEach((function(t){n.Yu.Nr(t)||n.wl(t)}))},t.prototype.wl=function(t){var e=this.zu.get(t);null!==e&&(this.Bu.lc(e),this.zu=this.zu.remove(t),this.Hu.delete(e),this.cl())},t.prototype.il=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof to?(this.Yu.Eo(i.key,t),this.Tl(i)):i instanceof eo?(l("SyncEngine","Document no longer in limbo: "+i.key),this.Yu.Io(i.key,t),this.Yu.Nr(i.key)||this.wl(i.key)):p()}},t.prototype.Tl=function(t){var e=t.key;this.zu.get(e)||(l("SyncEngine","New document in limbo: "+e),this.Gu.push(e),this.cl())},t.prototype.cl=function(){for(;this.Gu.length>0&&this.zu.size<this.Qu;){var t=this.Gu.shift(),e=this.Zu.next();this.Hu.set(e,new io(t)),this.zu=this.zu.st(t,e),this.Bu.listen(new Q(pn(hn(t.path)),e,2,Wn.Es))}},t.prototype.El=function(){return this.zu},t.prototype.ml=function(){return this.Gu},t.prototype.hl=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r,s=this;return o.__generator(this,(function(u){switch(u.label){case 0:return n=[],i=[],r=[],this.ju.forEach((function(o,u){r.push(Promise.resolve().then((function(){var e=u.view.Su(t);return e.Nu?Si(s.La,u.query,!1).then((function(t){var n=t.documents;return u.view.Su(n,e)})):e})).then((function(t){var r=e&&e.Wt.get(u.targetId),o=u.view.Un(t,s.el,r);if(s.il(u.targetId,o.$u),o.snapshot){s.el&&s.Uu.ou(u.targetId,o.snapshot.fromCache?"not-current":"current"),n.push(o.snapshot);var a=Hn._s(u.targetId,o.snapshot);i.push(a)}})))})),[4,Promise.all(r)];case 1:return u.sent(),this.Wu.Ea(n),[4,function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r,s,u,a,c,h,f;return o.__generator(this,(function(o){switch(o.label){case 0:n=w(t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Fn.forEach(e,(function(e){return Fn.forEach(e.us,(function(r){return n.persistence.dr.Eo(t,e.targetId,r)})).next((function(){return Fn.forEach(e.ls,(function(r){return n.persistence.dr.Io(t,e.targetId,r)}))}))}))}))];case 2:return o.sent(),[3,4];case 3:if(!Jn(i=o.sent()))throw i;return l("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(r=0,s=e;r<s.length;r++)u=s[r],a=u.targetId,u.fromCache||(c=n.Eh.get(a),h=c.Z,f=c.nt(h),n.Eh=n.Eh.st(a,f));return[2]}}))}))}(this.La,i)];case 2:return u.sent(),[2]}}))}))},t.prototype.nl=function(t){},t.prototype.vc=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e;return o.__generator(this,(function(n){switch(n.label){case 0:return this.currentUser.isEqual(t)?[3,3]:(l("SyncEngine","User change. New user:",t.$h()),[4,function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r,s;return o.__generator(this,(function(o){switch(o.label){case 0:return n=w(t),i=n.Gn,r=n.Rh,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n.Gn.yr(t).next((function(s){return o=s,i=n.persistence.oh(e),r=new zn(n.Ah,i,n.persistence.uh()),i.yr(t)})).next((function(e){for(var n=[],i=[],s=lt(),u=0,a=o;u<a.length;u++){var c=a[u];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];s=s.add(m.key)}}return r.Zn(t,s).next((function(t){return{Il:t,Al:n,Rl:i}}))}))}))];case 1:return s=o.sent(),[2,(n.Gn=i,n.Rh=r,n.Th.Ph(n.Rh),s)]}}))}))}(this.La,t)]);case 1:return e=n.sent(),this.currentUser=t,this.fl("'waitForPendingWrites' promise is rejected due to a user change."),this.Uu.au(t,e.Al,e.Rl),[4,this.hl(e.Il)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},t.prototype.Oe=function(t){var e=this.Hu.get(t);if(e&&e.qu)return lt().add(e.key);var n=lt(),r=this.Ku.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.ju.get(s);n=n.Nt(u.view.vu)}return n},t}();function so(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r;return o.__generator(this,(function(o){switch(o.label){case 0:return[4,Si((n=w(t)).La,e.query,!0)];case 1:return i=o.sent(),r=e.view.Mu(i),[2,(n.el&&n.il(e.targetId,r.$u),r)]}}))}))}function uo(t,e,n,i){return o.__awaiter(this,void 0,void 0,(function(){var r,s;return o.__generator(this,(function(o){switch(o.label){case 0:return(r=w(t)).nl("applyBatchState()"),[4,function(t,e){var n=w(t),r=w(n.Gn);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.Pr(t,e).next((function(e){return e?n.Rh.Zn(t,e):Fn.resolve(null)}))}))}(r.La,e)];case 1:return null===(s=o.sent())?[3,6]:"pending"!==n?[3,3]:[4,r.Bu.hc()];case 2:return o.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(r.ul(e,i||null),function(t,e){w(w(t).Gn).Sr(e)}(r.La,e)):p(),o.label=4;case 4:return[4,r.hl(s)];case 5:return o.sent(),[3,7];case 6:l("SyncEngine","Cannot apply mutation batch with id: "+e),o.label=7;case 7:return[2]}}))}))}function ao(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r,s,u,a,c,h;return o.__generator(this,(function(o){switch(o.label){case 0:return n=w(t),!0!==e||!0===n.tl?[3,3]:(i=n.Uu.zc(),[4,co(n,i.N())]);case 1:return r=o.sent(),n.tl=!0,[4,n.Bu.Sc(!0)];case 2:for(o.sent(),s=0,u=r;s<u.length;s++)a=u[s],n.Bu.listen(a);return[3,7];case 3:return!1!==e||!1===n.tl?[3,7]:(c=[],h=Promise.resolve(),n.Ku.forEach((function(t,e){n.Uu.iu(e)?c.push(e):h=h.then((function(){return n.rl(e),Ni(n.La,e,!0)})),n.Bu.lc(e)})),[4,h]);case 4:return o.sent(),[4,co(n,c)];case 5:return o.sent(),function(t){var e=w(t);e.Hu.forEach((function(t,n){e.Bu.lc(n)})),e.Yu.Nh(),e.Hu=new Map,e.zu=new tt(M.P)}(n),n.tl=!1,[4,n.Bu.Sc(!1)];case 6:o.sent(),o.label=7;case 7:return[2]}}))}))}function co(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r,s,u,a,c,h,f,l,p,d,v,g;return o.__generator(this,(function(o){switch(o.label){case 0:n=w(t),i=[],r=[],s=0,u=e,o.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=n.Ku.get(a))&&0!==h.length?[4,Ai(n.La,pn(h[0]))]:[3,7]):[3,13];case 2:c=o.sent(),f=0,l=h,o.label=3;case 3:return f<l.length?(p=l[f],d=n.ju.get(p),[4,so(n,d)]):[3,6];case 4:(v=o.sent()).snapshot&&r.push(v.snapshot),o.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Di(n.La,a)];case 8:return g=o.sent(),[4,Ai(n.La,g)];case 9:return c=o.sent(),[4,n.sl(ho(g),a,!1)];case 10:o.sent(),o.label=11;case 11:i.push(c),o.label=12;case 12:return s++,[3,1];case 13:return[2,(n.Wu.Ea(r),i)]}}))}))}function ho(t){return cn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function fo(t){var e=w(t);return w(w(e.La).persistence).rh()}function lo(t,e,n,i){return o.__awaiter(this,void 0,void 0,(function(){var r,s,u;return o.__generator(this,(function(o){switch(o.label){case 0:return(r=w(t)).tl?(l("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!r.Ku.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,function(t){var e=w(t),n=w(e.Ah);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n.Ur(t,e.Ih)})).then((function(t){var n=t.Qr,r=t.readTime;return e.Ih=r,n}))}(r.La)];case 3:return s=o.sent(),u=mt.zt(e,"current"===n),[4,r.hl(s,u)];case 4:return o.sent(),[3,8];case 5:return[4,Ni(r.La,e,!0)];case 6:return o.sent(),r.rl(e,i),[3,8];case 7:p(),o.label=8;case 8:return[2]}}))}))}function po(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var i,r,s,u,a,c,h,f,p,d;return o.__generator(this,(function(v){switch(v.label){case 0:if(!(i=w(t)).tl)return[3,10];r=0,s=e,v.label=1;case 1:return r<s.length?(u=s[r],i.Ku.has(u)?(l("SyncEngine","Adding an already active target "+u),[3,5]):[4,Di(i.La,u)]):[3,6];case 2:return a=v.sent(),[4,Ai(i.La,a)];case 3:return c=v.sent(),[4,i.sl(ho(a),c.targetId,!1)];case 4:v.sent(),i.Bu.listen(c),v.label=5;case 5:return r++,[3,1];case 6:h=function(t){return o.__generator(this,(function(e){switch(e.label){case 0:return i.Ku.has(t)?[4,Ni(i.La,t,!1).then((function(){i.Bu.lc(t),i.rl(t)})).catch(xi)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,p=n,v.label=7;case 7:return f<p.length?(d=p[f],[5,h(d)]):[3,10];case 8:v.sent(),v.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}var vo=function(){this.Pl=void 0,this.listeners=[]},yo=function(){function t(t){this.fc=t,this.gl=new x((function(t){return mn(t)}),gn),this.onlineState="Unknown",this.Vl=new Set,this.fc.subscribe(this)}return t.prototype.listen=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,r,s,u;return o.__generator(this,(function(o){switch(o.label){case 0:if(e=t.query,n=!1,(i=this.gl.get(e))||(n=!0,i=new vo),!n)return[3,4];o.label=1;case 1:return o.trys.push([1,3,,4]),r=i,[4,this.fc.listen(e)];case 2:return r.Pl=o.sent(),[3,4];case 3:return s=o.sent(),u=ar(s,"Initialization of query '"+wn(t.query)+"' failed"),[2,void t.onError(u)];case 4:return this.gl.set(e,i),i.listeners.push(t),t.xu(this.onlineState),i.Pl&&t.yl(i.Pl)&&this.pl(),[2]}}))}))},t.prototype.lc=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,i,r;return o.__generator(this,(function(o){return e=t.query,n=!1,(i=this.gl.get(e))&&(r=i.listeners.indexOf(t))>=0&&(i.listeners.splice(r,1),n=0===i.listeners.length),n?[2,(this.gl.delete(e),this.fc.lc(e))]:[2]}))}))},t.prototype.Ea=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.gl.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].yl(i)&&(e=!0);s.Pl=i}}e&&this.pl()},t.prototype.dl=function(t,e){var n=this.gl.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.gl.delete(t)},t.prototype.al=function(t){this.onlineState=t;var e=!1;this.gl.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].xu(t)&&(e=!0)})),e&&this.pl()},t.prototype.bl=function(t){this.Vl.add(t),t.next()},t.prototype.vl=function(t){this.Vl.delete(t)},t.prototype.pl=function(){this.Vl.forEach((function(t){t.next()}))},t}(),go=function(){function t(t,e,n){this.query=t,this.Sl=e,this.Dl=!1,this.Cl=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.yl=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new dt(t.query,t.docs,t.Lt,e,t.qt,t.fromCache,t.Bt,!0)}var o=!1;return this.Dl?this.Nl(t)&&(this.Sl.next(t),o=!0):this.Fl(t,this.onlineState)&&(this.kl(t),o=!0),this.Cl=t,o},t.prototype.onError=function(t){this.Sl.error(t)},t.prototype.xu=function(t){this.onlineState=t;var e=!1;return this.Cl&&!this.Dl&&this.Fl(this.Cl,t)&&(this.kl(this.Cl),e=!0),e},t.prototype.Fl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.$l&&n||t.docs._()&&"Offline"!==e)},t.prototype.Nl=function(t){if(t.docChanges.length>0)return!0;var e=this.Cl&&this.Cl.hasPendingWrites!==t.hasPendingWrites;return!(!t.Bt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.kl=function(t){t=dt.Qt(t.query,t.docs,t.qt,t.fromCache),this.Dl=!0,this.Sl.next(t)},t}(),mo=function(){function t(){}return t.prototype.Ph=function(t){this.xl=t},t.prototype.ns=function(t,e,n,i){var r=this;return e.hn()||n.isEqual(R.min())?this.Ol(t,e):this.xl.Zn(t,i).next((function(s){var u=r.Ml(e,s);return(e.an()||e.cn())&&r.Nu(e.nn,u,i,n)?r.Ol(t,e):(a()<=h.LogLevel.DEBUG&&l("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),wn(e)),r.xl.ns(t,e,n).next((function(t){return u.forEach((function(e){t=t.st(e.key,e)})),t})))}))},t.prototype.Ml=function(t,e){var n=new it(_n(t));return e.forEach((function(e,r){r instanceof rn&&bn(t,r)&&(n=n.add(r))})),n},t.prototype.Nu=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.o(r)>0)},t.prototype.Ol=function(t,e){return a()<=h.LogLevel.DEBUG&&l("IndexFreeQueryEngine","Using full collection scan to execute query:",wn(e)),this.xl.ns(t,e,R.min())},t}(),wo=function(){function t(t,e){this.zn=t,this.dr=e,this.Gn=[],this.Ll=1,this.ql=new it(Li.yh)}return t.prototype.mr=function(t){return Fn.resolve(0===this.Gn.length)},t.prototype.Ir=function(t,e,n,r){var i=this.Ll;this.Ll++,this.Gn.length>0&&this.Gn[this.Gn.length-1];var o=new Mn(i,e,n,r);this.Gn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.ql=this.ql.add(new Li(a.key,i)),this.zn.Ar(t,a.key.path.p())}return Fn.resolve(o)},t.prototype.Rr=function(t,e){return Fn.resolve(this.Bl(e))},t.prototype.gr=function(t,e){var n=e+1,r=this.Ul(n),i=r<0?0:r;return Fn.resolve(this.Gn.length>i?this.Gn[i]:null)},t.prototype.Vr=function(){return Fn.resolve(0===this.Gn.length?-1:this.Ll-1)},t.prototype.yr=function(t){return Fn.resolve(this.Gn.slice())},t.prototype.Yn=function(t,e){var n=this,r=new Li(e,0),i=new Li(e,Number.POSITIVE_INFINITY),o=[];return this.ql.St([r,i],(function(t){var e=n.Bl(t.kh);o.push(e)})),Fn.resolve(o)},t.prototype.es=function(t,e){var n=this,r=new it(I);return e.forEach((function(t){var e=new Li(t,0),i=new Li(t,Number.POSITIVE_INFINITY);n.ql.St([e,i],(function(t){r=r.add(t.kh)}))})),Fn.resolve(this.Ql(r))},t.prototype.as=function(t,e){var n=e.path,r=n.length+1,i=n;M.j(i)||(i=i.child(""));var o=new Li(new M(i),0),s=new it(I);return this.ql.Dt((function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.kh)),!0)}),o),Fn.resolve(this.Ql(s))},t.prototype.Ql=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Bl(t);null!==r&&n.push(r)})),n},t.prototype.br=function(t,e){var n=this;m(0===this.Wl(e.batchId,"removed")),this.Gn.shift();var r=this.ql;return Fn.forEach(e.mutations,(function(i){var o=new Li(i.key,e.batchId);return r=r.delete(o),n.dr.Dr(t,i.key)})).next((function(){n.ql=r}))},t.prototype.Sr=function(t){},t.prototype.Nr=function(t,e){var n=new Li(e,0),r=this.ql.Ct(n);return Fn.resolve(e.isEqual(r&&r.key))},t.prototype.Cr=function(t){return this.Gn.length,Fn.resolve()},t.prototype.Wl=function(t,e){return this.Ul(t)},t.prototype.Ul=function(t){return 0===this.Gn.length?0:t-this.Gn[0].batchId},t.prototype.Bl=function(t){var e=this.Ul(t);return e<0||e>=this.Gn.length?null:this.Gn[e]},t}(),bo=function(){function t(t,e){this.zn=t,this.jl=e,this.docs=new tt(M.P),this.size=0}return t.prototype.xn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.jl(e);return this.docs=this.docs.st(r,{Or:e,size:s,readTime:n}),this.size+=s-o,this.zn.Ar(t,r.path.p())},t.prototype.Mn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Ln=function(t,e){var n=this.docs.get(e);return Fn.resolve(n?n.Or:null)},t.prototype.getEntries=function(t,e){var n=this,r=ut();return e.forEach((function(t){var e=n.docs.get(t);r=r.st(t,e?e.Or:null)})),Fn.resolve(r)},t.prototype.ns=function(t,e,n){for(var r=ct(),i=new M(e.path.child("")),o=this.docs.ut(i);o.Tt();){var s=o.wt(),u=s.key,a=s.value,c=a.Or,h=a.readTime;if(!e.path.D(u.path))break;h.o(n)<=0||c instanceof rn&&bn(e,c)&&(r=r.st(c.key,c))}return Fn.resolve(r)},t.prototype.Kl=function(t,e){return Fn.forEach(this.docs,(function(t){return e(t)}))},t.prototype.jr=function(e){return new t.Kr(this)},t.prototype.zr=function(t){return Fn.resolve(this.size)},t}();bo.Kr=function(t){function e(e){var n=this;return(n=t.call(this)||this).Hr=e,n}return o.__extends(e,t),e.prototype.Un=function(t){var e=this,n=[];return this.Fn.forEach((function(r,i){i?n.push(e.Hr.xn(t,i,e.readTime)):e.Hr.Mn(r)})),Fn.Cn(n)},e.prototype.qn=function(t,e){return this.Hr.Ln(t,e)},e.prototype.Bn=function(t,e){return this.Hr.getEntries(t,e)},e}(jn);var _o=function(){function t(t){this.persistence=t,this.Gl=new x((function(t){return z(t)}),H),this.lastRemoteSnapshotVersion=R.min(),this.highestTargetId=0,this.zl=0,this.Hl=new ki,this.targetCount=0,this.Yl=ui.to()}return t.prototype.be=function(t,e){return this.Gl.forEach((function(t,n){return e(n)})),Fn.resolve()},t.prototype.ro=function(t){return Fn.resolve(this.lastRemoteSnapshotVersion)},t.prototype.oo=function(t){return Fn.resolve(this.zl)},t.prototype.no=function(t){return this.highestTargetId=this.Yl.next(),Fn.resolve(this.highestTargetId)},t.prototype.ho=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.zl&&(this.zl=e),Fn.resolve()},t.prototype.co=function(t){this.Gl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Yl=new ui(e),this.highestTargetId=e),t.sequenceNumber>this.zl&&(this.zl=t.sequenceNumber)},t.prototype.ao=function(t,e){return this.co(e),this.targetCount+=1,Fn.resolve()},t.prototype.lo=function(t,e){return this.co(e),Fn.resolve()},t.prototype._o=function(t,e){return this.Gl.delete(e.target),this.Hl.Ch(e.targetId),this.targetCount-=1,Fn.resolve()},t.prototype.hr=function(t,e,n){var r=this,i=0,o=[];return this.Gl.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.Gl.delete(s),o.push(r.fo(t,u.targetId)),i++)})),Fn.Cn(o).next((function(){return i}))},t.prototype.do=function(t){return Fn.resolve(this.targetCount)},t.prototype.wo=function(t,e){var n=this.Gl.get(e)||null;return Fn.resolve(n)},t.prototype.To=function(t,e,n){return this.Hl.vh(e,n),Fn.resolve()},t.prototype.mo=function(t,e,n){this.Hl.Dh(e,n);var r=this.persistence.dr,i=[];return r&&e.forEach((function(e){i.push(r.Dr(t,e))})),Fn.Cn(i)},t.prototype.fo=function(t,e){return this.Hl.Ch(e),Fn.resolve()},t.prototype.Ao=function(t,e){var n=this.Hl.Fh(e);return Fn.resolve(n)},t.prototype.Nr=function(t,e){return Fn.resolve(this.Hl.Nr(e))},t}(),Io=function(){function t(t){var e=this;this.Jl={},this.yo=new Wn(0),this.po=!1,this.po=!0,this.dr=t(this),this.ko=new _o(this),this.zn=new Fr,this.Kn=new bo(this.zn,(function(t){return e.dr.Xl(t)}))}return t.prototype.start=function(){return Promise.resolve()},t.prototype.th=function(){return this.po=!1,Promise.resolve()},Object.defineProperty(t.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),t.prototype.Bo=function(){},t.prototype.Uo=function(){},t.prototype.uh=function(){return this.zn},t.prototype.oh=function(t){var e=this.Jl[t.$h()];return e||(e=new wo(this.zn,this.dr),this.Jl[t.$h()]=e),e},t.prototype.hh=function(){return this.ko},t.prototype.ah=function(){return this.Kn},t.prototype.runTransaction=function(t,e,n){var r=this;l("MemoryPersistence","Starting transaction:",t);var i=new Eo(this.yo.next());return this.dr.Zl(),n(i).next((function(t){return r.dr.t_(i).next((function(){return t}))})).Sn().then((function(t){return i.jn(),t}))},t.prototype.e_=function(t,e){return Fn.Nn(Object.values(this.Jl).map((function(n){return function(){return n.Nr(t,e)}})))},t}(),Eo=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ro=e,n}return o.__extends(e,t),e}(Bn),To=function(){function t(t){this.persistence=t,this.n_=new ki,this.s_=null}return t.i_=function(e){return new t(e)},Object.defineProperty(t.prototype,"r_",{get:function(){if(this.s_)return this.s_;throw p()},enumerable:!1,configurable:!0}),t.prototype.Eo=function(t,e,n){return this.n_.Eo(n,e),this.r_.delete(n.toString()),Fn.resolve()},t.prototype.Io=function(t,e,n){return this.n_.Io(n,e),this.r_.add(n.toString()),Fn.resolve()},t.prototype.Dr=function(t,e){return this.r_.add(e.toString()),Fn.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.n_.Ch(e.targetId).forEach((function(t){return n.r_.add(t.toString())}));var r=this.persistence.hh();return r.Ao(t,e.targetId).next((function(t){t.forEach((function(t){return n.r_.add(t.toString())}))})).next((function(){return r._o(t,e)}))},t.prototype.Zl=function(){this.s_=new Set},t.prototype.t_=function(t){var e=this,n=this.persistence.ah().jr();return Fn.forEach(this.r_,(function(r){var i=M.B(r);return e.o_(t,i).next((function(t){t||n.Mn(i)}))})).next((function(){return e.s_=null,n.apply(t)}))},t.prototype.wh=function(t,e){var n=this;return this.o_(t,e).next((function(t){t?n.r_.delete(e.toString()):n.r_.add(e.toString())}))},t.prototype.Xl=function(t){return 0},t.prototype.o_=function(t,e){var n=this;return Fn.Nn([function(){return Fn.resolve(n.n_.Nr(e))},function(){return n.persistence.hh().Nr(t,e)},function(){return n.persistence.e_(t,e)}])},t}(),Ao=function(){function t(t){this.h_=t.h_,this.a_=t.a_}return t.prototype.wa=function(t){this.c_=t},t.prototype.ua=function(t){this.u_=t},t.prototype.onMessage=function(t){this.l_=t},t.prototype.close=function(){this.a_()},t.prototype.send=function(t){this.h_(t)},t.prototype.__=function(){this.c_()},t.prototype.f_=function(t){this.u_(t)},t.prototype.d_=function(t){this.l_(t)},t}(),No={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},So=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n}return o.__extends(e,t),e.prototype.A_=function(t,e,n,r){return new Promise((function(i,s){var u=new f.XhrIo;u.listenOnce(f.EventType.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case f.ErrorCode.NO_ERROR:var e=u.getResponseJson();l("Connection","XHR received:",JSON.stringify(e)),i(e);break;case f.ErrorCode.TIMEOUT:l("Connection",'RPC "'+t+'" timed out'),s(new L(k.DEADLINE_EXCEEDED,"Request time out"));break;case f.ErrorCode.HTTP_ERROR:var n=u.getStatus();if(l("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace("_","-");return Object.values(k).indexOf(e)>=0?e:k.UNKNOWN}(r.status);s(new L(a,r.message))}else s(new L(k.UNKNOWN,"Server responded with status "+u.getStatus()))}else s(new L(k.UNAVAILABLE,"Connection failed."));break;default:p()}}finally{l("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);u.send(e,"POST",a,n,15)}))},e.prototype.Ta=function(t,e){var n=[this.T_,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=f.createWebChannelTransport(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.I_(s.initMessageHeaders,e),i.isMobileCordova()||i.isReactNative()||i.isElectron()||i.isIE()||i.isUWP()||i.isBrowserExtension()||(s.httpHeadersOverwriteParam="$httpHeaders");var u=n.join("");l("Connection","Creating WebChannel: "+u,s);var a=r.createWebChannel(u,s),o=!1,c=!1,p=new Ao({h_:function(t){c?l("Connection","Not sending because WebChannel is closed:",t):(o||(l("Connection","Opening WebChannel transport."),a.open(),o=!0),l("Connection","WebChannel sending:",t),a.send(t))},a_:function(){return a.close()}}),h=function(t,e){a.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return h(f.WebChannel.EventType.OPEN,(function(){c||l("Connection","WebChannel transport opened.")})),h(f.WebChannel.EventType.CLOSE,(function(){c||(c=!0,l("Connection","WebChannel transport closed"),p.f_())})),h(f.WebChannel.EventType.ERROR,(function(t){c||(c=!0,v("Connection","WebChannel transport errored:",t),p.f_(new L(k.UNAVAILABLE,"The operation could not be completed")))})),h(f.WebChannel.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];m(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){l("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Y[t];if(void 0!==e)return $(e)}(o),u=i.message;void 0===s&&(s=k.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),c=!0,p.f_(new L(s,u)),a.close()}else l("Connection","WebChannel received:",n),p.d_(n)}})),setTimeout((function(){p.__()}),0),p},e}(function(){function t(t){this.w_=t,this.s=t.s;var e=t.ssl?"https":"http";this.T_=e+"://"+t.host,this.E_="projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents"}return t.prototype.va=function(t,e,n,r){var i=this.m_(t,e);l("RestConnection","Sending: ",i,n);var o={};return this.I_(o,r),this.A_(t,i,o,n).then((function(t){return l("RestConnection","Received: ",t),t}),(function(e){throw v("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Sa=function(t,e,n,r){return this.va(t,e,n,r)},t.prototype.I_=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.19.0",t["Content-Type"]="text/plain",e)for(var n in e.Mh)e.Mh.hasOwnProperty(n)&&(t[n]=e.Mh[n])},t.prototype.m_=function(t,e){var n=No[t];return this.T_+"/v1/"+e+":"+n},t}()),Do=function(){function t(){var t=this;this.R_=function(){return t.P_()},this.g_=function(){return t.V_()},this.y_=[],this.p_()}return t.prototype.Ka=function(t){this.y_.push(t)},t.prototype.th=function(){window.removeEventListener("online",this.R_),window.removeEventListener("offline",this.g_)},t.prototype.p_=function(){window.addEventListener("online",this.R_),window.addEventListener("offline",this.g_)},t.prototype.P_=function(){l("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.y_;t<e.length;t++)(0,e[t])(0)},t.prototype.V_=function(){l("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.y_;t<e.length;t++)(0,e[t])(1)},t.ks=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),xo=function(){function t(){}return t.prototype.Ka=function(t){},t.prototype.th=function(){},t}();function ko(t){return new Kt(t,!0)}var Lo="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Po=function(){function t(){}return t.prototype.initialize=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this.Uu=this.b_(t),this.persistence=this.v_(t),[4,this.persistence.start()];case 1:return e.sent(),this.S_=this.D_(t),this.La=this.C_(t),[2]}}))}))},t.prototype.D_=function(t){return null},t.prototype.C_=function(t){return e=this.persistence,n=new mo,r=t.N_,new bi(e,n,r);var e,n,r},t.prototype.v_=function(t){if(t.k_.F_)throw new L(k.FAILED_PRECONDITION,Lo);return new Io(To.i_)},t.prototype.b_=function(t){return new $i},t.prototype.terminate=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.S_&&this.S_.stop(),[4,this.Uu.th()];case 1:return t.sent(),[4,this.persistence.th()];case 2:return t.sent(),[2]}}))}))},t.prototype.clearPersistence=function(t,e){throw new L(k.FAILED_PRECONDITION,Lo)},t}(),Ro=function(t){function e(e){var n=this;return(n=t.call(this)||this).x_=e,n}return o.__extends(e,t),e.prototype.initialize=function(e){return o.__awaiter(this,void 0,void 0,(function(){var n,i=this;return o.__generator(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,this.x_.initialize(this,e)];case 2:return r.sent(),n=this.x_.fc,this.Uu instanceof Ji?(this.Uu.fc={mu:uo.bind(null,n),Iu:lo.bind(null,n),Au:po.bind(null,n),rh:fo.bind(null,n)},[4,this.Uu.start()]):[3,4];case 3:r.sent(),r.label=4;case 4:return[4,this.persistence.qo((function(t){return o.__awaiter(i,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,ao(this.x_.fc,t)];case 1:return e.sent(),this.S_&&(t&&!this.S_.tr?this.S_.start(this.La):t||this.S_.stop()),[2]}}))}))}))];case 5:return r.sent(),[2]}}))}))},e.prototype.b_=function(t){if(t.k_.F_&&t.k_.synchronizeTabs){var e=ir();if(!Ji.ks(e))throw new L(k.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=wi(t.w_.s,t.w_.persistenceKey);return new Ji(e,t.ei,n,t.clientId,t.N_)}return new $i},e}(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.initialize=function(e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n;return o.__generator(this,(function(r){return e=w(t),n=w(e.Ah),[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return n.Wr(t)})).then((function(t){e.Ih=t}))]}))}))}(this.La)];case 2:return n.sent(),[2]}}))}))},e.prototype.D_=function(t){var e=this.persistence.dr.Yi;return new hr(e,t.ei)},e.prototype.v_=function(t){var e=wi(t.w_.s,t.w_.persistenceKey),n=ko(t.w_.s);return new vi(t.k_.synchronizeTabs,e,t.clientId,pr.Ui(t.k_.cacheSizeBytes),t.ei,ir(),or(),n,this.Uu,t.k_.Vo)},e.prototype.b_=function(t){return new $i},e.prototype.clearPersistence=function(t,e){return function(t){return o.__awaiter(this,void 0,void 0,(function(){var e;return o.__generator(this,(function(n){switch(n.label){case 0:return Xn.ks()?(e=t+"main",[4,Xn.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(wi(t,e))},e}(Po)),Oo=function(){function t(){}return t.prototype.initialize=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n=this;return o.__generator(this,(function(r){switch(r.label){case 0:return this.La?[3,3]:(this.La=t.La,this.Uu=t.Uu,this.qa=this.O_(e),this.Bu=this.M_(e),this.fc=this.L_(e),this.q_=this.B_(e),this.Uu.Da=function(t){return n.fc.xu(t,1)},this.Bu.fc=this.fc,[4,this.Bu.start()]);case 1:return r.sent(),[4,this.Bu.Sc(this.fc.el)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.B_=function(t){return new yo(this.fc)},t.prototype.O_=function(t){var e,n=ko(t.w_.s),r=(e=t.w_,new So(e));return function(t,e,n){return new ji(t,e,n)}(t.credentials,r,n)},t.prototype.M_=function(t){var e=this;return new Bi(this.La,this.qa,t.ei,(function(t){return e.fc.xu(t,0)}),Do.ks()?new Do:new xo)},t.prototype.L_=function(t){return function(t,e,n,r,i,o,s){var u=new oo(t,e,n,r,i,o);return s&&(u.tl=!0),u}(this.La,this.Bu,this.qa,this.Uu,t.N_,t.Qu,!t.k_.F_||!t.k_.synchronizeTabs)},t.prototype.terminate=function(){return this.Bu.th()},t}();function Co(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Uo=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.U_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.U_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Q_=function(){this.muted=!0},t.prototype.U_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();function Vo(t,e){if(0!==e.length)throw new L(k.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+es(e.length,"argument")+".")}function Mo(t,e,n){if(e.length!==n)throw new L(k.INVALID_ARGUMENT,"Function "+t+"() requires "+es(n,"argument")+", but was called with "+es(e.length,"argument")+".")}function qo(t,e,n){if(e.length<n)throw new L(k.INVALID_ARGUMENT,"Function "+t+"() requires at least "+es(n,"argument")+", but was called with "+es(e.length,"argument")+".")}function Fo(t,e,n,r){if(e.length<n||e.length>r)throw new L(k.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+es(e.length,"argument")+".")}function jo(t,e,n,r){Ko(t,e,ts(n)+" argument",r)}function Go(t,e,n,r){void 0!==r&&jo(t,e,n,r)}function Bo(t,e,n,r){Ko(t,e,n+" option",r)}function zo(t,e,n,r){void 0!==r&&Bo(t,e,n,r)}function Ho(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,u=i;s<u.length;s++){var a=u[s];if(a===r)return;o.push(Xo(a))}var c=Xo(r);throw new L(k.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Wo(t,e,n,r){if(!e.some((function(t){return t===r})))throw new L(k.INVALID_ARGUMENT,"Invalid value "+Xo(r)+" provided to function "+t+"() for its "+ts(n)+" argument. Acceptable values: "+e.join(", "));return r}function Ko(t,e,n,r){if(!("object"===e?Yo(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Xo(r);throw new L(k.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Yo(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Xo(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":p()}function Qo(t,e,n){if(void 0===n)throw new L(k.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ts(e)+" argument, but it was undefined.")}function Zo(t,e,n){S(e,(function(e,r){if(n.indexOf(e)<0)throw new L(k.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function Jo(t,e,n,r){var i=Xo(r);return new L(k.INVALID_ARGUMENT,"Function "+t+"() requires its "+ts(n)+" argument to be a "+e+", but it was: "+i)}function $o(t,e,n){if(n<=0)throw new L(k.INVALID_ARGUMENT,"Function "+t+"() requires its "+ts(e)+" argument to be a positive number, but it was: "+n+".")}function ts(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function es(t,e){return t+" "+e+(1===t?"":"s")}function ns(){if("undefined"==typeof Uint8Array)throw new L(k.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function rs(){if("undefined"==typeof atob)throw new L(k.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var is=function(){function t(t){rs(),this.W_=t}return t.fromBase64String=function(e){Mo("Blob.fromBase64String",arguments,1),jo("Blob.fromBase64String","string",1,e),rs();try{return new t(K.fromBase64String(e))}catch(e){throw new L(k.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}},t.fromUint8Array=function(e){if(Mo("Blob.fromUint8Array",arguments,1),ns(),!(e instanceof Uint8Array))throw Jo("Blob.fromUint8Array","Uint8Array",1,e);return new t(K.fromUint8Array(e))},t.prototype.toBase64=function(){return Mo("Blob.toBase64",arguments,0),rs(),this.W_.toBase64()},t.prototype.toUint8Array=function(){return Mo("Blob.toUint8Array",arguments,0),ns(),this.W_.toUint8Array()},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.W_.isEqual(t.W_)},t}(),os=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new L(k.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+es(1,"element")+".")}(0,t);for(var e=0;e<t.length;++e)if(jo("FieldPath","string",e,t[e]),0===t[e].length)throw new L(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.j_=new V(t)},ss=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return o.__extends(e,t),e.documentId=function(){return new e(V.L().F())},e.prototype.isEqual=function(t){if(!(t instanceof e))throw Jo("isEqual","FieldPath",1,t);return this.j_.isEqual(t.j_)},e}(os),us=new RegExp("[~\\*/\\[\\]]"),as=function(){this.K_=this},cs=function(t){function e(e){var n=this;return(n=t.call(this)||this).G_=e,n}return o.__extends(e,t),e.prototype.z_=function(t){if(2!==t.H_)throw 1===t.H_?t.Y_(this.G_+"() can only appear at the top level of your update data"):t.Y_(this.G_+"() cannot be used with set() unless you pass {merge:true}");return t.qe.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(as);function hs(t,e,n){return new Es({H_:3,J_:e.settings.J_,methodName:t.G_,X_:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var fs=function(t){function e(e){var n=this;return(n=t.call(this)||this).G_=e,n}return o.__extends(e,t),e.prototype.z_=function(t){return new Ce(t.path,new Ne)},e.prototype.isEqual=function(t){return t instanceof e},e}(as),ls=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).G_=e,r.Z_=n,r}return o.__extends(e,t),e.prototype.z_=function(t){var e=hs(this,t,!0),n=this.Z_.map((function(t){return xs(t,e)})),r=new Se(n);return new Ce(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(as),ps=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).G_=e,r.Z_=n,r}return o.__extends(e,t),e.prototype.z_=function(t){var e=hs(this,t,!0),n=this.Z_.map((function(t){return xs(t,e)})),r=new xe(n);return new Ce(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(as),ds=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).G_=e,r.tf=n,r}return o.__extends(e,t),e.prototype.z_=function(t){var e=new Le(t.serializer,Qt(t.serializer,this.tf));return new Ce(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(as),vs=function(t){function e(){return t.call(this)||this}return o.__extends(e,t),e.delete=function(){return Vo("FieldValue.delete",arguments),new ys(new cs("FieldValue.delete"))},e.serverTimestamp=function(){return Vo("FieldValue.serverTimestamp",arguments),new ys(new fs("FieldValue.serverTimestamp"))},e.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return qo("FieldValue.arrayUnion",arguments,1),new ys(new ls("FieldValue.arrayUnion",t))},e.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return qo("FieldValue.arrayRemove",arguments,1),new ys(new ps("FieldValue.arrayRemove",t))},e.increment=function(t){return jo("FieldValue.increment","number",1,t),Mo("FieldValue.increment",arguments,1),new ys(new ds("FieldValue.increment",t))},e}(as),ys=function(t){function e(e){var n=this;return(n=t.call(this)||this).K_=e,n.G_=e.G_,n}return o.__extends(e,t),e.prototype.z_=function(t){return this.K_.z_(t)},e.prototype.isEqual=function(t){return t instanceof e&&this.K_.isEqual(t.K_)},e}(vs),gs=function(){function t(t,e){if(Mo("GeoPoint",arguments,2),jo("GeoPoint","number",1,t),jo("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new L(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new L(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.ef=t,this.nf=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.ef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.nf},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.ef===t.ef&&this.nf===t.nf},t.prototype.toJSON=function(){return{latitude:this.ef,longitude:this.nf}},t.prototype.T=function(t){return I(this.ef,t.ef)||I(this.nf,t.nf)},t}(),ms=/^__.*__$/,ws=function(t,e,n){this.sf=t,this.if=e,this.rf=n},bs=function(){function t(t,e,n){this.data=t,this.qe=e,this.fieldTransforms=n}return t.prototype.hf=function(t,e){var n=[];return null!==this.qe?n.push(new We(t,this.data,this.qe,e)):n.push(new He(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Ye(t,this.fieldTransforms)),n},t}(),_s=function(){function t(t,e,n){this.data=t,this.qe=e,this.fieldTransforms=n}return t.prototype.hf=function(t,e){var n=[new We(t,this.data,this.qe,e)];return this.fieldTransforms.length>0&&n.push(new Ye(t,this.fieldTransforms)),n},t}();function Is(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw p()}}var Es=function(){function t(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.af(),this.fieldTransforms=i||[],this.qe=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"H_",{get:function(){return this.settings.H_},enumerable:!1,configurable:!0}),t.prototype.cf=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.qe)},t.prototype.uf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.cf({path:n,X_:!1});return r.lf(t),r},t.prototype._f=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.cf({path:n,X_:!1});return r.af(),r},t.prototype.ff=function(t){return this.cf({path:void 0,X_:!0})},t.prototype.Y_=function(t){return Cs(t,this.settings.methodName,this.settings.df||!1,this.path,this.settings.J_)},t.prototype.contains=function(t){return void 0!==this.qe.find((function(e){return t.D(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.D(e.field)}))},t.prototype.af=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.lf(this.path.get(t))},t.prototype.lf=function(t){if(0===t.length)throw this.Y_("Document fields must not be empty");if(Is(this.H_)&&ms.test(t))throw this.Y_('Document fields cannot begin and end with "__"')},t}(),Ts=function(){function t(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||ko(t)}return t.prototype.wf=function(t,e,n,r){return void 0===r&&(r=!1),new Es({H_:t,methodName:e,J_:n,path:V.$(),X_:!1,df:r},this.s,this.serializer,this.ignoreUndefinedProperties)},t}();function As(t,e,n,r,i,o){void 0===o&&(o={});var s=t.wf(o.merge||o.mergeFields?2:0,e,n,i);Ps("Data must be an object, but it was:",s,r);var u,a,c=ks(r,s);if(o.merge)u=new Oe(s.qe),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var d=l[f],v=void 0;if(d instanceof os)v=d.j_;else{if("string"!=typeof d)throw p();v=Os(e,d,n)}if(!s.contains(v))throw new L(k.INVALID_ARGUMENT,"Field '"+v+"' is specified in your field mask but missing from your input data.");Us(h,v)||h.push(v)}u=new Oe(h),a=s.fieldTransforms.filter((function(t){return u.Ke(t.field)}))}else u=null,a=s.fieldTransforms;return new bs(new $e(c),u,a)}function Ns(t,e,n,r){var i=t.wf(1,e,n);Ps("Data must be an object, but it was:",i,r);var o=[],s=new tn;S(r,(function(t,r){var u=Os(e,t,n),a=i._f(u);if(r instanceof as&&r.K_ instanceof cs)o.push(u);else{var c=xs(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new Oe(o);return new _s(s.ze(),u,i.fieldTransforms)}function Ss(t,e,n,r,i,o){var s=t.wf(1,e,n),u=[Rs(e,r,n)],a=[i];if(o.length%2!=0)throw new L(k.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Rs(e,o[c])),a.push(o[c+1]);for(var h=[],f=new tn,l=u.length-1;l>=0;--l)if(!Us(h,u[l])){var p=u[l],d=a[l],v=s._f(p);if(d instanceof as&&d.K_ instanceof cs)h.push(p);else{var y=xs(d,v);null!=y&&(h.push(p),f.set(p,y))}}var g=new Oe(h);return new _s(f.ze(),g,s.fieldTransforms)}function Ds(t,e,n,r){return void 0===r&&(r=!1),xs(n,t.wf(r?4:3,e))}function xs(t,e){if(Ls(t))return Ps("Unsupported field value:",e,t),ks(t,e);if(t instanceof as)return function(t,e){if(!Is(e.H_))throw e.Y_(t.G_+"() can only be used with update() and set()");if(!e.path)throw e.Y_(t.G_+"() is not currently supported inside arrays");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.qe.push(e.path),t instanceof Array){if(e.settings.X_&&4!==e.H_)throw e.Y_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=xs(o[i],e.ff(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Qt(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=P.fromDate(t);return{timestampValue:Zt(e.serializer,n)}}if(t instanceof P){var r=new P(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Zt(e.serializer,r)}}if(t instanceof gs)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof is)return{bytesValue:Jt(e.serializer,t)};if(t instanceof ws){var i=e.s,o=t.sf;if(!o.isEqual(i))throw e.Y_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:ee(t.sf||e.s,t.if.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Y_("Unsupported field value: "+Xo(t))}(t,e)}function ks(t,e){var n={};return D(t)?e.path&&e.path.length>0&&e.qe.push(e.path):S(t,(function(t,r){var i=xs(r,e.uf(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Ls(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof P||t instanceof gs||t instanceof is||t instanceof ws||t instanceof as)}function Ps(t,e,n){if(!Ls(n)||!Yo(n)){var r=Xo(n);throw"an object"===r?e.Y_(t+" a custom object"):e.Y_(t+" "+r)}}function Rs(t,e,n){if(e instanceof os)return e.j_;if("string"==typeof e)return Os(t,e);throw Cs("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Os(t,e,n){try{return function(t){if(t.search(us)>=0)throw new L(k.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(ss.bind.apply(ss,o.__spreadArrays([void 0],t.split("."))))}catch(e){throw new L(k.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).j_}catch(e){throw Cs((i=e)instanceof Error?i.message:i.toString(),t,!1,void 0,n)}var i}function Cs(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new L(k.INVALID_ARGUMENT,(u+=". ")+t+a)}function Us(t,e){return t.some((function(t){return t.isEqual(e)}))}var Vs=function(){function t(t){this.qa=t,this.Tf=new Map,this.mutations=[],this.Ef=!1,this.mf=null,this.If=new Set}return t.prototype.Af=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n=this;return o.__generator(this,(function(i){switch(i.label){case 0:if(this.Rf(),this.mutations.length>0)throw new L(k.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r,s,u,a;return o.__generator(this,(function(o){switch(o.label){case 0:return n=w(t),i=ue(n.serializer)+"/documents",r={documents:e.map((function(t){return re(n.serializer,t)}))},[4,n.Sa("BatchGetDocuments",i,r)];case 1:return s=o.sent(),u=new Map,s.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){m(!!e.found),e.found.name,e.found.updateTime;var n=ie(t,e.found.name),r=te(e.found.updateTime),i=new $e({mapValue:{fields:e.found.fields}});return new rn(n,r,i,{})}(t,e):"missing"in e?function(t,e){m(!!e.missing),m(!!e.readTime);var n=ie(t,e.missing),r=te(e.readTime);return new on(n,r)}(t,e):p()}(n.serializer,t);u.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=u.get(t.toString());m(!!e),a.push(e)})),a)]}}))}))}(this.qa,t)];case 1:return[2,((e=i.sent()).forEach((function(t){t instanceof on||t instanceof rn?n.Pf(t):p()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.hf(t,this.Qe(t))),this.If.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.hf(t,this.gf(t)))}catch(t){this.mf=t}this.If.add(t.toString())},t.prototype.delete=function(t){this.write([new Ze(t,this.Qe(t))]),this.If.add(t.toString())},t.prototype.commit=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e=this;return o.__generator(this,(function(n){switch(n.label){case 0:if(this.Rf(),this.mf)throw this.mf;return t=this.Tf,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=M.B(n);e.mutations.push(new Je(r,e.Qe(r)))})),[4,function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,i,r;return o.__generator(this,(function(o){switch(o.label){case 0:return n=w(t),i=ue(n.serializer)+"/documents",r={writes:e.map((function(t){return he(n.serializer,t)}))},[4,n.va("Commit",i,r)];case 1:return o.sent(),[2]}}))}))}(this.qa,this.mutations)];case 1:return n.sent(),this.Ef=!0,[2]}}))}))},t.prototype.Pf=function(t){var e;if(t instanceof rn)e=t.version;else{if(!(t instanceof on))throw p();e=R.min()}var n=this.Tf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new L(k.ABORTED,"Document version changed between two reads.")}else this.Tf.set(t.key.toString(),e)},t.prototype.Qe=function(t){var e=this.Tf.get(t.toString());return!this.If.has(t.toString())&&e?Ve.updateTime(e):Ve.We()},t.prototype.gf=function(t){var e=this.Tf.get(t.toString());if(!this.If.has(t.toString())&&e){if(e.isEqual(R.min()))throw new L(k.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ve.updateTime(e)}return Ve.exists(!0)},t.prototype.write=function(t){this.Rf(),this.mutations=this.mutations.concat(t)},t.prototype.Rf=function(){},t}(),Ms=function(){function t(t,e,n,r){this.ei=t,this.qa=e,this.updateFunction=n,this.ii=r,this.Vf=5,this.Ti=new Yn(this.ei,"transaction_retry")}return t.prototype.run=function(){this.yf()},t.prototype.yf=function(){var t=this;this.Ti.bs((function(){return o.__awaiter(t,void 0,void 0,(function(){var t,e,n=this;return o.__generator(this,(function(r){return t=new Vs(this.qa),(e=this.pf(t))&&e.then((function(e){n.ei.ai((function(){return t.commit().then((function(){n.ii.resolve(e)})).catch((function(t){n.bf(t)}))}))})).catch((function(t){n.bf(t)})),[2]}))}))}))},t.prototype.pf=function(t){try{var e=this.updateFunction(t);return!F(e)&&e.catch&&e.then?e:(this.ii.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ii.reject(t),null}},t.prototype.bf=function(t){var e=this;this.Vf>0&&this.vf(t)?(this.Vf-=1,this.ei.ai((function(){return e.yf(),Promise.resolve()}))):this.ii.reject(t)},t.prototype.vf=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!J(e)}return!1},t}(),qs=function(){function t(t,e){this.credentials=t,this.ei=e,this.clientId=g.t(),this.Sf=new Kn}return t.prototype.start=function(t,e,n,r){var i=this;this.Df(),this.w_=t;var o=new Kn,s=!1;return this.credentials.Bh((function(t){if(!s)return s=!0,l("FirestoreClient","Initializing. user=",t.uid),i.Cf(e,n,r,t,o).then(i.Sf.resolve,i.Sf.reject);i.ei.gi((function(){return i.Bu.vc(t)}))})),this.ei.ai((function(){return i.Sf.promise})),o.promise},t.prototype.enableNetwork=function(){var t=this;return this.Df(),this.ei.enqueue((function(){return t.persistence.Uo(!0),t.Bu.enableNetwork()}))},t.prototype.Cf=function(t,e,n,i,r){return o.__awaiter(this,void 0,void 0,(function(){var s,u,a=this;return o.__generator(this,(function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),s={ei:this.ei,w_:this.w_,clientId:this.clientId,credentials:this.credentials,N_:i,Qu:100,k_:n},[4,t.initialize(s)];case 1:return c.sent(),[4,e.initialize(t,s)];case 2:return c.sent(),this.persistence=t.persistence,this.Uu=t.Uu,this.La=t.La,this.S_=t.S_,this.qa=e.qa,this.Bu=e.Bu,this.fc=e.fc,this.Nf=e.q_,this.persistence.Bo((function(){return o.__awaiter(a,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),r.resolve(),[3,4];case 3:if(u=c.sent(),r.reject(u),!this.Ff(u))throw u;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+u),this.Cf(new Po,new Oo,{F_:!1},i,r))];case 4:return[2]}}))}))},t.prototype.Ff=function(t){return"FirebaseError"===t.name?t.code===k.FAILED_PRECONDITION||t.code===k.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.Df=function(){if(this.ei.mi)throw new L(k.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.disableNetwork=function(){var t=this;return this.Df(),this.ei.enqueue((function(){return t.persistence.Uo(!1),t.Bu.disableNetwork()}))},t.prototype.terminate=function(){var t=this;this.ei.Pi();var e=new Kn;return this.ei.Ii((function(){return o.__awaiter(t,void 0,void 0,(function(){var t,n;return o.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),this.S_&&this.S_.stop(),[4,this.Bu.th()];case 1:return r.sent(),[4,this.Uu.th()];case 2:return r.sent(),[4,this.persistence.th()];case 3:return r.sent(),this.credentials.Uh(),e.resolve(),[3,5];case 4:return t=r.sent(),n=ar(t,"Failed to shutdown persistence"),e.reject(n),[3,5];case 5:return[2]}}))}))})),e.promise},t.prototype.waitForPendingWrites=function(){var t=this;this.Df();var e=new Kn;return this.ei.ai((function(){return t.fc._l(e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.Df();var i=new Uo(n),o=new go(t,i,e);return this.ei.ai((function(){return r.Nf.listen(o)})),function(){i.Q_(),r.ei.ai((function(){return r.Nf.lc(o)}))}},t.prototype.kf=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(e.sent(),function(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var i,r=this;return o.__generator(this,(function(s){switch(s.label){case 0:return i=new Kn,[4,t.enqueue((function(){return o.__awaiter(r,void 0,void 0,(function(){var t,r,s;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=w(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Rh.Hn(t,e)}))}(e,n)];case 1:return(t=o.sent())instanceof rn?i.resolve(t):t instanceof on?i.resolve(null):i.reject(new L(k.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),s=ar(r,"Failed to get document '"+n+" from cache"),i.reject(s),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(s.sent(),i.promise)]}}))}))}(this.ei,this.La,t))]}}))}))},t.prototype.$f=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(n){switch(n.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(n.sent(),function(t,e,n,r){var i=new Kn,o=Fs(t,e,hn(n.path),{includeMetadataChanges:!0,$l:!0},{next:function(t){o();var e=t.docs.has(n);!e&&t.fromCache?i.reject(new L(k.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&r&&"server"===r.source?i.reject(new L(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(t)},error:function(t){return i.reject(t)}});return i.promise}(this.ei,this.Nf,t,e))]}}))}))},t.prototype.xf=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(e.sent(),function(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var i,r=this;return o.__generator(this,(function(s){switch(s.label){case 0:return i=new Kn,[4,t.enqueue((function(){return o.__awaiter(r,void 0,void 0,(function(){var t,r,s,u,a,c;return o.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Si(e,n,!0)];case 1:return t=o.sent(),r=new no(n,t.gh),s=r.Su(t.documents),u=r.Un(s,!1),i.resolve(u.snapshot),[3,3];case 2:return a=o.sent(),c=ar(a,"Failed to execute query '"+n+" against cache"),i.reject(c),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(s.sent(),i.promise)]}}))}))}(this.ei,this.La,t))]}}))}))},t.prototype.Of=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(n){switch(n.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(n.sent(),function(t,e,n,r){var i=new Kn,o=Fs(t,e,n,{includeMetadataChanges:!0,$l:!0},{next:function(t){o(),t.fromCache&&r&&"server"===r.source?i.reject(new L(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}});return i.promise}(this.ei,this.Nf,t,e))]}}))}))},t.prototype.write=function(t){var e=this;this.Df();var n=new Kn;return this.ei.ai((function(){return e.fc.write(t,n)})),n.promise},t.prototype.s=function(){return this.w_.s},t.prototype.bl=function(t){var e=this;this.Df();var n=new Uo(t);return this.ei.ai((function(){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(t){return[2,this.Nf.bl(n)]}))}))})),function(){n.Q_(),e.ei.ai((function(){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(t){return[2,this.Nf.vl(n)]}))}))}))}},Object.defineProperty(t.prototype,"Mf",{get:function(){return this.ei.mi},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.Df();var n=new Kn;return this.ei.ai((function(){return new Ms(e.ei,e.qa,t,n).run(),Promise.resolve()})),n.promise},t}();function Fs(t,e,n,r,i){var o=new Uo(i),s=new go(n,o,r);return t.ai((function(){return e.listen(s)})),function(){o.Q_(),t.ai((function(){return e.lc(s)}))}}var js=function(){function t(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.Lf=n,this.qf=r}return t.prototype.Bf=function(t){switch(kt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Vt(t.integerValue||t.doubleValue);case 3:return this.Uf(t.timestampValue);case 4:return this.Qf(t);case 5:return t.stringValue;case 6:return new is(Mt(t.bytesValue));case 7:return this.Wf(t.referenceValue);case 8:return this.jf(t.geoPointValue);case 9:return this.Kf(t.arrayValue);case 10:return this.Gf(t.mapValue);default:throw p()}},t.prototype.Gf=function(t){var e=this,n={};return S(t.fields||{},(function(t,r){n[t]=e.Bf(r)})),n},t.prototype.jf=function(t){return new gs(Vt(t.latitude),Vt(t.longitude))},t.prototype.Kf=function(t){var e=this;return(t.values||[]).map((function(t){return e.Bf(t)}))},t.prototype.Qf=function(t){switch(this.Lf){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return St(n)?t(n):n}(t);return null==e?null:this.Bf(e);case"estimate":return this.Uf(Dt(t));default:return null}},t.prototype.Uf=function(t){var e=Ut(t),n=new P(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.Wf=function(t){var e=C.k(t);m(_e(e));var n=new A(e.get(1),e.get(3)),r=new M(e.V(5));return n.isEqual(this.s)||d("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.qf(r)},t}(),Gs=pr.ji,Bs=function(){function t(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new L(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Bo("settings","non-empty string","host",t.host),this.host=t.host,zo("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Zo("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),zo("settings","object","credentials",t.credentials),this.credentials=t.credentials,zo("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),zo("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?d("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&d("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,zo("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=pr.Gi;else{if(t.cacheSizeBytes!==Gs&&t.cacheSizeBytes<pr.Ki)throw new L(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+pr.Ki);this.cacheSizeBytes=t.cacheSizeBytes}zo("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),zs=function(){function t(e,n,i,r){var s=this;if(void 0===i&&(i=new Po),void 0===r&&(r=new Oo),this.zf=i,this.Hf=r,this.Yf=null,this.Jf=new ur,this.INTERNAL={delete:function(){return o.__awaiter(s,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.Xf(),[4,this.Zf.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof e.options){var u=e;this.Yf=u,this.sf=t.td(u),this.ed=u.name,this.nd=new Ci(n)}else{var a=e;if(!a.projectId)throw new L(k.INVALID_ARGUMENT,"Must provide projectId");this.sf=new A(a.projectId,a.database),this.ed="[DEFAULT]",this.nd=new Oi}this.sd=new Bs({})}return Object.defineProperty(t.prototype,"rd",{get:function(){return this.od||(this.od=new Ts(this.sf,this.sd.ignoreUndefinedProperties)),this.od},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){Mo("Firestore.settings",arguments,1),jo("Firestore.settings","object",1,t);var e=new Bs(t);if(this.Zf&&!this.sd.isEqual(e))throw new L(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.sd=e,void 0!==e.credentials&&(this.nd=function(t){if(!t)return new Oi;switch(t.type){case"gapi":var e=t.hd;return m(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Vi(e,t.zh||"0");case"provider":return t.hd;default:throw new L(k.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.Xf(),this.Zf.enableNetwork()},t.prototype.disableNetwork=function(){return this.Xf(),this.Zf.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this.Zf)throw new L(k.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&d("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new L(k.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.ad(this.zf,this.Hf,{F_:!0,cacheSizeBytes:this.sd.cacheSizeBytes,synchronizeTabs:r,Vo:i})},t.prototype.clearPersistence=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e=this;return o.__generator(this,(function(n){if(void 0!==this.Zf&&!this.Zf.Mf)throw new L(k.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new Kn,[2,(this.Jf.Ii((function(){return o.__awaiter(e,void 0,void 0,(function(){var e;return o.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.zf.clearPersistence(this.sf,this.ed)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"ud",{get:function(){return this.Xf(),this.Zf.Mf},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.Xf(),this.Zf.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.Xf(),Co(t))return this.Zf.bl(t);jo("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Zf.bl(e)},t.prototype.Xf=function(){return this.Zf||this.ad(new Po,new Oo,{F_:!1}),this.Zf},t.prototype.ld=function(){return new b(this.sf,this.ed,this.sd.host,this.sd.ssl,this.sd.forceLongPolling)},t.prototype.ad=function(t,e,n){var r=this.ld();return this.Zf=new qs(this.nd,this.Jf),this.Zf.start(r,t,e,n)},t.td=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new L(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new L(k.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new A(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Yf)throw new L(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Yf},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return Mo("Firestore.collection",arguments,1),jo("Firestore.collection","non-empty string",1,t),this.Xf(),new ou(C.k(t),this,null)},t.prototype.doc=function(t){return Mo("Firestore.doc",arguments,1),jo("Firestore.doc","non-empty string",1,t),this.Xf(),Ks._d(C.k(t),this,null)},t.prototype.collectionGroup=function(t){if(Mo("Firestore.collectionGroup",arguments,1),jo("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new L(k.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Xf(),new ru(function(t){return new an(C.$(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return Mo("Firestore.runTransaction",arguments,1),jo("Firestore.runTransaction","function",1,t),this.Xf().transaction((function(n){return t(new Hs(e,n))}))},t.prototype.batch=function(){return this.Xf(),new Ws(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(a()){case h.LogLevel.DEBUG:return"debug";case h.LogLevel.ERROR:return"error";case h.LogLevel.SILENT:return"silent";case h.LogLevel.WARN:return"warn";case h.LogLevel.INFO:return"info";case h.LogLevel.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;Mo("Firestore.setLogLevel",arguments,1),Wo("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),e=t,u.setLogLevel(e)},t.prototype.fd=function(){return this.sd.timestampsInSnapshots},t}(),Hs=function(){function t(t,e){this.dd=t,this.wd=e}return t.prototype.get=function(t){var e=this;Mo("Transaction.get",arguments,1);var n=cu("Transaction.get",t,this.dd);return this.wd.Af([n.if]).then((function(t){if(!t||1!==t.length)return p();var r=t[0];if(r instanceof on)return new Xs(e.dd,n.if,null,!1,!1,n.rf);if(r instanceof rn)return new Xs(e.dd,n.if,r,!1,!1,n.rf);throw p()}))},t.prototype.set=function(t,e,n){Fo("Transaction.set",arguments,2,3);var r=cu("Transaction.set",t,this.dd);n=su("Transaction.set",n);var i=fu(r.rf,e,n),o=As(this.dd.rd,"Transaction.set",r.if,i,null!==r.rf,n);return this.wd.set(r.if,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof ss?(qo("Transaction.update",arguments,3),r=cu("Transaction.update",t,this.dd),i=Ss(this.dd.rd,"Transaction.update",r.if,e,n,o)):(Mo("Transaction.update",arguments,2),r=cu("Transaction.update",t,this.dd),i=Ns(this.dd.rd,"Transaction.update",r.if,e)),this.wd.update(r.if,i),this},t.prototype.delete=function(t){Mo("Transaction.delete",arguments,1);var e=cu("Transaction.delete",t,this.dd);return this.wd.delete(e.if),this},t}(),Ws=function(){function t(t){this.dd=t,this.Td=[],this.Ed=!1}return t.prototype.set=function(t,e,n){Fo("WriteBatch.set",arguments,2,3),this.md();var r=cu("WriteBatch.set",t,this.dd);n=su("WriteBatch.set",n);var i=fu(r.rf,e,n),o=As(this.dd.rd,"WriteBatch.set",r.if,i,null!==r.rf,n);return this.Td=this.Td.concat(o.hf(r.if,Ve.We())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.md(),"string"==typeof e||e instanceof ss?(qo("WriteBatch.update",arguments,3),r=cu("WriteBatch.update",t,this.dd),i=Ss(this.dd.rd,"WriteBatch.update",r.if,e,n,o)):(Mo("WriteBatch.update",arguments,2),r=cu("WriteBatch.update",t,this.dd),i=Ns(this.dd.rd,"WriteBatch.update",r.if,e)),this.Td=this.Td.concat(i.hf(r.if,Ve.exists(!0))),this},t.prototype.delete=function(t){Mo("WriteBatch.delete",arguments,1),this.md();var e=cu("WriteBatch.delete",t,this.dd);return this.Td=this.Td.concat(new Ze(e.if,Ve.We())),this},t.prototype.commit=function(){return this.md(),this.Ed=!0,this.Td.length>0?this.dd.Xf().write(this.Td):Promise.resolve()},t.prototype.md=function(){if(this.Ed)throw new L(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Ks=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.sf,e,r)||this).if=e,i.firestore=n,i.rf=r,i.Zf=i.firestore.Xf(),i}return o.__extends(e,t),e._d=function(t,n,r){if(t.length%2!=0)throw new L(k.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.F()+" has "+t.length);return new e(new M(t),n,r)},Object.defineProperty(e.prototype,"id",{get:function(){return this.if.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new ou(this.if.path.p(),this.firestore,this.rf)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.if.path.F()},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){if(Mo("DocumentReference.collection",arguments,1),jo("DocumentReference.collection","non-empty string",1,t),!t)throw new L(k.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=C.k(t);return new ou(this.if.path.child(e),this.firestore,null)},e.prototype.isEqual=function(t){if(!(t instanceof e))throw Jo("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.if.isEqual(t.if)&&this.rf===t.rf},e.prototype.set=function(t,e){Fo("DocumentReference.set",arguments,1,2),e=su("DocumentReference.set",e);var n=fu(this.rf,t,e),r=As(this.firestore.rd,"DocumentReference.set",this.if,n,null!==this.rf,e);return this.Zf.write(r.hf(this.if,Ve.We()))},e.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof ss?(qo("DocumentReference.update",arguments,2),n=Ss(this.firestore.rd,"DocumentReference.update",this.if,t,e,r)):(Mo("DocumentReference.update",arguments,1),n=Ns(this.firestore.rd,"DocumentReference.update",this.if,t)),this.Zf.write(n.hf(this.if,Ve.exists(!0)))},e.prototype.delete=function(){return Mo("DocumentReference.delete",arguments,0),this.Zf.write([new Ze(this.if,Ve.We())])},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Fo("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Co(i[u])||(Zo("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),zo("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a={includeMetadataChanges:s.includeMetadataChanges};if(Co(i[u])){var c=i[u];i[u]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[u+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[u+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}else jo("DocumentReference.onSnapshot","function",u,i[u]),Go("DocumentReference.onSnapshot","function",u+1,i[u+1]),Go("DocumentReference.onSnapshot","function",u+2,i[u+2]);var h={next:function(t){i[u]&&i[u](r.Id(t))},error:i[u+1],complete:i[u+2]};return this.Zf.listen(hn(this.if.path),a,h)},e.prototype.get=function(t){var e=this;Fo("DocumentReference.get",arguments,0,1),au("DocumentReference.get",t);var n=this.firestore.Xf();return t&&"cache"===t.source?n.kf(this.if).then((function(t){return new Xs(e.firestore,e.if,t,!0,t instanceof rn&&t.Ge,e.rf)})):n.$f(this.if,t).then((function(t){return e.Id(t)}))},e.prototype.withConverter=function(t){return new e(this.if,this.firestore,t)},e.prototype.Id=function(t){var e=t.docs.get(this.if);return new Xs(this.firestore,this.if,e,t.fromCache,t.hasPendingWrites,this.rf)},e}(ws),Ys=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Xs=function(){function t(t,e,n,r,i,o){this.dd=t,this.if=e,this.Ad=n,this.Rd=r,this.Pd=i,this.rf=o}return t.prototype.data=function(t){var e=this;if(Fo("DocumentSnapshot.data",arguments,0,1),t=uu("DocumentSnapshot.data",t),this.Ad){if(this.rf){var n=new Qs(this.dd,this.if,this.Ad,this.Rd,this.Pd,null);return this.rf.fromFirestore(n,t)}return new js(this.dd.sf,this.dd.fd(),t.serverTimestamps||"none",(function(t){return new Ks(t,e.dd,null)})).Bf(this.Ad.tn())}},t.prototype.get=function(t,e){var n=this;if(Fo("DocumentSnapshot.get",arguments,1,2),e=uu("DocumentSnapshot.get",e),this.Ad){var r=this.Ad.data().field(Rs("DocumentSnapshot.get",t,this.if));if(null!==r)return new js(this.dd.sf,this.dd.fd(),e.serverTimestamps||"none",(function(t){return new Ks(t,n.dd,n.rf)})).Bf(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.if.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Ks(this.if,this.dd,this.rf)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Ad},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Ys(this.Pd,this.Rd)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Jo("isEqual","DocumentSnapshot",1,e);return this.dd===e.dd&&this.Rd===e.Rd&&this.if.isEqual(e.if)&&(null===this.Ad?null===e.Ad:this.Ad.isEqual(e.Ad))&&this.rf===e.rf},t}(),Qs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.data=function(e){return t.prototype.data.call(this,e)},e}(Xs);function Zs(t,e,n,r,i,o,s){var u;if(i.M()){if("array-contains"===o||"array-contains-any"===o)throw new L(k.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){tu(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push($s(r,t,f))}u={arrayValue:{values:a}}}else u=$s(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||tu(s,o),u=Ds(n,e,s,"in"===o||"not-in"===o);var l=In.create(i,o,u);return function(t,e){if(e._n()){var n=t.ln();if(null!==n&&!n.isEqual(e.field))throw new L(k.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=t.un();null!==r&&eu(t,e.field,r)}var i=t.fn(function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new L(k.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new L(k.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}function Js(t,e,n){if(null!==t.startAt)throw new L(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new L(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Cn(e,n);return function(t,e){if(null===t.un()){var n=t.ln();null!==n&&eu(t,n,e.field)}}(t,r),r}function $s(t,e,n){if("string"==typeof n){if(""===n)throw new L(k.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!fn(e)&&-1!==n.indexOf("/"))throw new L(k.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(C.k(n));if(!M.j(r))throw new L(k.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return qt(t,new M(r))}if(n instanceof ws)return qt(t,n.if);throw new L(k.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Xo(n)+".")}function tu(t,e){if(!Array.isArray(t)||0===t.length)throw new L(k.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new L(k.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new L(k.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new L(k.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function eu(t,e,n){if(!n.isEqual(e))throw new L(k.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function nu(t){if(t.cn()&&0===t.en.length)throw new L(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ru=function(){function t(t,e,n){this.gd=t,this.firestore=e,this.rf=n}return t.prototype.where=function(e,n,r){var i;Mo("Query.where",arguments,3),Qo("Query.where",3,r),i="not-in"===n||"!="===n?n:Wo("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,n);var o=Rs("Query.where",e),s=Zs(this.gd,"Query.where",this.firestore.rd,this.firestore.sf,o,i,r);return new t(function(t,e){var n=t.filters.concat([e]);return new an(t.path,t.collectionGroup,t.en.slice(),n,t.limit,t.nn,t.startAt,t.endAt)}(this.gd,s),this.firestore,this.rf)},t.prototype.orderBy=function(e,n){var r;if(Fo("Query.orderBy",arguments,1,2),Go("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new L(k.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=Rs("Query.orderBy",e),o=Js(this.gd,i,r);return new t(function(t,e){var n=t.en.concat([e]);return new an(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.nn,t.startAt,t.endAt)}(this.gd,o),this.firestore,this.rf)},t.prototype.limit=function(e){return Mo("Query.limit",arguments,1),jo("Query.limit","number",1,e),$o("Query.limit",1,e),new t(dn(this.gd,e,"F"),this.firestore,this.rf)},t.prototype.limitToLast=function(e){return Mo("Query.limitToLast",arguments,1),jo("Query.limitToLast","number",1,e),$o("Query.limitToLast",1,e),new t(dn(this.gd,e,"L"),this.firestore,this.rf)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];qo("Query.startAt",arguments,1);var i=this.Vd("Query.startAt",e,n,!0);return new t(vn(this.gd,i),this.firestore,this.rf)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];qo("Query.startAfter",arguments,1);var i=this.Vd("Query.startAfter",e,n,!1);return new t(vn(this.gd,i),this.firestore,this.rf)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];qo("Query.endBefore",arguments,1);var i=this.Vd("Query.endBefore",e,n,!0);return new t(yn(this.gd,i),this.firestore,this.rf)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];qo("Query.endAt",arguments,1);var i=this.Vd("Query.endAt",e,n,!1);return new t(yn(this.gd,i),this.firestore,this.rf)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Jo("isEqual","Query",1,e);return this.firestore===e.firestore&&gn(this.gd,e.gd)&&this.rf===e.rf},t.prototype.withConverter=function(e){return new t(this.gd,this.firestore,e)},t.prototype.Vd=function(t,e,n,i){if(Qo(t,1,e),e instanceof Xs)return Mo(t,o.__spreadArrays([e],n),1),function(t,e,n,r,i){if(!r)throw new L(k.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=ln(t);s<u.length;s++){var a=u[s];if(a.field.M())o.push(qt(e,r.key));else{var c=r.field(a.field);if(St(c))throw new L(k.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.F();throw new L(k.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Ln(o,i)}(this.gd,this.firestore.sf,t,e.Ad,i);var r=[e].concat(n);return function(t,e,n,r,i,o){var s=t.en;if(i.length>s.length)throw new L(k.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.M()){if("string"!=typeof c)throw new L(k.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!fn(t)&&-1!==c.indexOf("/"))throw new L(k.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(C.k(c));if(!M.j(h))throw new L(k.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new M(h);u.push(qt(e,f))}else{var l=Ds(n,r,c);u.push(l)}}return new Ln(u,o)}(this.gd,this.firestore.sf,this.firestore.rd,t,r,i)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Fo("Query.onSnapshot",arguments,1,4);var s={},u=0;if("object"!=typeof i[u]||Co(i[u])||(Zo("Query.onSnapshot",s=i[u],["includeMetadataChanges"]),zo("Query.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++),Co(i[u])){var a=i[u];i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}else jo("Query.onSnapshot","function",u,i[u]),Go("Query.onSnapshot","function",u+1,i[u+1]),Go("Query.onSnapshot","function",u+2,i[u+2]);var c={next:function(t){i[u]&&i[u](new iu(r.firestore,r.gd,t,r.rf))},error:i[u+1],complete:i[u+2]};return nu(this.gd),this.firestore.Xf().listen(this.gd,s,c)},t.prototype.get=function(t){var e=this;Fo("Query.get",arguments,0,1),au("Query.get",t),nu(this.gd);var n=this.firestore.Xf();return(t&&"cache"===t.source?n.xf(this.gd):n.Of(this.gd,t)).then((function(t){return new iu(e.firestore,e.gd,t,e.rf)}))},t}(),iu=function(){function t(t,e,n,r){this.dd=t,this.yd=e,this.pd=n,this.rf=r,this.bd=null,this.vd=null,this.metadata=new Ys(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.pd.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.pd.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;Fo("QuerySnapshot.forEach",arguments,1,2),jo("QuerySnapshot.forEach","function",1,t),this.pd.docs.forEach((function(r){t.call(e,n.Sd(r,n.metadata.fromCache,n.pd.qt.has(r.key)))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new ru(this.yd,this.dd,this.rf)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(Zo("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),zo("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.pd.Ut)throw new L(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.bd&&this.vd===e||(this.bd=function(t,e,n){if(t.Lt._()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.qt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Lt;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.qt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:hu(e.type),doc:r,oldIndex:o,newIndex:s}}))}(this.pd,e,this.Sd.bind(this)),this.vd=e),this.bd},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Jo("isEqual","QuerySnapshot",1,e);return this.dd===e.dd&&gn(this.yd,e.yd)&&this.pd.isEqual(e.pd)&&this.rf===e.rf},t.prototype.Sd=function(t,e,n){return new Qs(this.dd,t.key,t,e,n,this.rf)},t}(),ou=function(t){function e(e,n,r){var i=this;if((i=t.call(this,hn(e),n,r)||this).Dd=e,e.length%2!=1)throw new L(k.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.F()+" has "+e.length);return i}return o.__extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.gd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.gd.path.p();return t._()?null:new Ks(new M(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.gd.path.F()},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){Fo("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=g.t()),jo("CollectionReference.doc","non-empty string",1,t);var e=C.k(t);return Ks._d(this.gd.path.child(e),this.firestore,this.rf)},e.prototype.add=function(t){Mo("CollectionReference.add",arguments,1),jo("CollectionReference.add","object",1,this.rf?this.rf.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e}))},e.prototype.withConverter=function(t){return new e(this.Dd,this.firestore,t)},e}(ru);function su(t,e){if(void 0===e)return{merge:!1};if(Zo(t,e,["merge","mergeFields"]),zo(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new L(k.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Xo(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new L(k.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+Xo(r[o]))}(t,"mergeFields",0,r,(function(t){return"string"==typeof t||t instanceof ss}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new L(k.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function uu(t,e){return void 0===e?{}:(Zo(t,e,["serverTimestamps"]),Ho(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function au(t,e){Go(t,"object",1,e),e&&(Zo(t,e,["source"]),Ho(t,0,"source",e.source,["default","server","cache"]))}function cu(t,e,n){if(e instanceof ws){if(e.firestore!==n)throw new L(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Jo(t,"DocumentReference",1,e)}function hu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return p()}}function fu(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var lu={Firestore:zs,GeoPoint:gs,Timestamp:P,Blob:is,Transaction:Hs,WriteBatch:Ws,DocumentReference:Ks,DocumentSnapshot:Xs,Query:ru,QueryDocumentSnapshot:Qs,QuerySnapshot:iu,CollectionReference:ou,FieldPath:ss,FieldValue:vs,setLogLevel:zs.setLogLevel,CACHE_SIZE_UNLIMITED:Gs};function pu(t){!function(t,e){t.INTERNAL.registerComponent(new s.Component("firestore",(function(t){return function(t,e){var n=new Oo,r=new Ro(n);return new zs(t,e,r,n)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},lu)))}(t),t.registerVersion("@firebase/firestore","1.16.5")}pu(c),e.__PRIVATE_registerFirestore=pu}).call(this,n(211))},327:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"ErrorCode",(function(){return sr})),n.d(e,"EventType",(function(){return ur})),n.d(e,"WebChannel",(function(){return ar})),n.d(e,"XhrIo",(function(){return cr})),n.d(e,"createWebChannelTransport",(function(){return or}));var r=function(t,b){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,b){t.__proto__=b}||function(t,b){for(var p in b)b.hasOwnProperty(p)&&(t[p]=b[p])})(t,b)};function o(t){var s="function"==typeof Symbol&&Symbol.iterator,e=s&&t[s],i=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}var g,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},h=h||{},f=c||self;function l(){}function d(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}function v(a){var b=d(a);return"array"==b||"object"==b&&"number"==typeof a.length}function y(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),w=0;function _(a,b,t){return a.call.apply(a.bind,arguments)}function I(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function p(a,b,t){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_:I).apply(null,arguments)}function E(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}var q=Date.now;function T(a,b){function t(){}t.prototype=b.prototype,a.S=b.prototype,a.prototype=new t,a.prototype.constructor=a}function u(){this.j=this.j,this.i=this.i}u.prototype.j=!1,u.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(a){Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++w)})(this)},u.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var A=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(var t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1},N=Array.prototype.forEach?function(a,b,t){Array.prototype.forEach.call(a,b,t)}:function(a,b,t){for(var e=a.length,n="string"==typeof a?a.split(""):a,r=0;r<e;r++)r in n&&b.call(t,n[r],r,a)};function S(a){return Array.prototype.concat.apply([],arguments)}function D(a){var b=a.length;if(0<b){for(var t=Array(b),e=0;e<b;e++)t[e]=a[e];return t}return[]}function x(a){return/^[\s\xa0]*$/.test(a)}var k,L=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function P(a,b){return-1!=a.indexOf(b)}function R(a,b){return a<b?-1:a>b?1:0}t:{var O=f.navigator;if(O){var C=O.userAgent;if(C){k=C;break t}}k=""}function U(a,b,t){for(var e in a)b.call(t,a[e],e,a)}function V(a){var b={};for(var t in a)b[t]=a[t];return b}var M="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(a,b){for(var t,e,n=1;n<arguments.length;n++){for(t in e=arguments[n])a[t]=e[t];for(var r=0;r<M.length;r++)t=M[r],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function j(a){return j[" "](a),a}j[" "]=l;var G,a,B=P(k,"Opera"),z=P(k,"Trident")||P(k,"MSIE"),H=P(k,"Edge"),W=H||z,K=P(k,"Gecko")&&!(P(k.toLowerCase(),"webkit")&&!P(k,"Edge"))&&!(P(k,"Trident")||P(k,"MSIE"))&&!P(k,"Edge"),Y=P(k.toLowerCase(),"webkit")&&!P(k,"Edge");function X(){var a=f.document;return a?a.documentMode:void 0}t:{var Q="",Z=(a=k,K?/rv:([^\);]+)(\)|;)/.exec(a):H?/Edge\/([\d\.]+)/.exec(a):z?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):Y?/WebKit\/(\S+)/.exec(a):B?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(Z&&(Q=Z?Z[1]:""),z){var J=X();if(null!=J&&J>parseFloat(Q)){G=String(J);break t}}G=Q}var $,tt={};function et(a){return function(a,b){var t=tt;return Object.prototype.hasOwnProperty.call(t,a)?t[a]:t[a]=b(a)}(a,(function(){for(var b=0,t=L(String(G)).split("."),e=L(String(a)).split("."),n=Math.max(t.length,e.length),r=0;0==b&&r<n;r++){var o=t[r]||"",c=e[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],c=/(\d*)(\D*)(.*)/.exec(c)||["","","",""],0==o[0].length&&0==c[0].length)break;b=R(0==o[1].length?0:parseInt(o[1],10),0==c[1].length?0:parseInt(c[1],10))||R(0==o[2].length,0==c[2].length)||R(o[2],c[2]),o=o[3],c=c[3]}while(0==b)}return 0<=b}))}if(f.document&&z){var nt=X();$=nt||(parseInt(G,10)||void 0)}else $=void 0;var it=$,ot=!z||9<=Number(it),st=z&&!et("9"),ut=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{f.addEventListener("test",l,b),f.removeEventListener("test",l,b)}catch(t){}return a}();function at(a,b){this.type=a,this.a=this.target=b,this.defaultPrevented=!1}function ct(a,b){if(at.call(this,a?a.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.a=b,b=a.relatedTarget){if(K){t:{try{j(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:ht[a.pointerType]||"",this.c=a,a.defaultPrevented&&this.b()}}at.prototype.b=function(){this.defaultPrevented=!0},T(ct,at);var ht={2:"touch",3:"pen",4:"mouse"};ct.prototype.b=function(){ct.S.b.call(this);var a=this.c;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,st)try{(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)&&(a.keyCode=-1)}catch(t){}};var ft="closure_listenable_"+(1e6*Math.random()|0),lt=0;function pt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ca=n,this.key=++lt,this.Y=this.Z=!1}function vt(a){a.Y=!0,a.listener=null,a.proxy=null,a.src=null,a.ca=null}function yt(a){this.src=a,this.a={},this.b=0}function gt(a,b){var t=b.type;if(t in a.a){var e,n=a.a[t],r=A(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(vt(b),0==a.a[t].length&&(delete a.a[t],a.b--))}}function mt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.Y&&r.listener==b&&r.capture==!!t&&r.ca==e)return n}return-1}yt.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.a[r])||(a=this.a[r]=[],this.b++);var o=mt(a,b,e,n);return-1<o?(b=a[o],t||(b.Z=!1)):((b=new pt(b,this.src,r,!!e,n)).Z=t,a.push(b)),b};var wt="closure_lm_"+(1e6*Math.random()|0),bt={};function _t(a,b,t,e,n){if(e&&e.once)return function t(a,b,e,n,r){if(Array.isArray(b)){for(var o=0;o<b.length;o++)t(a,b[o],e,n,r);return null}return e=xt(e),a&&a[ft]?a.wa(b,e,y(n)?!!n.capture:!!n,r):It(a,b,e,!0,n,r)}(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)_t(a,b[r],t,e,n);return null}return t=xt(t),a&&a[ft]?a.va(b,t,y(e)?!!e.capture:!!e,n):It(a,b,t,!1,e,n)}function It(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=y(n)?!!n.capture:!!n;if(o&&!ot)return null;var c=St(a);if(c||(a[wt]=c=new yt(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){var a=Nt,b=ot?function(t){return a.call(b.src,b.listener,t)}:function(t){if(!(t=a.call(b.src,b.listener,t)))return t};return b}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)ut||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(Tt(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function Et(a){if("number"!=typeof a&&a&&!a.Y){var b=a.src;if(b&&b[ft])gt(b.c,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(Tt(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=St(b))?(gt(t,a),0==t.b&&(t.src=null,b[wt]=null)):vt(a)}}}function Tt(a){return a in bt?bt[a]:bt[a]="on"+a}function At(a,b){var t=a.listener,e=a.ca||a.src;return a.Z&&Et(a),t.call(e,b)}function Nt(a,b){if(a.Y)return!0;if(!ot){if(!b)t:{b=["window","event"];for(var t=f,e=0;e<b.length;e++)if(null==(t=t[b[e]])){b=null;break t}b=t}return At(a,b=new ct(b,this))}return At(a,new ct(b,this))}function St(a){return(a=a[wt])instanceof yt?a:null}var Dt="__closure_events_fn_"+(1e9*Math.random()>>>0);function xt(a){return"function"==d(a)?a:(a[Dt]||(a[Dt]=function(b){return a.handleEvent(b)}),a[Dt])}function kt(){u.call(this),this.c=new yt(this),this.J=this,this.C=null}function Lt(a,b,t,e){if(!(b=a.c.a[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.Y&&o.capture==t){var c=o.listener,h=o.ca||o.src;o.Z&&gt(a.c,o),n=!1!==c.call(h,e)&&n}}return n&&!e.defaultPrevented}T(kt,u),kt.prototype[ft]=!0,(g=kt.prototype).addEventListener=function(a,b,t,e){_t(this,a,b,t,e)},g.removeEventListener=function(a,b,t,e){!function t(a,b,e,n,r){if(Array.isArray(b))for(var o=0;o<b.length;o++)t(a,b[o],e,n,r);else n=y(n)?!!n.capture:!!n,e=xt(e),a&&a[ft]?(a=a.c,(b=String(b).toString())in a.a&&(-1<(e=mt(o=a.a[b],e,n,r))&&(vt(o[e]),Array.prototype.splice.call(o,e,1),0==o.length&&(delete a.a[b],a.b--)))):a&&(a=St(a))&&(b=a.a[b.toString()],a=-1,b&&(a=mt(b,e,n,r)),(e=-1<a?b[a]:null)&&Et(e))}(this,a,b,t,e)},g.dispatchEvent=function(a){var b,t=this.C;if(t)for(b=[];t;t=t.C)b.push(t);t=this.J;var e=a.type||a;if("string"==typeof a)a=new at(a,t);else if(a instanceof at)a.target=a.target||t;else{var n=a;F(a=new at(e,t),n)}if(n=!0,b)for(var r=b.length-1;0<=r;r--){var o=a.a=b[r];n=Lt(o,e,!0,a)&&n}if(n=Lt(o=a.a=t,e,!0,a)&&n,n=Lt(o,e,!1,a)&&n,b)for(r=0;r<b.length;r++)n=Lt(o=a.a=b[r],e,!1,a)&&n;return n},g.G=function(){if(kt.S.G.call(this),this.c){var t,a=this.c;for(t in a.a){for(var e=a.a[t],n=0;n<e.length;n++)vt(e[n]);delete a.a[t],a.b--}}this.C=null},g.va=function(a,b,t,e){return this.c.add(String(a),b,!1,t,e)},g.wa=function(a,b,t,e){return this.c.add(String(a),b,!0,t,e)};var Pt=f.JSON.stringify;function Rt(){this.b=this.a=null}var Ot,Ct=new(function(){function t(a,b,t){this.f=t,this.c=a,this.g=b,this.b=0,this.a=null}return t.prototype.get=function(){var a;return 0<this.b?(this.b--,a=this.a,this.a=a.next,a.next=null):a=this.c(),a},t}())((function(){return new Vt}),(function(a){a.reset()}),100);function Ut(){var a=jt,b=null;return a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null),b}function Vt(){this.next=this.b=this.a=null}function Mt(a){f.setTimeout((function(){throw a}),0)}function qt(a,b){Ot||function(){var a=f.Promise.resolve(void 0);Ot=function(){a.then(Gt)}}(),Ft||(Ot(),Ft=!0),jt.add(a,b)}Rt.prototype.add=function(a,b){var t=Ct.get();t.set(a,b),this.b?this.b.next=t:this.a=t,this.b=t},Vt.prototype.set=function(a,b){this.a=a,this.b=b,this.next=null},Vt.prototype.reset=function(){this.next=this.b=this.a=null};var Ft=!1,jt=new Rt;function Gt(){for(var a;a=Ut();){try{a.a.call(a.b)}catch(t){Mt(t)}var b=Ct;b.g(a),b.b<b.f&&(b.b++,a.next=b.a,b.a=a)}Ft=!1}function Bt(a,b){kt.call(this),this.b=a||1,this.a=b||f,this.f=p(this.Ya,this),this.g=q()}function zt(a){a.aa=!1,a.M&&(a.a.clearTimeout(a.M),a.M=null)}function Ht(a,b,t){if("function"==d(a))t&&(a=p(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=p(a.handleEvent,a)}return 2147483647<Number(b)?-1:f.setTimeout(a,b||0)}function Wt(a){a.a=Ht((function(){a.a=null,a.c&&(a.c=!1,Wt(a))}),a.h);var b=a.b;a.b=null,a.g.apply(null,b)}T(Bt,kt),(g=Bt.prototype).aa=!1,g.M=null,g.Ya=function(){if(this.aa){var a=q()-this.g;0<a&&a<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-a):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(zt(this),this.start()))}},g.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},g.G=function(){Bt.S.G.call(this),zt(this),delete this.a};var Kt=function(t){function e(a,b,e){var n=t.call(this)||this;return n.g=null!=e?a.bind(e):a,n.h=b,n.b=null,n.c=!1,n.a=null,n}return function(t,b){function e(){this.constructor=t}r(t,b),t.prototype=null===b?Object.create(b):(e.prototype=b.prototype,new e)}(e,t),e.prototype.f=function(a){this.b=arguments,this.a?this.c=!0:Wt(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(f.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(u);function Yt(a){u.call(this),this.b=a,this.a={}}T(Yt,u);var Xt=[];function Qt(a,b,t,e){Array.isArray(t)||(t&&(Xt[0]=t.toString()),t=Xt);for(var n=0;n<t.length;n++){var r=_t(b,t[n],e||a.handleEvent,!1,a.b||a);if(!r)break;a.a[r.key]=r}}function Zt(a){U(a.a,(function(b,t){this.a.hasOwnProperty(t)&&Et(b)}),a),a.a={}}function Jt(){this.a=!0}function $t(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.a)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Pt(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}Yt.prototype.G=function(){Yt.S.G.call(this),Zt(this)},Yt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Jt.prototype.info=function(){};var te=null;function ee(){return te=te||new kt}function ne(a){at.call(this,"serverreachability",a)}function re(a){var b=ee();b.dispatchEvent(new ne(b,a))}function ie(a){at.call(this,"statevent",a)}function oe(a){var b=ee();b.dispatchEvent(new ie(b,a))}function se(a){at.call(this,"timingevent",a)}function ue(a,b){if("function"!=d(a))throw Error("Fn must not be null and must be a function");return f.setTimeout((function(){a()}),b)}T(ne,at),T(ie,at),T(se,at);var ae={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},ce={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function he(){}function fe(a){var b;return(b=a.a)||(b=a.a={}),b}function le(){}he.prototype.a=null;var pe,de={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function ve(){at.call(this,"d")}function ye(){at.call(this,"c")}function ge(){}function me(a,b,t,e){this.g=a,this.c=b,this.f=t,this.T=e||1,this.J=new Yt(this),this.P=we,a=W?125:void 0,this.R=new Bt(a),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}T(ve,at),T(ye,at),T(ge,he),pe=new ge;var we=45e3,be={},_e={};function Ie(a,b,t){a.H=1,a.i=ze(Me(b)),a.j=t,a.I=!0,Ee(a,null)}function Ee(a,b){a.u=q(),Ne(a),a.l=Me(a.i);var t=a.l,e=a.T;Array.isArray(e)||(e=[String(e)]),nn(t.b,"t",e),a.D=0,a.a=Qn(a.g,a.g.C?b:null),0<a.O&&(a.F=new Kt(p(a.Ca,a,a.a),a.O)),Qt(a.J,a.a,"readystatechange",a.Wa),b=a.B?V(a.B):{},a.j?(a.m||(a.m="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.a.ba(a.l,a.m,a.j,b)):(a.m="GET",a.a.ba(a.l,a.m,null,b)),re(1),function(a,b,t,e,n,r){a.info((function(){if(a.a)if(r)for(var o="",c=r.split("&"),h=0;h<c.length;h++){var f=c[h].split("=");if(1<f.length){var l=f[0];f=f[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+f+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.c,a.m,a.l,a.f,a.T,a.j)}function Te(a,b,t){for(var e=!0;!a.A&&a.D<t.length;){var n=Ae(a,t);if(n==_e){4==b&&(a.h=4,oe(14),e=!1),$t(a.c,a.f,null,"[Incomplete Response]");break}if(n==be){a.h=4,oe(15),$t(a.c,a.f,t,"[Invalid Chunk]"),e=!1;break}$t(a.c,a.f,n,null),Le(a,n)}4==b&&0==t.length&&(a.h=1,oe(16),e=!1),a.b=a.b&&e,e?0<t.length&&!a.W&&(a.W=!0,(b=a.g).a==a&&b.V&&!b.F&&(b.c.info("Great, no buffering proxy detected. Bytes received: "+t.length),Gn(b),b.F=!0)):($t(a.c,a.f,t,"[Invalid Chunked Response]"),ke(a),xe(a))}function Ae(a,b){var t=a.D,e=b.indexOf("\n",t);return-1==e?_e:(t=Number(b.substring(t,e)),isNaN(t)?be:(e+=1)+t>b.length?_e:(b=b.substr(e,t),a.D=e+t,b))}function Ne(a){a.U=q()+a.P,Se(a,a.P)}function Se(a,b){if(null!=a.o)throw Error("WatchDog timer not null");a.o=ue(p(a.Ua,a),b)}function De(a){a.o&&(f.clearTimeout(a.o),a.o=null)}function xe(a){0==a.g.v||a.A||Hn(a.g,a)}function ke(a){De(a);var b=a.F;b&&"function"==typeof b.ja&&b.ja(),a.F=null,zt(a.R),Zt(a.J),a.a&&(b=a.a,a.a=null,b.abort(),b.ja())}function Le(a,b){try{var t=a.g;if(0!=t.v&&(t.a==a||hn(t.b,a)))if(t.I=a.N,!a.C&&hn(t.b,a)&&3==t.v){try{var e=t.ka.a.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.j){if(t.a){if(!(t.a.u+3e3<a.u))break t;zn(t),Rn(t)}jn(t),oe(18)}}else t.oa=n[1],0<t.oa-t.P&&37500>n[2]&&t.H&&0==t.o&&!t.m&&(t.m=ue(p(t.Ra,t),6e3));if(1>=cn(t.b)&&t.ea){try{t.ea()}catch(t){}t.ea=void 0}}else Kn(t,11)}else if((a.C||t.a==a)&&zn(t),!x(b))for(b=e=t.ka.a.parse(b),e=0;e<b.length;e++)if(n=b[e],t.P=n[0],n=n[1],2==t.v)if("c"==n[0]){t.J=n[1],t.ga=n[2];var r=n[3];null!=r&&(t.ha=r,t.c.info("VER="+t.ha));var o=n[4];null!=o&&(t.pa=o,t.c.info("SVER="+t.pa));var c=n[5];if(null!=c&&"number"==typeof c&&0<c){var h=1.5*c;t.D=h,t.c.info("backChannelRequestTimeoutMs_="+h)}h=t;var f=a.a;if(f){var l=f.a?f.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var d=h.b;!d.a&&(P(l,"spdy")||P(l,"quic")||P(l,"h2"))&&(d.f=d.g,d.a=new Set,d.b&&(fn(d,d.b),d.b=null))}if(h.A){var v=f.a?f.a.getResponseHeader("X-HTTP-Session-Id"):null;v&&(h.na=v,Be(h.B,h.A,v))}}t.v=3,t.f&&t.f.ta(),t.V&&(t.N=q()-a.u,t.c.info("Handshake RTT: "+t.N+"ms"));var y=a;if((h=t).la=Xn(h,h.C?h.ga:null,h.fa),y.C){ln(h.b,y);var m=y,w=h.D;w&&m.setTimeout(w),m.o&&(De(m),Ne(m)),h.a=y}else Fn(h);0<t.g.length&&Un(t)}else"stop"!=n[0]&&"close"!=n[0]||Kn(t,7);else 3==t.v&&("stop"==n[0]||"close"==n[0]?"stop"==n[0]?Kn(t,7):Pn(t):"noop"!=n[0]&&t.f&&t.f.sa(n),t.o=0);re(4)}catch(t){}}function Pe(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(v(a)||"string"==typeof a)N(a,b,void 0);else{if(a.L&&"function"==typeof a.L)var t=a.L();else if(a.K&&"function"==typeof a.K)t=void 0;else if(v(a)||"string"==typeof a){t=[];for(var e=a.length,n=0;n<e;n++)t.push(n)}else for(n in t=[],e=0,a)t[e++]=n;n=(e=function(a){if(a.K&&"function"==typeof a.K)return a.K();if("string"==typeof a)return a.split("");if(v(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a)).length;for(var r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}}function Re(a,b){this.b={},this.a=[],this.c=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var e=0;e<t;e+=2)this.set(arguments[e],arguments[e+1])}else if(a)if(a instanceof Re)for(t=a.L(),e=0;e<t.length;e++)this.set(t[e],a.get(t[e]));else for(e in a)this.set(e,a[e])}function Oe(a){if(a.c!=a.a.length){for(var b=0,t=0;b<a.a.length;){var e=a.a[b];Ce(a.b,e)&&(a.a[t++]=e),b++}a.a.length=t}if(a.c!=a.a.length){var n={};for(t=b=0;b<a.a.length;)Ce(n,e=a.a[b])||(a.a[t++]=e,n[e]=1),b++;a.a.length=t}}function Ce(a,b){return Object.prototype.hasOwnProperty.call(a,b)}(g=me.prototype).setTimeout=function(a){this.P=a},g.Wa=function(a){a=a.target;var b=this.F;b&&3==Dn(a)?b.f():this.Ca(a)},g.Ca=function(a){try{if(a==this.a)t:{var b=Dn(this.a),t=this.a.ua(),e=this.a.X();if(!(3>b||3==b&&!W&&!this.a.$())){this.A||4!=b||7==t||re(8==t||0>=e?3:2),De(this);var n=this.a.X();this.N=n;var r=this.a.$();if(this.b=200==n,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.c,this.m,this.l,this.f,this.T,b,n),this.b){if(this.V&&!this.C){e:{if(this.a){var o,c=this.a;if((o=c.a?c.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,oe(12),ke(this),xe(this);break t}$t(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Le(this,h)}this.I?(Te(this,b,r),W&&this.b&&3==b&&(Qt(this.J,this.R,"tick",this.Va),this.R.start())):($t(this.c,this.f,r,null),Le(this,r)),4==b&&ke(this),this.b&&!this.A&&(4==b?Hn(this.g,this):(this.b=!1,Ne(this)))}else 400==n&&0<r.indexOf("Unknown SID")?(this.h=3,oe(12)):(this.h=0,oe(13)),ke(this),xe(this)}}}catch(t){}},g.Va=function(){if(this.a){var a=Dn(this.a),b=this.a.$();this.D<b.length&&(De(this),Te(this,a,b),this.b&&4!=a&&Ne(this))}},g.cancel=function(){this.A=!0,ke(this)},g.Ua=function(){this.o=null;var a=q();0<=a-this.U?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.c,this.l),2!=this.H&&(re(3),oe(17)),ke(this),this.h=2,xe(this)):Se(this,this.U-a)},(g=Re.prototype).K=function(){Oe(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a},g.L=function(){return Oe(this),this.a.concat()},g.get=function(a,b){return Ce(this.b,a)?this.b[a]:b},g.set=function(a,b){Ce(this.b,a)||(this.c++,this.a.push(a)),this.b[a]=b},g.forEach=function(a,b){for(var t=this.L(),e=0;e<t.length;e++){var n=t[e],r=this.get(n);a.call(b,r,n,this)}};var Ue=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ve(a,b){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,a instanceof Ve){this.a=void 0!==b?b:a.a,qe(this,a.f),this.j=a.j,Fe(this,a.c),je(this,a.h),this.g=a.g,b=a.b;var t=new $e;t.c=b.c,b.a&&(t.a=new Re(b.a),t.b=b.b),Ge(this,t),this.i=a.i}else a&&(t=String(a).match(Ue))?(this.a=!!b,qe(this,t[1]||"",!0),this.j=He(t[2]||""),Fe(this,t[3]||"",!0),je(this,t[4]),this.g=He(t[5]||"",!0),Ge(this,t[6]||"",!0),this.i=He(t[7]||"")):(this.a=!!b,this.b=new $e(null,this.a))}function Me(a){return new Ve(a)}function qe(a,b,t){a.f=t?He(b,!0):b,a.f&&(a.f=a.f.replace(/:$/,""))}function Fe(a,b,t){a.c=t?He(b,!0):b}function je(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.h=b}else a.h=null}function Ge(a,b,t){b instanceof $e?(a.b=b,function(a,b){b&&!a.f&&(tn(a),a.c=null,a.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(dd(this,e),nn(this,n,t))}),a)),a.f=b}(a.b,a.a)):(t||(b=We(b,Ze)),a.b=new $e(b,a.a))}function Be(a,b,t){a.b.set(b,t)}function ze(a){return Be(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),a}function He(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function We(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,Ke),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Ke(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Ve.prototype.toString=function(){var a=[],b=this.f;b&&a.push(We(b,Ye,!0),":");var t=this.c;return(t||"file"==b)&&(a.push("//"),(b=this.j)&&a.push(We(b,Ye,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.h)&&a.push(":",String(t))),(t=this.g)&&(this.c&&"/"!=t.charAt(0)&&a.push("/"),a.push(We(t,"/"==t.charAt(0)?Qe:Xe,!0))),(t=this.b.toString())&&a.push("?",t),(t=this.i)&&a.push("#",We(t,Je)),a.join("")};var Ye=/[#\/\?@]/g,Xe=/[#\?:]/g,Qe=/[#\?]/g,Ze=/[#\?@]/g,Je=/#/g;function $e(a,b){this.b=this.a=null,this.c=a||null,this.f=!!b}function tn(a){a.a||(a.a=new Re,a.b=0,a.c&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.c,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function dd(a,b){tn(a),b=rn(a,b),Ce(a.a.b,b)&&(a.c=null,a.b-=a.a.get(b).length,Ce((a=a.a).b,b)&&(delete a.b[b],a.c--,a.a.length>2*a.c&&Oe(a)))}function en(a,b){return tn(a),b=rn(a,b),Ce(a.a.b,b)}function nn(a,b,t){dd(a,b),0<t.length&&(a.c=null,a.a.set(rn(a,b),D(t)),a.b+=t.length)}function rn(a,b){return b=String(b),a.f&&(b=b.toLowerCase()),b}function on(a,b){this.b=a,this.a=b}function sn(a){this.g=a||un,f.PerformanceNavigationTiming?a=0<(a=f.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(f.ia&&f.ia.ya&&f.ia.ya()&&f.ia.ya().qb),this.f=a?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(g=$e.prototype).add=function(a,b){tn(this),this.c=null,a=rn(this,a);var t=this.a.get(a);return t||this.a.set(a,t=[]),t.push(b),this.b+=1,this},g.forEach=function(a,b){tn(this),this.a.forEach((function(t,e){N(t,(function(t){a.call(b,t,e,this)}),this)}),this)},g.L=function(){tn(this);for(var a=this.a.K(),b=this.a.L(),t=[],e=0;e<b.length;e++)for(var n=a[e],r=0;r<n.length;r++)t.push(b[e]);return t},g.K=function(a){tn(this);var b=[];if("string"==typeof a)en(this,a)&&(b=S(b,this.a.get(rn(this,a))));else{a=this.a.K();for(var t=0;t<a.length;t++)b=S(b,a[t])}return b},g.set=function(a,b){return tn(this),this.c=null,en(this,a=rn(this,a))&&(this.b-=this.a.get(a).length),this.a.set(a,[b]),this.b+=1,this},g.get=function(a,b){return a&&0<(a=this.K(a)).length?String(a[0]):b},g.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var a=[],b=this.a.L(),t=0;t<b.length;t++){var e=b[t],n=encodeURIComponent(String(e));e=this.K(e);for(var r=0;r<e.length;r++){var o=n;""!==e[r]&&(o+="="+encodeURIComponent(String(e[r]))),a.push(o)}}return this.c=a.join("&")};var un=10;function an(a){return!!a.b||!!a.a&&a.a.size>=a.f}function cn(a){return a.b?1:a.a?a.a.size:0}function hn(a,b){return a.b?a.b==b:!!a.a&&a.a.has(b)}function fn(a,b){a.a?a.a.add(b):a.b=b}function ln(a,b){a.b&&a.b==b?a.b=null:a.a&&a.a.has(b)&&a.a.delete(b)}function pn(a){var t,e;if(null!=a.b)return a.c.concat(a.b.s);if(null!=a.a&&0!==a.a.size){var b=a.c;try{for(var n=o(a.a.values()),r=n.next();!r.done;r=n.next()){var c=r.value;b=b.concat(c.s)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return b}return D(a.c)}function dn(){}function vn(){this.a=new dn}function yn(a,b,t){var e=t||"";try{Pe(a,(function(t,n){var r=t;y(t)&&(r=Pt(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function gn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}sn.prototype.cancel=function(){var t,e;if(this.c=pn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=o(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},dn.prototype.stringify=function(a){return f.JSON.stringify(a,void 0)},dn.prototype.parse=function(a){return f.JSON.parse(a,void 0)};var mn=f.JSON.parse;function wn(a){kt.call(this),this.headers=new Re,this.H=a||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=bn,this.D=this.F=!1}T(wn,kt);var bn="",_n=/^https?$/i,In=["POST","PUT"];function En(a){return"content-type"==a.toLowerCase()}function td(a,b){a.b=!1,a.a&&(a.g=!0,a.a.abort(),a.g=!1),a.f=b,a.h=5,Tn(a),Nn(a)}function Tn(a){a.u||(a.u=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))}function An(a){if(a.b&&void 0!==h&&(!a.s[1]||4!=Dn(a)||2!=a.X()))if(a.l&&4==Dn(a))Ht(a.za,0,a);else if(a.dispatchEvent("readystatechange"),4==Dn(a)){a.b=!1;try{var t,b=a.X();t:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}if(!(t=e)){var n;if(n=0===b){var r=String(a.B).match(Ue)[1]||null;if(!r&&f.self&&f.self.location){var o=f.self.location.protocol;r=o.substr(0,o.length-1)}n=!_n.test(r?r.toLowerCase():"")}t=n}if(t)a.dispatchEvent("complete"),a.dispatchEvent("success");else{a.h=6;try{var c=2<Dn(a)?a.a.statusText:""}catch(t){c=""}a.f=c+" ["+a.X()+"]",Tn(a)}}finally{Nn(a)}}}function Nn(a,b){if(a.a){Sn(a);var t=a.a,e=a.s[0]?l:null;a.a=null,a.s=null,b||a.dispatchEvent("ready");try{t.onreadystatechange=e}catch(t){}}}function Sn(a){a.a&&a.D&&(a.a.ontimeout=null),a.m&&(f.clearTimeout(a.m),a.m=null)}function Dn(a){return a.a?a.a.readyState:0}function xn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=function(a){var b="";return U(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):Be(a,b,t))}function kn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function Ln(a){this.pa=0,this.g=[],this.c=new Jt,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=kn("failFast",!1,a),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=kn("baseRetryDelayMs",5e3,a),this.Ma=kn("retryDelaySeedMs",1e4,a),this.Ja=kn("forwardChannelMaxRetries",2,a),this.ma=kn("forwardChannelRequestTimeoutMs",2e4,a),this.Ka=a&&a.g||void 0,this.D=void 0,this.C=a&&a.supportsCrossDomainXhr||!1,this.J="",this.b=new sn(a&&a.concurrentRequestLimit),this.ka=new vn,this.da=a&&a.fastHandshake||!1,this.Ga=a&&a.b||!1,a&&a.f&&(this.c.a=!1),a&&a.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&a&&a.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Pn(a){if(On(a),3==a.v){var b=a.R++,t=Me(a.B);Be(t,"SID",a.J),Be(t,"RID",b),Be(t,"TYPE","terminate"),Mn(a,t),(b=new me(a,a.c,b,void 0)).H=2,b.i=ze(Me(t)),t=!1,f.navigator&&f.navigator.sendBeacon&&(t=f.navigator.sendBeacon(b.i.toString(),"")),!t&&f.Image&&((new Image).src=b.i,t=!0),t||(b.a=Qn(b.g,null),b.a.ba(b.i)),b.u=q(),Ne(b)}Yn(a)}function Rn(a){a.a&&(Gn(a),a.a.cancel(),a.a=null)}function On(a){Rn(a),a.j&&(f.clearTimeout(a.j),a.j=null),zn(a),a.b.cancel(),a.h&&("number"==typeof a.h&&f.clearTimeout(a.h),a.h=null)}function Cn(a,b){a.g.push(new on(a.La++,b)),3==a.v&&Un(a)}function Un(a){an(a.b)||a.h||(a.h=!0,qt(a.Ba,a),a.u=0)}function Vn(a,b){var t;t=b?b.f:a.R++;var e=Me(a.B);Be(e,"SID",a.J),Be(e,"RID",t),Be(e,"AID",a.P),Mn(a,e),a.i&&a.l&&xn(e,a.i,a.l),t=new me(a,a.c,t,a.u+1),null===a.i&&(t.B=a.l),b&&(a.g=b.s.concat(a.g)),b=qn(a,t,1e3),t.setTimeout(Math.round(.5*a.ma)+Math.round(.5*a.ma*Math.random())),fn(a.b,t),Ie(t,e,b)}function Mn(a,b){a.f&&Pe({},(function(t,e){Be(b,e,t)}))}function qn(a,b,t){t=Math.min(a.g.length,t);var e=a.f?p(a.f.Ha,a.f,a):null;t:for(var n=a.g,r=-1;;){var o=["count="+t];-1==r?0<t?(r=n[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var c=!0,h=0;h<t;h++){var f=n[h].b,l=n[h].a;if(0>(f-=r))r=Math.max(0,n[h].b-100),c=!1;else try{yn(l,o,"req"+f+"_")}catch(t){e&&e(l)}}if(c){e=o.join("&");break t}}return a=a.g.splice(0,t),b.s=a,e}function Fn(a){a.a||a.j||(a.U=1,qt(a.Aa,a),a.o=0)}function jn(a){return!(a.a||a.j||3<=a.o)&&(a.U++,a.j=ue(p(a.Aa,a),Wn(a,a.o)),a.o++,!0)}function Gn(a){null!=a.s&&(f.clearTimeout(a.s),a.s=null)}function Bn(a){a.a=new me(a,a.c,"rpc",a.U),null===a.i&&(a.a.B=a.l),a.a.O=0;var b=Me(a.la);Be(b,"RID","rpc"),Be(b,"SID",a.J),Be(b,"CI",a.H?"0":"1"),Be(b,"AID",a.P),Mn(a,b),Be(b,"TYPE","xmlhttp"),a.i&&a.l&&xn(b,a.i,a.l),a.D&&a.a.setTimeout(a.D);var t=a.a;a=a.ga,t.H=1,t.i=ze(Me(b)),t.j=null,t.I=!0,Ee(t,a)}function zn(a){null!=a.m&&(f.clearTimeout(a.m),a.m=null)}function Hn(a,b){var t=null;if(a.a==b){zn(a),Gn(a),a.a=null;var e=2}else{if(!hn(a.b,b))return;t=b.s,ln(a.b,b),e=1}if(a.I=b.N,0!=a.v)if(b.b)if(1==e){t=b.j?b.j.length:0,b=q()-b.u;var n=a.u;(e=ee()).dispatchEvent(new se(e,t,b,n)),Un(a)}else Fn(a);else if(3==(n=b.h)||0==n&&0<a.I||!(1==e&&function(a,b){return!(cn(a.b)>=a.b.f-(a.h?1:0))&&(a.h?(a.g=b.s.concat(a.g),!0):!(1==a.v||2==a.v||a.u>=(a.Ia?0:a.Ja))&&(a.h=ue(p(a.Ba,a,b),Wn(a,a.u)),a.u++,!0))}(a,b)||2==e&&jn(a)))switch(t&&0<t.length&&(b=a.b,b.c=b.c.concat(t)),n){case 1:Kn(a,5);break;case 4:Kn(a,10);break;case 3:Kn(a,6);break;default:Kn(a,2)}}function Wn(a,b){var t=a.Fa+Math.floor(Math.random()*a.Ma);return a.f||(t*=2),t*b}function Kn(a,b){if(a.c.info("Error code "+b),2==b){var t=null;a.f&&(t=null);var e=p(a.Xa,a);t||(t=new Ve("//www.google.com/images/cleardot.gif"),f.location&&"http"==f.location.protocol||qe(t,"https"),ze(t)),function(a,b){var t=new Jt;if(f.Image){var e=new Image;e.onload=E(gn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=E(gn,t,e,"TestLoadImage: error",!1,b),e.onabort=E(gn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=E(gn,t,e,"TestLoadImage: timeout",!1,b),f.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else oe(2);a.v=0,a.f&&a.f.ra(b),Yn(a),On(a)}function Yn(a){a.v=0,a.I=-1,a.f&&(0==pn(a.b).length&&0==a.g.length||(a.b.c.length=0,D(a.g),a.g.length=0),a.f.qa())}function Xn(a,b,t){var e=function(a){return a instanceof Ve?Me(a):new Ve(a,void 0)}(t);if(""!=e.c)b&&Fe(e,b+"."+e.c),je(e,e.h);else{var n=f.location;e=function(a,b,t,e){var n=new Ve(null,void 0);return a&&qe(n,a),b&&Fe(n,b),t&&je(n,t),e&&(n.g=e),n}(n.protocol,b?b+"."+n.hostname:n.hostname,+n.port,t)}return a.W&&U(a.W,(function(t,n){Be(e,n,t)})),b=a.A,t=a.na,b&&t&&Be(e,b,t),Be(e,"VER",a.ha),Mn(a,e),e}function Qn(a,b){if(b&&!a.C)throw Error("Can't create secondary domain capable XhrIo object.");return(b=new wn(a.Ka)).F=a.C,b}function Zn(){}function Jn(){if(z&&!(10<=Number(it)))throw Error("Environmental error: no available transport.")}function $n(a,b){kt.call(this),this.a=new Ln(b),this.l=a,this.b=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.a.l=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.a&&(a?a["X-WebChannel-Client-Profile"]=b.a:a={"X-WebChannel-Client-Profile":b.a}),this.a.O=a,(a=b&&b.httpHeadersOverwriteParam)&&!x(a)&&(this.a.i=a),this.h=b&&b.supportsCrossDomainXhr||!1,this.g=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!x(b)&&(this.a.A=b,null!==(a=this.b)&&b in a&&(b in(a=this.b)&&delete a[b])),this.f=new rr(this)}function er(a){ve.call(this);var b=a.__sm__;if(b){t:{for(var t in b){a=t;break t}a=void 0}(this.c=a)?(a=this.c,this.data=null!==b&&a in b?b[a]:void 0):this.data=b}else this.data=a}function nr(){ye.call(this),this.status=1}function rr(a){this.a=a}(g=wn.prototype).ba=function(a,b,t,e){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+a);b=b?b.toUpperCase():"GET",this.B=a,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?fe(this.H):fe(pe),this.a.onreadystatechange=p(this.za,this);try{this.A=!0,this.a.open(b,String(a),!0),this.A=!1}catch(t){return void td(this,t)}a=t||"";var n=new Re(this.headers);e&&Pe(e,(function(t,e){n.set(e,t)})),e=function(a){t:{for(var b=En,t=a.length,e="string"==typeof a?a.split(""):a,n=0;n<t;n++)if(n in e&&b.call(void 0,e[n],n,a)){b=n;break t}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}(n.L()),t=f.FormData&&a instanceof f.FormData,!(0<=A(In,b))||e||t||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Sn(this),0<this.o&&((this.D=function(a){return z&&et(9)&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=p(this.xa,this)):this.m=Ht(this.xa,this.o,this)),this.l=!0,this.a.send(a),this.l=!1}catch(t){td(this,t)}},g.xa=function(){void 0!==h&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},g.abort=function(a){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Nn(this))},g.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Nn(this,!0)),wn.S.G.call(this)},g.za=function(){this.j||(this.A||this.l||this.g?An(this):this.Ta())},g.Ta=function(){An(this)},g.X=function(){try{return 2<Dn(this)?this.a.status:-1}catch(t){return-1}},g.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},g.Na=function(a){if(this.a){var b=this.a.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),mn(b)}},g.ua=function(){return this.h},g.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(g=Ln.prototype).ha=8,g.v=1,g.Ba=function(a){if(this.h)if(this.h=null,1==this.v){if(!a){this.R=Math.floor(1e5*Math.random()),a=this.R++;var t,b=new me(this,this.c,a,void 0),e=this.l;if(this.O&&(e?F(e=V(e),this.O):e=this.O),null===this.i&&(b.B=e),this.da)t:{for(var n=t=0;n<this.g.length;n++){var r=this.g[n];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break t}if(4096===t||n===this.g.length-1){t=n+1;break t}}t=1e3}else t=1e3;t=qn(this,b,t),Be(n=Me(this.B),"RID",a),Be(n,"CVER",22),this.A&&Be(n,"X-HTTP-Session-Id",this.A),Mn(this,n),this.i&&e&&xn(n,this.i,e),fn(this.b,b),this.Ga&&Be(n,"TYPE","init"),this.da?(Be(n,"$req",t),Be(n,"SID","null"),b.V=!0,Ie(b,n,null)):Ie(b,n,t),this.v=2}}else 3==this.v&&(a?Vn(this,a):0==this.g.length||an(this.b)||Vn(this))},g.Aa=function(){if(this.j=null,Bn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var a=2*this.N;this.c.info("BP detection timer enabled: "+a),this.s=ue(p(this.Sa,this),a)}},g.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Rn(this),Bn(this))},g.Ra=function(){null!=this.m&&(this.m=null,Rn(this),jn(this),oe(19))},g.Xa=function(a){a?(this.c.info("Successfully pinged google.com"),oe(2)):(this.c.info("Failed to ping google.com"),oe(1))},(g=Zn.prototype).ta=function(){},g.sa=function(){},g.ra=function(){},g.qa=function(){},g.Ha=function(){},Jn.prototype.a=function(a,b){return new $n(a,b)},T($n,kt),(g=$n.prototype).addEventListener=function(a,b,t,e){$n.S.addEventListener.call(this,a,b,t,e)},g.removeEventListener=function(a,b,t,e){$n.S.removeEventListener.call(this,a,b,t,e)},g.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var a=this.a,b=this.l,t=this.b||void 0;oe(0),a.fa=b,a.W=t||{},a.H=a.T,a.B=Xn(a,null,a.fa),Un(a)},g.close=function(){Pn(this.a)},g.Pa=function(a){if("string"==typeof a){var b={};b.__data__=a,Cn(this.a,b)}else this.g?((b={}).__data__=Pt(a),Cn(this.a,b)):Cn(this.a,a)},g.G=function(){this.a.f=null,delete this.f,Pn(this.a),delete this.a,$n.S.G.call(this)},T(er,ve),T(nr,ye),T(rr,Zn),rr.prototype.ta=function(){this.a.dispatchEvent("a")},rr.prototype.sa=function(a){this.a.dispatchEvent(new er(a))},rr.prototype.ra=function(a){this.a.dispatchEvent(new nr(a))},rr.prototype.qa=function(){this.a.dispatchEvent("b")},Jn.prototype.createWebChannel=Jn.prototype.a,$n.prototype.send=$n.prototype.Pa,$n.prototype.open=$n.prototype.Oa,$n.prototype.close=$n.prototype.close,ae.NO_ERROR=0,ae.TIMEOUT=8,ae.HTTP_ERROR=6,ce.COMPLETE="complete",le.EventType=de,de.OPEN="a",de.CLOSE="b",de.ERROR="c",de.MESSAGE="d",kt.prototype.listen=kt.prototype.va,wn.prototype.listenOnce=wn.prototype.wa,wn.prototype.getLastError=wn.prototype.Qa,wn.prototype.getLastErrorCode=wn.prototype.ua,wn.prototype.getStatus=wn.prototype.X,wn.prototype.getResponseJson=wn.prototype.Na,wn.prototype.getResponseText=wn.prototype.$,wn.prototype.send=wn.prototype.ba;var ir={createWebChannelTransport:function(){return new Jn},ErrorCode:ae,EventType:ce,WebChannel:le,XhrIo:wn},or=ir.createWebChannelTransport,sr=ir.ErrorCode,ur=ir.EventType,ar=ir.WebChannel,cr=ir.XhrIo;e.default=ir}.call(this,n(55))},330:function(t,e,n){"use strict";n.r(e);n(326)}}]);